\documentclass{article}
% this comment persuades Sweave not to insert \usepackage{Sweave}

\usepackage{color}%
\definecolor{highlightBg}{rgb}{0.949019607843137,0.949019607843137,0.949019607843137}
\definecolor{highlightBorder}{rgb}{0,0,0}
\newenvironment{Hinput}%
{}%
{}%
\newenvironment{Houtput}%
{}%
{}%
\newsavebox{\highlightbox}%
\newenvironment{Hchunk}%
{%
\vspace{0.5em}\noindent\begin{lrbox}{\highlightbox}%
\begin{minipage}[b]{.9\textwidth}%
}%
{%
\end{minipage}%
\end{lrbox}%
\fcolorbox{highlightBorder}{highlightBg}{\usebox{\highlightbox}}%
\vspace{0.5em}}%


\usepackage{color}%
 
\newsavebox{\hlnormalsizeboxclosebrace}%
\newsavebox{\hlnormalsizeboxopenbrace}%
\newsavebox{\hlnormalsizeboxbackslash}%
\newsavebox{\hlnormalsizeboxlessthan}%
\newsavebox{\hlnormalsizeboxgreaterthan}%
\newsavebox{\hlnormalsizeboxdollar}%
\newsavebox{\hlnormalsizeboxunderscore}%
\newsavebox{\hlnormalsizeboxand}%
\newsavebox{\hlnormalsizeboxhash}%
\newsavebox{\hlnormalsizeboxat}%
\newsavebox{\hlnormalsizeboxpercent}% 
\newsavebox{\hlnormalsizeboxhat}%
\newsavebox{\hlnormalsizeboxsinglequote}%
\newsavebox{\hlnormalsizeboxbacktick}%

\setbox\hlnormalsizeboxopenbrace=\hbox{\begin{normalsize}\verb.{.\end{normalsize}}%
\setbox\hlnormalsizeboxclosebrace=\hbox{\begin{normalsize}\verb.}.\end{normalsize}}%
\setbox\hlnormalsizeboxlessthan=\hbox{\begin{normalsize}\verb.<.\end{normalsize}}%
\setbox\hlnormalsizeboxdollar=\hbox{\begin{normalsize}\verb.$.\end{normalsize}}%
\setbox\hlnormalsizeboxunderscore=\hbox{\begin{normalsize}\verb._.\end{normalsize}}%
\setbox\hlnormalsizeboxand=\hbox{\begin{normalsize}\verb.&.\end{normalsize}}%
\setbox\hlnormalsizeboxhash=\hbox{\begin{normalsize}\verb.#.\end{normalsize}}%
\setbox\hlnormalsizeboxat=\hbox{\begin{normalsize}\verb.@.\end{normalsize}}%
\setbox\hlnormalsizeboxbackslash=\hbox{\begin{normalsize}\verb.\.\end{normalsize}}%
\setbox\hlnormalsizeboxgreaterthan=\hbox{\begin{normalsize}\verb.>.\end{normalsize}}%
\setbox\hlnormalsizeboxpercent=\hbox{\begin{normalsize}\verb.%.\end{normalsize}}%
\setbox\hlnormalsizeboxhat=\hbox{\begin{normalsize}\verb.^.\end{normalsize}}%
\setbox\hlnormalsizeboxsinglequote=\hbox{\begin{normalsize}\verb.'.\end{normalsize}}%
\setbox\hlnormalsizeboxbacktick=\hbox{\begin{normalsize}\verb.`.\end{normalsize}}%
\setbox\hlnormalsizeboxhat=\hbox{\begin{normalsize}\verb.^.\end{normalsize}}%



\newsavebox{\hltinyboxclosebrace}%
\newsavebox{\hltinyboxopenbrace}%
\newsavebox{\hltinyboxbackslash}%
\newsavebox{\hltinyboxlessthan}%
\newsavebox{\hltinyboxgreaterthan}%
\newsavebox{\hltinyboxdollar}%
\newsavebox{\hltinyboxunderscore}%
\newsavebox{\hltinyboxand}%
\newsavebox{\hltinyboxhash}%
\newsavebox{\hltinyboxat}%
\newsavebox{\hltinyboxpercent}% 
\newsavebox{\hltinyboxhat}%
\newsavebox{\hltinyboxsinglequote}%
\newsavebox{\hltinyboxbacktick}%

\setbox\hltinyboxopenbrace=\hbox{\begin{tiny}\verb.{.\end{tiny}}%
\setbox\hltinyboxclosebrace=\hbox{\begin{tiny}\verb.}.\end{tiny}}%
\setbox\hltinyboxlessthan=\hbox{\begin{tiny}\verb.<.\end{tiny}}%
\setbox\hltinyboxdollar=\hbox{\begin{tiny}\verb.$.\end{tiny}}%
\setbox\hltinyboxunderscore=\hbox{\begin{tiny}\verb._.\end{tiny}}%
\setbox\hltinyboxand=\hbox{\begin{tiny}\verb.&.\end{tiny}}%
\setbox\hltinyboxhash=\hbox{\begin{tiny}\verb.#.\end{tiny}}%
\setbox\hltinyboxat=\hbox{\begin{tiny}\verb.@.\end{tiny}}%
\setbox\hltinyboxbackslash=\hbox{\begin{tiny}\verb.\.\end{tiny}}%
\setbox\hltinyboxgreaterthan=\hbox{\begin{tiny}\verb.>.\end{tiny}}%
\setbox\hltinyboxpercent=\hbox{\begin{tiny}\verb.%.\end{tiny}}%
\setbox\hltinyboxhat=\hbox{\begin{tiny}\verb.^.\end{tiny}}%
\setbox\hltinyboxsinglequote=\hbox{\begin{tiny}\verb.'.\end{tiny}}%
\setbox\hltinyboxbacktick=\hbox{\begin{tiny}\verb.`.\end{tiny}}%
\setbox\hltinyboxhat=\hbox{\begin{tiny}\verb.^.\end{tiny}}%



\newsavebox{\hlscriptsizeboxclosebrace}%
\newsavebox{\hlscriptsizeboxopenbrace}%
\newsavebox{\hlscriptsizeboxbackslash}%
\newsavebox{\hlscriptsizeboxlessthan}%
\newsavebox{\hlscriptsizeboxgreaterthan}%
\newsavebox{\hlscriptsizeboxdollar}%
\newsavebox{\hlscriptsizeboxunderscore}%
\newsavebox{\hlscriptsizeboxand}%
\newsavebox{\hlscriptsizeboxhash}%
\newsavebox{\hlscriptsizeboxat}%
\newsavebox{\hlscriptsizeboxpercent}% 
\newsavebox{\hlscriptsizeboxhat}%
\newsavebox{\hlscriptsizeboxsinglequote}%
\newsavebox{\hlscriptsizeboxbacktick}%

\setbox\hlscriptsizeboxopenbrace=\hbox{\begin{scriptsize}\verb.{.\end{scriptsize}}%
\setbox\hlscriptsizeboxclosebrace=\hbox{\begin{scriptsize}\verb.}.\end{scriptsize}}%
\setbox\hlscriptsizeboxlessthan=\hbox{\begin{scriptsize}\verb.<.\end{scriptsize}}%
\setbox\hlscriptsizeboxdollar=\hbox{\begin{scriptsize}\verb.$.\end{scriptsize}}%
\setbox\hlscriptsizeboxunderscore=\hbox{\begin{scriptsize}\verb._.\end{scriptsize}}%
\setbox\hlscriptsizeboxand=\hbox{\begin{scriptsize}\verb.&.\end{scriptsize}}%
\setbox\hlscriptsizeboxhash=\hbox{\begin{scriptsize}\verb.#.\end{scriptsize}}%
\setbox\hlscriptsizeboxat=\hbox{\begin{scriptsize}\verb.@.\end{scriptsize}}%
\setbox\hlscriptsizeboxbackslash=\hbox{\begin{scriptsize}\verb.\.\end{scriptsize}}%
\setbox\hlscriptsizeboxgreaterthan=\hbox{\begin{scriptsize}\verb.>.\end{scriptsize}}%
\setbox\hlscriptsizeboxpercent=\hbox{\begin{scriptsize}\verb.%.\end{scriptsize}}%
\setbox\hlscriptsizeboxhat=\hbox{\begin{scriptsize}\verb.^.\end{scriptsize}}%
\setbox\hlscriptsizeboxsinglequote=\hbox{\begin{scriptsize}\verb.'.\end{scriptsize}}%
\setbox\hlscriptsizeboxbacktick=\hbox{\begin{scriptsize}\verb.`.\end{scriptsize}}%
\setbox\hlscriptsizeboxhat=\hbox{\begin{scriptsize}\verb.^.\end{scriptsize}}%



\newsavebox{\hlfootnotesizeboxclosebrace}%
\newsavebox{\hlfootnotesizeboxopenbrace}%
\newsavebox{\hlfootnotesizeboxbackslash}%
\newsavebox{\hlfootnotesizeboxlessthan}%
\newsavebox{\hlfootnotesizeboxgreaterthan}%
\newsavebox{\hlfootnotesizeboxdollar}%
\newsavebox{\hlfootnotesizeboxunderscore}%
\newsavebox{\hlfootnotesizeboxand}%
\newsavebox{\hlfootnotesizeboxhash}%
\newsavebox{\hlfootnotesizeboxat}%
\newsavebox{\hlfootnotesizeboxpercent}% 
\newsavebox{\hlfootnotesizeboxhat}%
\newsavebox{\hlfootnotesizeboxsinglequote}%
\newsavebox{\hlfootnotesizeboxbacktick}%

\setbox\hlfootnotesizeboxopenbrace=\hbox{\begin{footnotesize}\verb.{.\end{footnotesize}}%
\setbox\hlfootnotesizeboxclosebrace=\hbox{\begin{footnotesize}\verb.}.\end{footnotesize}}%
\setbox\hlfootnotesizeboxlessthan=\hbox{\begin{footnotesize}\verb.<.\end{footnotesize}}%
\setbox\hlfootnotesizeboxdollar=\hbox{\begin{footnotesize}\verb.$.\end{footnotesize}}%
\setbox\hlfootnotesizeboxunderscore=\hbox{\begin{footnotesize}\verb._.\end{footnotesize}}%
\setbox\hlfootnotesizeboxand=\hbox{\begin{footnotesize}\verb.&.\end{footnotesize}}%
\setbox\hlfootnotesizeboxhash=\hbox{\begin{footnotesize}\verb.#.\end{footnotesize}}%
\setbox\hlfootnotesizeboxat=\hbox{\begin{footnotesize}\verb.@.\end{footnotesize}}%
\setbox\hlfootnotesizeboxbackslash=\hbox{\begin{footnotesize}\verb.\.\end{footnotesize}}%
\setbox\hlfootnotesizeboxgreaterthan=\hbox{\begin{footnotesize}\verb.>.\end{footnotesize}}%
\setbox\hlfootnotesizeboxpercent=\hbox{\begin{footnotesize}\verb.%.\end{footnotesize}}%
\setbox\hlfootnotesizeboxhat=\hbox{\begin{footnotesize}\verb.^.\end{footnotesize}}%
\setbox\hlfootnotesizeboxsinglequote=\hbox{\begin{footnotesize}\verb.'.\end{footnotesize}}%
\setbox\hlfootnotesizeboxbacktick=\hbox{\begin{footnotesize}\verb.`.\end{footnotesize}}%
\setbox\hlfootnotesizeboxhat=\hbox{\begin{footnotesize}\verb.^.\end{footnotesize}}%



\newsavebox{\hlsmallboxclosebrace}%
\newsavebox{\hlsmallboxopenbrace}%
\newsavebox{\hlsmallboxbackslash}%
\newsavebox{\hlsmallboxlessthan}%
\newsavebox{\hlsmallboxgreaterthan}%
\newsavebox{\hlsmallboxdollar}%
\newsavebox{\hlsmallboxunderscore}%
\newsavebox{\hlsmallboxand}%
\newsavebox{\hlsmallboxhash}%
\newsavebox{\hlsmallboxat}%
\newsavebox{\hlsmallboxpercent}% 
\newsavebox{\hlsmallboxhat}%
\newsavebox{\hlsmallboxsinglequote}%
\newsavebox{\hlsmallboxbacktick}%

\setbox\hlsmallboxopenbrace=\hbox{\begin{small}\verb.{.\end{small}}%
\setbox\hlsmallboxclosebrace=\hbox{\begin{small}\verb.}.\end{small}}%
\setbox\hlsmallboxlessthan=\hbox{\begin{small}\verb.<.\end{small}}%
\setbox\hlsmallboxdollar=\hbox{\begin{small}\verb.$.\end{small}}%
\setbox\hlsmallboxunderscore=\hbox{\begin{small}\verb._.\end{small}}%
\setbox\hlsmallboxand=\hbox{\begin{small}\verb.&.\end{small}}%
\setbox\hlsmallboxhash=\hbox{\begin{small}\verb.#.\end{small}}%
\setbox\hlsmallboxat=\hbox{\begin{small}\verb.@.\end{small}}%
\setbox\hlsmallboxbackslash=\hbox{\begin{small}\verb.\.\end{small}}%
\setbox\hlsmallboxgreaterthan=\hbox{\begin{small}\verb.>.\end{small}}%
\setbox\hlsmallboxpercent=\hbox{\begin{small}\verb.%.\end{small}}%
\setbox\hlsmallboxhat=\hbox{\begin{small}\verb.^.\end{small}}%
\setbox\hlsmallboxsinglequote=\hbox{\begin{small}\verb.'.\end{small}}%
\setbox\hlsmallboxbacktick=\hbox{\begin{small}\verb.`.\end{small}}%
\setbox\hlsmallboxhat=\hbox{\begin{small}\verb.^.\end{small}}%



\newsavebox{\hllargeboxclosebrace}%
\newsavebox{\hllargeboxopenbrace}%
\newsavebox{\hllargeboxbackslash}%
\newsavebox{\hllargeboxlessthan}%
\newsavebox{\hllargeboxgreaterthan}%
\newsavebox{\hllargeboxdollar}%
\newsavebox{\hllargeboxunderscore}%
\newsavebox{\hllargeboxand}%
\newsavebox{\hllargeboxhash}%
\newsavebox{\hllargeboxat}%
\newsavebox{\hllargeboxpercent}% 
\newsavebox{\hllargeboxhat}%
\newsavebox{\hllargeboxsinglequote}%
\newsavebox{\hllargeboxbacktick}%

\setbox\hllargeboxopenbrace=\hbox{\begin{large}\verb.{.\end{large}}%
\setbox\hllargeboxclosebrace=\hbox{\begin{large}\verb.}.\end{large}}%
\setbox\hllargeboxlessthan=\hbox{\begin{large}\verb.<.\end{large}}%
\setbox\hllargeboxdollar=\hbox{\begin{large}\verb.$.\end{large}}%
\setbox\hllargeboxunderscore=\hbox{\begin{large}\verb._.\end{large}}%
\setbox\hllargeboxand=\hbox{\begin{large}\verb.&.\end{large}}%
\setbox\hllargeboxhash=\hbox{\begin{large}\verb.#.\end{large}}%
\setbox\hllargeboxat=\hbox{\begin{large}\verb.@.\end{large}}%
\setbox\hllargeboxbackslash=\hbox{\begin{large}\verb.\.\end{large}}%
\setbox\hllargeboxgreaterthan=\hbox{\begin{large}\verb.>.\end{large}}%
\setbox\hllargeboxpercent=\hbox{\begin{large}\verb.%.\end{large}}%
\setbox\hllargeboxhat=\hbox{\begin{large}\verb.^.\end{large}}%
\setbox\hllargeboxsinglequote=\hbox{\begin{large}\verb.'.\end{large}}%
\setbox\hllargeboxbacktick=\hbox{\begin{large}\verb.`.\end{large}}%
\setbox\hllargeboxhat=\hbox{\begin{large}\verb.^.\end{large}}%



\newsavebox{\hlLargeboxclosebrace}%
\newsavebox{\hlLargeboxopenbrace}%
\newsavebox{\hlLargeboxbackslash}%
\newsavebox{\hlLargeboxlessthan}%
\newsavebox{\hlLargeboxgreaterthan}%
\newsavebox{\hlLargeboxdollar}%
\newsavebox{\hlLargeboxunderscore}%
\newsavebox{\hlLargeboxand}%
\newsavebox{\hlLargeboxhash}%
\newsavebox{\hlLargeboxat}%
\newsavebox{\hlLargeboxpercent}% 
\newsavebox{\hlLargeboxhat}%
\newsavebox{\hlLargeboxsinglequote}%
\newsavebox{\hlLargeboxbacktick}%

\setbox\hlLargeboxopenbrace=\hbox{\begin{Large}\verb.{.\end{Large}}%
\setbox\hlLargeboxclosebrace=\hbox{\begin{Large}\verb.}.\end{Large}}%
\setbox\hlLargeboxlessthan=\hbox{\begin{Large}\verb.<.\end{Large}}%
\setbox\hlLargeboxdollar=\hbox{\begin{Large}\verb.$.\end{Large}}%
\setbox\hlLargeboxunderscore=\hbox{\begin{Large}\verb._.\end{Large}}%
\setbox\hlLargeboxand=\hbox{\begin{Large}\verb.&.\end{Large}}%
\setbox\hlLargeboxhash=\hbox{\begin{Large}\verb.#.\end{Large}}%
\setbox\hlLargeboxat=\hbox{\begin{Large}\verb.@.\end{Large}}%
\setbox\hlLargeboxbackslash=\hbox{\begin{Large}\verb.\.\end{Large}}%
\setbox\hlLargeboxgreaterthan=\hbox{\begin{Large}\verb.>.\end{Large}}%
\setbox\hlLargeboxpercent=\hbox{\begin{Large}\verb.%.\end{Large}}%
\setbox\hlLargeboxhat=\hbox{\begin{Large}\verb.^.\end{Large}}%
\setbox\hlLargeboxsinglequote=\hbox{\begin{Large}\verb.'.\end{Large}}%
\setbox\hlLargeboxbacktick=\hbox{\begin{Large}\verb.`.\end{Large}}%
\setbox\hlLargeboxhat=\hbox{\begin{Large}\verb.^.\end{Large}}%



\newsavebox{\hlLARGEboxclosebrace}%
\newsavebox{\hlLARGEboxopenbrace}%
\newsavebox{\hlLARGEboxbackslash}%
\newsavebox{\hlLARGEboxlessthan}%
\newsavebox{\hlLARGEboxgreaterthan}%
\newsavebox{\hlLARGEboxdollar}%
\newsavebox{\hlLARGEboxunderscore}%
\newsavebox{\hlLARGEboxand}%
\newsavebox{\hlLARGEboxhash}%
\newsavebox{\hlLARGEboxat}%
\newsavebox{\hlLARGEboxpercent}% 
\newsavebox{\hlLARGEboxhat}%
\newsavebox{\hlLARGEboxsinglequote}%
\newsavebox{\hlLARGEboxbacktick}%

\setbox\hlLARGEboxopenbrace=\hbox{\begin{LARGE}\verb.{.\end{LARGE}}%
\setbox\hlLARGEboxclosebrace=\hbox{\begin{LARGE}\verb.}.\end{LARGE}}%
\setbox\hlLARGEboxlessthan=\hbox{\begin{LARGE}\verb.<.\end{LARGE}}%
\setbox\hlLARGEboxdollar=\hbox{\begin{LARGE}\verb.$.\end{LARGE}}%
\setbox\hlLARGEboxunderscore=\hbox{\begin{LARGE}\verb._.\end{LARGE}}%
\setbox\hlLARGEboxand=\hbox{\begin{LARGE}\verb.&.\end{LARGE}}%
\setbox\hlLARGEboxhash=\hbox{\begin{LARGE}\verb.#.\end{LARGE}}%
\setbox\hlLARGEboxat=\hbox{\begin{LARGE}\verb.@.\end{LARGE}}%
\setbox\hlLARGEboxbackslash=\hbox{\begin{LARGE}\verb.\.\end{LARGE}}%
\setbox\hlLARGEboxgreaterthan=\hbox{\begin{LARGE}\verb.>.\end{LARGE}}%
\setbox\hlLARGEboxpercent=\hbox{\begin{LARGE}\verb.%.\end{LARGE}}%
\setbox\hlLARGEboxhat=\hbox{\begin{LARGE}\verb.^.\end{LARGE}}%
\setbox\hlLARGEboxsinglequote=\hbox{\begin{LARGE}\verb.'.\end{LARGE}}%
\setbox\hlLARGEboxbacktick=\hbox{\begin{LARGE}\verb.`.\end{LARGE}}%
\setbox\hlLARGEboxhat=\hbox{\begin{LARGE}\verb.^.\end{LARGE}}%



\newsavebox{\hlhugeboxclosebrace}%
\newsavebox{\hlhugeboxopenbrace}%
\newsavebox{\hlhugeboxbackslash}%
\newsavebox{\hlhugeboxlessthan}%
\newsavebox{\hlhugeboxgreaterthan}%
\newsavebox{\hlhugeboxdollar}%
\newsavebox{\hlhugeboxunderscore}%
\newsavebox{\hlhugeboxand}%
\newsavebox{\hlhugeboxhash}%
\newsavebox{\hlhugeboxat}%
\newsavebox{\hlhugeboxpercent}% 
\newsavebox{\hlhugeboxhat}%
\newsavebox{\hlhugeboxsinglequote}%
\newsavebox{\hlhugeboxbacktick}%

\setbox\hlhugeboxopenbrace=\hbox{\begin{huge}\verb.{.\end{huge}}%
\setbox\hlhugeboxclosebrace=\hbox{\begin{huge}\verb.}.\end{huge}}%
\setbox\hlhugeboxlessthan=\hbox{\begin{huge}\verb.<.\end{huge}}%
\setbox\hlhugeboxdollar=\hbox{\begin{huge}\verb.$.\end{huge}}%
\setbox\hlhugeboxunderscore=\hbox{\begin{huge}\verb._.\end{huge}}%
\setbox\hlhugeboxand=\hbox{\begin{huge}\verb.&.\end{huge}}%
\setbox\hlhugeboxhash=\hbox{\begin{huge}\verb.#.\end{huge}}%
\setbox\hlhugeboxat=\hbox{\begin{huge}\verb.@.\end{huge}}%
\setbox\hlhugeboxbackslash=\hbox{\begin{huge}\verb.\.\end{huge}}%
\setbox\hlhugeboxgreaterthan=\hbox{\begin{huge}\verb.>.\end{huge}}%
\setbox\hlhugeboxpercent=\hbox{\begin{huge}\verb.%.\end{huge}}%
\setbox\hlhugeboxhat=\hbox{\begin{huge}\verb.^.\end{huge}}%
\setbox\hlhugeboxsinglequote=\hbox{\begin{huge}\verb.'.\end{huge}}%
\setbox\hlhugeboxbacktick=\hbox{\begin{huge}\verb.`.\end{huge}}%
\setbox\hlhugeboxhat=\hbox{\begin{huge}\verb.^.\end{huge}}%



\newsavebox{\hlHugeboxclosebrace}%
\newsavebox{\hlHugeboxopenbrace}%
\newsavebox{\hlHugeboxbackslash}%
\newsavebox{\hlHugeboxlessthan}%
\newsavebox{\hlHugeboxgreaterthan}%
\newsavebox{\hlHugeboxdollar}%
\newsavebox{\hlHugeboxunderscore}%
\newsavebox{\hlHugeboxand}%
\newsavebox{\hlHugeboxhash}%
\newsavebox{\hlHugeboxat}%
\newsavebox{\hlHugeboxpercent}% 
\newsavebox{\hlHugeboxhat}%
\newsavebox{\hlHugeboxsinglequote}%
\newsavebox{\hlHugeboxbacktick}%

\setbox\hlHugeboxopenbrace=\hbox{\begin{Huge}\verb.{.\end{Huge}}%
\setbox\hlHugeboxclosebrace=\hbox{\begin{Huge}\verb.}.\end{Huge}}%
\setbox\hlHugeboxlessthan=\hbox{\begin{Huge}\verb.<.\end{Huge}}%
\setbox\hlHugeboxdollar=\hbox{\begin{Huge}\verb.$.\end{Huge}}%
\setbox\hlHugeboxunderscore=\hbox{\begin{Huge}\verb._.\end{Huge}}%
\setbox\hlHugeboxand=\hbox{\begin{Huge}\verb.&.\end{Huge}}%
\setbox\hlHugeboxhash=\hbox{\begin{Huge}\verb.#.\end{Huge}}%
\setbox\hlHugeboxat=\hbox{\begin{Huge}\verb.@.\end{Huge}}%
\setbox\hlHugeboxbackslash=\hbox{\begin{Huge}\verb.\.\end{Huge}}%
\setbox\hlHugeboxgreaterthan=\hbox{\begin{Huge}\verb.>.\end{Huge}}%
\setbox\hlHugeboxpercent=\hbox{\begin{Huge}\verb.%.\end{Huge}}%
\setbox\hlHugeboxhat=\hbox{\begin{Huge}\verb.^.\end{Huge}}%
\setbox\hlHugeboxsinglequote=\hbox{\begin{Huge}\verb.'.\end{Huge}}%
\setbox\hlHugeboxbacktick=\hbox{\begin{Huge}\verb.`.\end{Huge}}%
\setbox\hlHugeboxhat=\hbox{\begin{Huge}\verb.^.\end{Huge}}%
 

\def\urltilda{\kern -.15em\lower .7ex\hbox{\~{}}\kern .04em}%

\newcommand{\hlstd}[1]{\textcolor[rgb]{0,0,0}{#1}}%
\newcommand{\hlnum}[1]{\textcolor[rgb]{0.16,0.16,1}{#1}}
\newcommand{\hlesc}[1]{\textcolor[rgb]{1,0,1}{#1}}
\newcommand{\hlstr}[1]{\textcolor[rgb]{1,0,0}{#1}}
\newcommand{\hldstr}[1]{\textcolor[rgb]{0.51,0.51,0}{#1}}
\newcommand{\hlslc}[1]{\textcolor[rgb]{0.51,0.51,0.51}{\it{#1}}}
\newcommand{\hlcom}[1]{\textcolor[rgb]{0.51,0.51,0.51}{\it{#1}}}
\newcommand{\hldir}[1]{\textcolor[rgb]{0,0.51,0}{#1}}
\newcommand{\hlsym}[1]{\textcolor[rgb]{0,0,0}{#1}}
\newcommand{\hlline}[1]{\textcolor[rgb]{0.33,0.33,0.33}{#1}}
\newcommand{\hlkwa}[1]{\textcolor[rgb]{0,0,0}{\bf{#1}}}
\newcommand{\hlkwb}[1]{\textcolor[rgb]{0.51,0,0}{#1}}
\newcommand{\hlkwc}[1]{\textcolor[rgb]{0,0,0}{\bf{#1}}}
\newcommand{\hlkwd}[1]{\textcolor[rgb]{0,0,0.51}{#1}}

\newcommand{\hlnumber}[1]{\textcolor[rgb]{0.0823529411764706,0.0784313725490196,0.709803921568627}{#1}}%
\newcommand{\hlfunctioncall}[1]{\textcolor[rgb]{1,0,0}{#1}}%
\newcommand{\hlstring}[1]{\textcolor[rgb]{0.6,0.6,1}{#1}}%
\newcommand{\hlkeyword}[1]{\textcolor[rgb]{0,0,0}{\textbf{#1}}}%
\newcommand{\hlargument}[1]{\textcolor[rgb]{0.694117647058824,0.247058823529412,0.0196078431372549}{#1}}%
\newcommand{\hlcomment}[1]{\textcolor[rgb]{0.8,0.8,0.8}{#1}}%
\newcommand{\hlroxygencomment}[1]{\textcolor[rgb]{0,0.592156862745098,1}{#1}}%
\newcommand{\hlformalargs}[1]{\textcolor[rgb]{0.0705882352941176,0.713725490196078,0.0705882352941176}{#1}}%
\newcommand{\hleqformalargs}[1]{\textcolor[rgb]{0.0705882352941176,0.713725490196078,0.0705882352941176}{#1}}%
\newcommand{\hlassignement}[1]{\textcolor[rgb]{0.215686274509804,0.215686274509804,0.384313725490196}{\textbf{#1}}}%
\newcommand{\hlpackage}[1]{\textcolor[rgb]{0.588235294117647,0.713725490196078,0.145098039215686}{#1}}%
\newcommand{\hlslot}[1]{\textit{#1}}%
\newcommand{\hlsymbol}[1]{\textcolor[rgb]{0,0,0}{#1}}%
\newcommand{\hlprompt}[1]{\textcolor[rgb]{0,0,0}{#1}}%

%\usepackage{}
\usepackage{multicol}   %Columns
\usepackage{multirow}
\usepackage{subfigure}
\usepackage{graphicx}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{hyperref}
\hypersetup{pdfnewwindow=true}
\usepackage{rotating}
% -------------------------------------------------------------------------------
\RequirePackage {fancyvrb}
\RequirePackage {listings}
% %%% important: keep the following comment in
% %%% (see https://mailman.stat.ethz.ch/pipermail/r-help/2009- July/204747. html)

%
% -------------------------------------------------------------------------------

% -------------------------------------------------------------------------------


\usepackage{amsmath}
\usepackage{amscd}
\usepackage[tableposition=top]{caption}
\usepackage{ifthen}
\usepackage[utf8]{inputenc}

\begin{document}
%% source('')
%% setwd( "d:/Projects/Kinetics/KINGUI/package/Sourcefunctions/dev/doc")
%% setwd( "d:/Projects/Kinetics/KINGUI/package/DevSF/dev/doc")
%% setwd('C:/Users/gbbfx/Work/Projects/Kinetics/KINGUI/package/workingcopy/DevSF/dev/doc')

%% Sweave('kinGUI2.Rnw')
%%require( highlight )
%%driver <- HighlightWeaveLatex()
%% Sweave( 'kinGUI2.Rnw', driver = driver )

%% http://tex.stackexchange.com/questions/41471/getting-sweave-code-chunks-to-stay-inside-page-margins
\title{Kinetic Evaluations using KinGui 2}
\author{Zhenglei Gao}
\maketitle
\section{Introduction}

The package KinGui2 is for kinetic evaluations according to the
requirements given by the FOCUS Report on Estimating Persistence and
Degradation Kinetics (EC Document Reference Sanco/10058/2005, version
2.0, June 2006). It includes a function for conveniently defining the
kinetic models with multiple compartments using simple text. It
provides all kinetic models recommended in this report and by default
does the standard statistical evaluations requested.

Three different 'optimization' algorithms are implemented in this
package. In particular the estimation of parameter confidence
intervals is much improved as compared to the previous KinGui by
providing the methods Iteratively Reweighted Least Squares (IRLS) and
Markov Chain Monte Carlo (MCMC).

Note the package can work both in combination with a GUI in KinGUII and as a
stand alone R package. It is developed based on the framework set up
by Johannes Reinken's R package \textbf{mkin}.

\section{Theoretical Background}
\subsection{Methods for Optimization}
The package provide the following 3 methods for fitting the parameters of the
nonlinear regression defined by the differential equation system which
describes the degradation of the substances of interest.
\begin{itemize}
\item NLS
\item IRLS \cite{gao_improving_2011}
\item MCMC \cite{goerlitz_statistical_2011}
\end{itemize}

\subsection{Constrained Optimization}
When using the default parametrization, the optimization should
satisfy the constriant that the sum of the formation fractions $ff_i, i=1,\ldots, n$ is 1. Not
Therefore, as a workaround, we transform the formation fractions using
the following equations.
\begin{eqnarray*}
  ff_1 &=& f_1\\
  ff_2 &=& f_2(1-ff_1)\\
  &\cdots&\\
  ff_n&=&f_n(1-ff_{n-1})
\end{eqnarray*}
Inversely, it is
\begin{eqnarray*}
  f_1 &=& ff_1\\
  f_2 &=& ff_2/(1-f_1)\\
  &\cdots&\\
  f_n&=&ff_n/(1-f_{n-1})
\end{eqnarray*}
A simple mathematical induction will prove that using the transformed
$f_i, i=1,\ldots,n$ satisfies the constraint.

Another possible reparameterization that satisfies these constraints would be
\begin{eqnarray*}
  ff_1 &=& \frac{\exp{f_1}}{\sum\exp{f_i}}\\
  &\cdots&\\
  ff_n&=&\frac{\exp{f_1}}{\sum\exp{f_i}}\\
\end{eqnarray*} with $f_1=1$
We use the first reparametrization in this version. The second will be
implemented in a later version.
\subsection{Chi-square error estimation}
The smallest relative error(measurement error percentage) resulting in
passing the chi-squared test
as defined in the FOCUS kinetics report from 2006 is calculated by the
function \textbf{chi2err}. A few notes:
\begin{itemize}
  \item With replicate measurements, the calculated mean and observed
    mean values are used. However,  the true replicate values are
    used for the kinetic fit.
\item According to the FK report (page 162-163) time zero is not
included in the Chi2 error calculation for metabolites.
\end{itemize}
\section{Examples}
\subsection{Default kinetic model set up}
The two models set up by the following two functions are exactly the
same. For R-users, they can use the first way of defining the
model. For KinGUII users, the GUI will generate the long script that
will explicitly include everything, e.g., residue data, parameter starting
values, in the function inputs.
\subsubsection{Simple}
\begin{Hchunk}
\begin{normalsize}
\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlsymbol{complex}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlfunctioncall{mkinmod.full}\hlkeyword{(}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }\hlargument{parent}{\ }\hlargument{=}{\ }\hlfunctioncall{list}\hlkeyword{(}\hlargument{type}{\ }\hlargument{=}{\ }\hlstring{"SFO"}\hlkeyword{,}{\ }\hlargument{to}{\ }\hlargument{=}{\ }\hlfunctioncall{c}\hlkeyword{(}\hlstring{"A1"}\hlkeyword{,}{\ }\hlstring{"B1"}\hlkeyword{,}{\ }\hlstring{"C1"}\hlkeyword{)}\hlkeyword{,}{\ }\hlargument{sink}{\ }\hlargument{=}{\ }\hlnumber{FALSE}\hlkeyword{)}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }\hlargument{A1}{\ }\hlargument{=}{\ }\hlfunctioncall{list}\hlkeyword{(}\hlargument{type}{\ }\hlargument{=}{\ }\hlstring{"SFO"}\hlkeyword{,}{\ }\hlargument{to}{\ }\hlargument{=}{\ }\hlstring{"A2"}\hlkeyword{)}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }\hlargument{B1}{\ }\hlargument{=}{\ }\hlfunctioncall{list}\hlkeyword{(}\hlargument{type}{\ }\hlargument{=}{\ }\hlstring{"SFO"}\hlkeyword{)}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }\hlargument{C1}{\ }\hlargument{=}{\ }\hlfunctioncall{list}\hlkeyword{(}\hlargument{type}{\ }\hlargument{=}{\ }\hlstring{"SFO"}\hlkeyword{)}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }\hlargument{A2}{\ }\hlargument{=}{\ }\hlfunctioncall{list}\hlkeyword{(}\hlargument{type}{\ }\hlargument{=}{\ }\hlstring{"SFO"}\hlkeyword{)}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }\hlargument{inpartri}\hlargument{=}\hlstring{\usebox{\hlnormalsizeboxsinglequote}default\usebox{\hlnormalsizeboxsinglequote}}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }\hlargument{outpartri}\hlargument{=}\hlstring{\usebox{\hlnormalsizeboxsinglequote}default\usebox{\hlnormalsizeboxsinglequote}}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }\hlargument{data}\hlargument{=}\hlsymbol{schaefer07\usebox{\hlnormalsizeboxunderscore}complex\usebox{\hlnormalsizeboxunderscore}case}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }\hlargument{weight}\hlargument{=}NULL\hlkeyword{)}\mbox{}
\normalfont
\end{Hinput}


\end{normalsize}
\end{Hchunk}

\subsubsection{Generated by the GUI}
\begin{Hchunk}
\begin{normalsize}
\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlsymbol{complex}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlfunctioncall{mkinmod.full}\hlkeyword{(}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}\hlargument{parent}{\ }\hlargument{=}{\ }\hlfunctioncall{list}\hlkeyword{(}\hlargument{time}{\ }\hlargument{=}{\ }\hlfunctioncall{c}\hlkeyword{(}\hlnumber{0}\hlkeyword{,}{\ }\hlnumber{1}\hlkeyword{,}{\ }\hlnumber{3}\hlkeyword{,}{\ }\hlnumber{7}\hlkeyword{,}\hlnumber{14}\hlkeyword{,}\hlnumber{30}\hlkeyword{,}\hlnumber{62}\hlkeyword{,}\hlnumber{100}\hlkeyword{)}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }\hlargument{residue}{\ }\hlargument{=}{\ }\hlfunctioncall{c}\hlkeyword{(}\hlnumber{93.2}\hlkeyword{,}\hlnumber{89.4}\hlkeyword{,}\hlnumber{79.7}\hlkeyword{,}\hlnumber{61.1}\hlkeyword{,}\hlnumber{48.2}\hlkeyword{,}\hlnumber{15.9}\hlkeyword{,}\hlnumber{6.5}\hlkeyword{,}\hlnumber{6}\hlkeyword{)}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }\hlargument{weight}{\ }\hlargument{=}{\ }\hlfunctioncall{c}\hlkeyword{(}{\ }{\ }{\ }\hlnumber{1}\hlkeyword{,}{\ }\hlnumber{1}\hlkeyword{,}{\ }\hlnumber{1}\hlkeyword{,}{\ }\hlnumber{1}\hlkeyword{,}{\ }\hlnumber{1}\hlkeyword{,}{\ }\hlnumber{1}\hlkeyword{,}{\ }\hlnumber{1}\hlkeyword{,}{\ }\hlnumber{1}\hlkeyword{)}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }\hlargument{to}{\ }\hlargument{=}{\ }\hlfunctioncall{c}\hlkeyword{(}\hlstring{"A1"}\hlkeyword{,}\hlstring{"B1"}\hlkeyword{,}\hlstring{"C1"}\hlkeyword{)}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }\hlargument{FF}{\ }\hlargument{=}{\ }\hlfunctioncall{list}\hlkeyword{(}\hlargument{ini}{\ }{\ }{\ }\hlargument{=}{\ }\hlfunctioncall{c}\hlkeyword{(}\hlnumber{0.1}\hlkeyword{,}\hlnumber{0.1}\hlkeyword{,}\hlnumber{0.1}\hlkeyword{)}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlargument{fixed}{\ }\hlargument{=}{\ }\hlfunctioncall{c}\hlkeyword{(}\hlnumber{0}\hlkeyword{,}\hlnumber{0}\hlkeyword{,}\hlnumber{0}\hlkeyword{)}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlargument{lower}{\ }\hlargument{=}{\ }\hlfunctioncall{c}\hlkeyword{(}\hlnumber{0.0}\hlkeyword{,}\hlnumber{0.0}\hlkeyword{,}\hlnumber{0.0}\hlkeyword{)}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlargument{upper}{\ }\hlargument{=}{\ }\hlfunctioncall{c}\hlkeyword{(}\hlnumber{1.0}\hlkeyword{,}\hlnumber{1.0}\hlkeyword{,}\hlnumber{1.0}\hlkeyword{)}\hlkeyword{)}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }\hlargument{sink}{\ }{\ }\hlargument{=}{\ }\hlnumber{TRUE}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }\hlargument{type}{\ }\hlargument{=}{\ }\hlstring{"SFO"}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }\hlargument{k}{\ }\hlargument{=}{\ }\hlfunctioncall{list}\hlkeyword{(}\hlargument{ini}{\ }{\ }{\ }\hlargument{=}{\ }\hlnumber{0.1}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlargument{fixed}{\ }\hlargument{=}{\ }\hlnumber{0}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlargument{lower}{\ }\hlargument{=}{\ }\hlnumber{0.0}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlargument{upper}{\ }\hlargument{=}{\ }\hlnumber{Inf}\hlkeyword{)}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }\hlargument{M0}{\ }\hlargument{=}{\ }\hlfunctioncall{list}\hlkeyword{(}\hlargument{ini}{\ }{\ }{\ }\hlargument{=}{\ }\hlnumber{0.1}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlargument{fixed}{\ }\hlargument{=}{\ }\hlnumber{0}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlargument{lower}{\ }\hlargument{=}{\ }\hlnumber{0.0}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlargument{upper}{\ }\hlargument{=}{\ }\hlnumber{Inf}\hlkeyword{)}\hlkeyword{)}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }\hlargument{A1}{\ }\hlargument{=}{\ }\hlfunctioncall{list}\hlkeyword{(}{\ }\hlargument{time}{\ }\hlargument{=}{\ }\hlfunctioncall{c}\hlkeyword{(}\hlnumber{0}\hlkeyword{,}\hlnumber{1}\hlkeyword{,}\hlnumber{3}\hlkeyword{,}\hlnumber{7}\hlkeyword{,}{\ }\hlnumber{14}\hlkeyword{,}{\ }\hlnumber{30}\hlkeyword{,}{\ }\hlnumber{62}\hlkeyword{,}\hlnumber{100}\hlkeyword{)}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }\hlargument{residue}{\ }\hlargument{=}{\ }\hlfunctioncall{c}\hlkeyword{(}\hlnumber{NA}\hlkeyword{,}{\ }\hlnumber{NA}\hlkeyword{,}\hlnumber{0.55}\hlkeyword{,}\hlnumber{6.87}\hlkeyword{,}\hlnumber{17.08}\hlkeyword{,}\hlnumber{21.68}\hlkeyword{,}\hlnumber{15.77}\hlkeyword{,}\hlnumber{13.63}\hlkeyword{)}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }\hlargument{weight}{\ }\hlargument{=}{\ }\hlfunctioncall{c}\hlkeyword{(}\hlnumber{1}\hlkeyword{,}\hlnumber{1}\hlkeyword{,}\hlnumber{1}\hlkeyword{,}\hlnumber{1}\hlkeyword{,}\hlnumber{1}\hlkeyword{,}\hlnumber{1}\hlkeyword{,}\hlnumber{1}\hlkeyword{,}\hlnumber{1}\hlkeyword{)}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }\hlargument{to}{\ }\hlargument{=}{\ }\hlfunctioncall{c}\hlkeyword{(}\hlstring{"A2"}\hlkeyword{)}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }\hlargument{FF}{\ }\hlargument{=}{\ }\hlfunctioncall{list}\hlkeyword{(}\hlargument{ini}{\ }{\ }{\ }\hlargument{=}{\ }\hlfunctioncall{c}\hlkeyword{(}\hlnumber{0.1}\hlkeyword{)}\hlkeyword{,}{\ }\hlargument{fixed}{\ }\hlargument{=}{\ }\hlfunctioncall{c}\hlkeyword{(}\hlnumber{0}\hlkeyword{)}\hlkeyword{,}\hlargument{lower}{\ }\hlargument{=}{\ }\hlfunctioncall{c}\hlkeyword{(}\hlnumber{0.0}\hlkeyword{)}\hlkeyword{,}{\ }\hlargument{upper}{\ }\hlargument{=}{\ }\hlfunctioncall{c}\hlkeyword{(}\hlnumber{1.0}\hlkeyword{)}\hlkeyword{)}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }\hlargument{sink}{\ }{\ }\hlargument{=}{\ }\hlnumber{TRUE}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }\hlargument{type}{\ }\hlargument{=}{\ }\hlstring{"SFO"}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }\hlargument{k}{\ }\hlargument{=}{\ }\hlfunctioncall{list}\hlkeyword{(}\hlargument{ini}\hlargument{=}\hlnumber{0.1}\hlkeyword{,}\hlargument{fixed}\hlargument{=}\hlnumber{0}\hlkeyword{,}\hlargument{lower}\hlargument{=}\hlnumber{0.0}\hlkeyword{,}\hlargument{upper}\hlargument{=}\hlnumber{Inf}\hlkeyword{)}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }\hlargument{M0}{\ }\hlargument{=}{\ }\hlfunctioncall{list}\hlkeyword{(}\hlargument{ini}\hlargument{=}{\ }\hlnumber{0}\hlkeyword{,}\hlargument{fixed}\hlargument{=}\hlnumber{1}\hlkeyword{,}\hlargument{lower}\hlargument{=}\hlnumber{0.0}\hlkeyword{,}\hlargument{upper}\hlargument{=}\hlnumber{Inf}\hlkeyword{)}\hlkeyword{)}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }\hlargument{A2}{\ }\hlargument{=}{\ }\hlfunctioncall{list}\hlkeyword{(}\hlargument{time}{\ }\hlargument{=}{\ }\hlfunctioncall{c}\hlkeyword{(}{\ }{\ }{\ }\hlnumber{0}\hlkeyword{,}{\ }\hlnumber{1}\hlkeyword{,}{\ }\hlnumber{3}\hlkeyword{,}{\ }\hlnumber{7}\hlkeyword{,}\hlnumber{14}\hlkeyword{,}\hlnumber{30}\hlkeyword{,}\hlnumber{62}\hlkeyword{,}\hlnumber{100}\hlkeyword{)}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }\hlargument{residue}{\ }\hlargument{=}{\ }\hlfunctioncall{c}\hlkeyword{(}\hlnumber{NA}\hlkeyword{,}\hlnumber{0.55}\hlkeyword{,}\hlnumber{1.41}\hlkeyword{,}\hlnumber{0.55}\hlkeyword{,}\hlnumber{1.29}\hlkeyword{,}\hlnumber{1.95}\hlkeyword{,}\hlnumber{3.54}\hlkeyword{,}\hlnumber{3.86}\hlkeyword{)}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }\hlargument{weight}{\ }\hlargument{=}{\ }\hlfunctioncall{c}\hlkeyword{(}{\ }{\ }{\ }\hlnumber{1}\hlkeyword{,}{\ }\hlnumber{1}\hlkeyword{,}{\ }\hlnumber{1}\hlkeyword{,}{\ }\hlnumber{1}\hlkeyword{,}{\ }\hlnumber{1}\hlkeyword{,}{\ }\hlnumber{1}\hlkeyword{,}{\ }\hlnumber{1}\hlkeyword{,}{\ }\hlnumber{1}\hlkeyword{)}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }\hlargument{sink}{\ }{\ }\hlargument{=}{\ }\hlnumber{TRUE}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }\hlargument{type}{\ }\hlargument{=}{\ }\hlstring{"SFO"}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }\hlargument{k}{\ }\hlargument{=}{\ }\hlfunctioncall{list}\hlkeyword{(}\hlargument{ini}\hlargument{=}\hlnumber{0.1}\hlkeyword{,}\hlargument{fixed}\hlargument{=}\hlnumber{0}\hlkeyword{,}\hlargument{lower}\hlargument{=}\hlnumber{0.0}\hlkeyword{,}\hlargument{upper}\hlargument{=}\hlnumber{Inf}\hlkeyword{)}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }\hlargument{M0}{\ }\hlargument{=}{\ }\hlfunctioncall{list}\hlkeyword{(}\hlargument{ini}\hlargument{=}\hlnumber{0}\hlkeyword{,}{\ }\hlargument{fixed}\hlargument{=}\hlnumber{1}\hlkeyword{,}\hlargument{lower}\hlargument{=}\hlnumber{0.0}\hlkeyword{,}\hlargument{upper}\hlargument{=}\hlnumber{Inf}\hlkeyword{)}\hlkeyword{)}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }\hlargument{B1}{\ }\hlargument{=}{\ }\hlfunctioncall{list}\hlkeyword{(}\hlargument{time}{\ }\hlargument{=}{\ }\hlfunctioncall{c}\hlkeyword{(}{\ }{\ }{\ }{\ }\hlnumber{0}\hlkeyword{,}\hlnumber{1}\hlkeyword{,}\hlnumber{3}\hlkeyword{,}\hlnumber{7}\hlkeyword{,}{\ }\hlnumber{14}\hlkeyword{,}{\ }\hlnumber{30}\hlkeyword{,}{\ }\hlnumber{62}\hlkeyword{,}\hlnumber{100}\hlkeyword{)}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlargument{residue}{\ }\hlargument{=}{\ }\hlfunctioncall{c}\hlkeyword{(}\hlnumber{NA}\hlkeyword{,}\hlnumber{NA}\hlkeyword{,}\hlnumber{NA}\hlkeyword{,}\hlnumber{0.55}\hlkeyword{,}\hlnumber{2.31}\hlkeyword{,}\hlnumber{15.76}\hlkeyword{,}\hlnumber{6.36}\hlkeyword{,}\hlnumber{3.74}\hlkeyword{)}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlargument{weight}{\ }\hlargument{=}{\ }\hlfunctioncall{c}\hlkeyword{(}\hlnumber{1}\hlkeyword{,}\hlnumber{1}\hlkeyword{,}\hlnumber{1}\hlkeyword{,}\hlnumber{1}\hlkeyword{,}\hlnumber{1}\hlkeyword{,}\hlnumber{1}\hlkeyword{,}\hlnumber{1}\hlkeyword{,}\hlnumber{1}\hlkeyword{)}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlargument{sink}{\ }{\ }\hlargument{=}{\ }\hlnumber{TRUE}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlargument{type}{\ }\hlargument{=}{\ }\hlstring{"SFO"}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlargument{k}{\ }\hlargument{=}{\ }\hlfunctioncall{list}\hlkeyword{(}\hlargument{ini}\hlargument{=}{\ }\hlnumber{0.1}\hlkeyword{,}\hlargument{fixed}\hlargument{=}\hlnumber{0}\hlkeyword{,}\hlargument{lower}\hlargument{=}\hlnumber{0.0}\hlkeyword{,}\hlargument{upper}\hlargument{=}\hlnumber{Inf}\hlkeyword{)}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlargument{M0}{\ }\hlargument{=}{\ }\hlfunctioncall{list}\hlkeyword{(}\hlargument{ini}\hlargument{=}\hlnumber{0}\hlkeyword{,}\hlargument{fixed}\hlargument{=}\hlnumber{1}\hlkeyword{,}{\ }\hlargument{lower}\hlargument{=}\hlnumber{0.0}\hlkeyword{,}{\ }\hlargument{upper}\hlargument{=}\hlnumber{Inf}\hlkeyword{)}\hlkeyword{)}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }\hlargument{C1}{\ }\hlargument{=}{\ }\hlfunctioncall{list}\hlkeyword{(}\hlargument{time}{\ }\hlargument{=}{\ }\hlfunctioncall{c}\hlkeyword{(}\hlnumber{0}\hlkeyword{,}\hlnumber{1}\hlkeyword{,}\hlnumber{3}\hlkeyword{,}\hlnumber{7}\hlkeyword{,}{\ }\hlnumber{14}\hlkeyword{,}{\ }\hlnumber{30}\hlkeyword{,}{\ }\hlnumber{62}\hlkeyword{,}\hlnumber{100}\hlkeyword{)}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }\hlargument{residue}{\ }\hlargument{=}{\ }\hlfunctioncall{c}\hlkeyword{(}\hlnumber{NA}\hlkeyword{,}\hlnumber{0.55}\hlkeyword{,}\hlnumber{3.2}\hlkeyword{,}\hlnumber{5.46}\hlkeyword{,}\hlnumber{12.55}\hlkeyword{,}\hlnumber{10.45}\hlkeyword{,}\hlnumber{4.74}\hlkeyword{,}\hlnumber{4.33}\hlkeyword{)}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }\hlargument{weight}{\ }\hlargument{=}{\ }\hlfunctioncall{c}\hlkeyword{(}\hlnumber{1}\hlkeyword{,}\hlnumber{1}\hlkeyword{,}\hlnumber{1}\hlkeyword{,}\hlnumber{1}\hlkeyword{,}\hlnumber{1}\hlkeyword{,}\hlnumber{1}\hlkeyword{,}\hlnumber{1}\hlkeyword{,}\hlnumber{1}\hlkeyword{)}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }\hlargument{sink}{\ }{\ }\hlargument{=}{\ }\hlnumber{TRUE}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }\hlargument{type}{\ }\hlargument{=}{\ }\hlstring{"SFO"}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }\hlargument{k}{\ }\hlargument{=}{\ }\hlfunctioncall{list}\hlkeyword{(}\hlargument{ini}\hlargument{=}\hlnumber{0.1}\hlkeyword{,}\hlargument{fixed}\hlargument{=}\hlnumber{0}\hlkeyword{,}{\ }\hlargument{lower}\hlargument{=}\hlnumber{0.0}\hlkeyword{,}{\ }\hlargument{upper}\hlargument{=}\hlnumber{Inf}\hlkeyword{)}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }\hlargument{M0}{\ }\hlargument{=}{\ }\hlfunctioncall{list}\hlkeyword{(}\hlargument{ini}\hlargument{=}{\ }\hlnumber{0}\hlkeyword{,}\hlargument{fixed}\hlargument{=}\hlnumber{1}\hlkeyword{,}\hlargument{lower}\hlargument{=}\hlnumber{0.0}\hlkeyword{,}{\ }\hlargument{upper}\hlargument{=}\hlnumber{Inf}\hlkeyword{)}\hlkeyword{)}\hlkeyword{)}\mbox{}
\normalfont
\end{Hinput}


\end{normalsize}
\end{Hchunk}

\subsection{Kinetic model set up for water-sediment studies}


\begin{Hchunk}
\begin{normalsize}
\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlsymbol{a}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlfunctioncall{mkinmod.full}\hlkeyword{(}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlargument{parent}{\ }\hlargument{=}{\ }\hlfunctioncall{list}\hlkeyword{(}\hlargument{type}{\ }\hlargument{=}{\ }\hlstring{"SFO"}\hlkeyword{,}{\ }\hlargument{to}{\ }\hlargument{=}{\ }\hlfunctioncall{c}\hlkeyword{(}\hlstring{"A1"}\hlkeyword{,}{\ }\hlstring{"B1"}\hlkeyword{,}{\ }\hlstring{"C1"}\hlkeyword{)}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlargument{sink}{\ }\hlargument{=}{\ }\hlnumber{FALSE}\hlkeyword{)}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlargument{A1}{\ }\hlargument{=}{\ }\hlfunctioncall{list}\hlkeyword{(}\hlargument{type}{\ }\hlargument{=}{\ }\hlstring{"SFO"}\hlkeyword{,}{\ }\hlargument{to}{\ }\hlargument{=}{\ }\hlstring{"A2"}\hlkeyword{)}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlargument{B1}{\ }\hlargument{=}{\ }\hlfunctioncall{list}\hlkeyword{(}\hlargument{type}{\ }\hlargument{=}{\ }\hlstring{"SFO"}\hlkeyword{)}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlargument{C1}{\ }\hlargument{=}{\ }\hlfunctioncall{list}\hlkeyword{(}\hlargument{type}{\ }\hlargument{=}{\ }\hlstring{"SFO"}\hlkeyword{)}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlargument{A2}{\ }\hlargument{=}{\ }\hlfunctioncall{list}\hlkeyword{(}\hlargument{type}{\ }\hlargument{=}{\ }\hlstring{"SFO"}\hlkeyword{)}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlargument{inpartri}\hlargument{=}\hlstring{\usebox{\hlnormalsizeboxsinglequote}water-sediment\usebox{\hlnormalsizeboxsinglequote}}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlargument{outpartri}\hlargument{=}\hlstring{\usebox{\hlnormalsizeboxsinglequote}water-sediment\usebox{\hlnormalsizeboxsinglequote}}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlargument{data}\hlargument{=}\hlsymbol{schaefer07\usebox{\hlnormalsizeboxunderscore}complex\usebox{\hlnormalsizeboxunderscore}case}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlargument{weight}\hlargument{=}NULL\hlkeyword{)}\mbox{}
\normalfont
\end{Hinput}


\end{normalsize}
\end{Hchunk}

\subsection{Fitting the model}
\subsubsection{NLS}
\begin{Hchunk}
\begin{normalsize}
\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlsymbol{Fit}{\ }{\ }{\ }{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlfunctioncall{mkinfit.full}\hlkeyword{(}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlsymbol{complex}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlargument{plot}{\ }{\ }{\ }{\ }{\ }{\ }\hlargument{=}{\ }\hlnumber{TRUE}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlargument{quiet}{\ }{\ }{\ }{\ }{\ }\hlargument{=}{\ }\hlnumber{TRUE}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlargument{ctr}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlargument{=}{\ }\hlfunctioncall{kingui.control}\hlkeyword{(}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlargument{method}{\ }\hlargument{=}{\ }\hlstring{\usebox{\hlnormalsizeboxsinglequote}solnp\usebox{\hlnormalsizeboxsinglequote}}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlargument{submethod}{\ }\hlargument{=}{\ }\hlstring{\usebox{\hlnormalsizeboxsinglequote}Port\usebox{\hlnormalsizeboxsinglequote}}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlargument{maxIter}{\ }\hlargument{=}{\ }\hlnumber{100}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlargument{tolerance}{\ }\hlargument{=}{\ }\hlnumber{1E-06}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlargument{odesolver}{\ }\hlargument{=}{\ }\hlstring{\usebox{\hlnormalsizeboxsinglequote}lsoda\usebox{\hlnormalsizeboxsinglequote}}\hlkeyword{)}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlargument{irls.control}{\ }\hlargument{=}{\ }\hlfunctioncall{list}\hlkeyword{(}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlargument{maxIter}{\ }\hlargument{=}{\ }\hlnumber{10}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlargument{tolerance}{\ }\hlargument{=}{\ }\hlnumber{0.001}\hlkeyword{)}\hlkeyword{)}\mbox{}
\normalfont
\end{Hinput}


\end{normalsize}
\end{Hchunk}

\begin{Hchunk}
\begin{normalsize}
\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlfunctioncall{kinplot}\hlkeyword{(}\hlsymbol{Fit}\hlkeyword{)}\mbox{}
\normalfont
\end{Hinput}


\end{normalsize}
\end{Hchunk}

\begin{figure}
\begin{center}
\includegraphics[scale=0.5]{C:/Users/gbbfx/Work/Projects/Kinetics/KINGUI/package/workingcopy/DevSF/dev/doc/NLSfit.pdf}
\end{center}
\caption{Plot of fitting results using NLS}
\label{fig:one}
\end{figure}
\subsubsection{IRLS}
\begin{Hchunk}
\begin{normalsize}
\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlsymbol{Fit}{\ }{\ }{\ }{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlfunctioncall{IRLSkinfit.full}\hlkeyword{(}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlsymbol{complex}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlargument{plot}{\ }{\ }{\ }{\ }{\ }{\ }\hlargument{=}{\ }\hlnumber{TRUE}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlargument{quiet}{\ }{\ }{\ }{\ }{\ }\hlargument{=}{\ }\hlnumber{TRUE}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlargument{ctr}{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlargument{=}{\ }\hlfunctioncall{kingui.control}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlkeyword{(}\hlargument{method}{\ }\hlargument{=}{\ }\hlstring{\usebox{\hlnormalsizeboxsinglequote}solnp\usebox{\hlnormalsizeboxsinglequote}}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlargument{submethod}{\ }\hlargument{=}{\ }\hlstring{\usebox{\hlnormalsizeboxsinglequote}Port\usebox{\hlnormalsizeboxsinglequote}}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlargument{maxIter}{\ }\hlargument{=}{\ }\hlnumber{100}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlargument{tolerance}{\ }\hlargument{=}{\ }\hlnumber{1E-06}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlargument{odesolver}{\ }\hlargument{=}{\ }\hlstring{\usebox{\hlnormalsizeboxsinglequote}lsoda\usebox{\hlnormalsizeboxsinglequote}}\hlkeyword{)}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlargument{irls.control}{\ }\hlargument{=}{\ }\hlfunctioncall{list}\hlkeyword{(}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlargument{maxIter}{\ }\hlargument{=}{\ }\hlnumber{10}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlargument{tolerance}{\ }\hlargument{=}{\ }\hlnumber{0.001}\hlkeyword{)}\hlkeyword{)}\mbox{}
\normalfont
\end{Hinput}


\end{normalsize}
\end{Hchunk}

\subsubsection{MCMC}
\begin{Hchunk}
\begin{normalsize}
\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlsymbol{Fit}{\ }{\ }{\ }{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlfunctioncall{mcmckinfit.full}\hlkeyword{(}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlsymbol{complex}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlargument{plot}{\ }{\ }{\ }{\ }{\ }{\ }\hlargument{=}{\ }\hlnumber{TRUE}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlargument{quiet}{\ }{\ }{\ }{\ }{\ }\hlargument{=}{\ }\hlnumber{TRUE}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlargument{ctr}{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlargument{=}{\ }\hlfunctioncall{kingui.control}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlkeyword{(}\hlargument{method}{\ }\hlargument{=}{\ }\hlstring{\usebox{\hlnormalsizeboxsinglequote}solnp\usebox{\hlnormalsizeboxsinglequote}}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlargument{submethod}{\ }\hlargument{=}{\ }\hlstring{\usebox{\hlnormalsizeboxsinglequote}Port\usebox{\hlnormalsizeboxsinglequote}}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlargument{maxIter}{\ }\hlargument{=}{\ }\hlnumber{100}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlargument{tolerance}{\ }\hlargument{=}{\ }\hlnumber{1E-06}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlargument{odesolver}{\ }\hlargument{=}{\ }\hlstring{\usebox{\hlnormalsizeboxsinglequote}lsoda\usebox{\hlnormalsizeboxsinglequote}}\hlkeyword{)}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlargument{irls.control}{\ }\hlargument{=}{\ }\hlfunctioncall{list}\hlkeyword{(}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlargument{maxIter}{\ }\hlargument{=}{\ }\hlnumber{10}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlargument{tolerance}{\ }\hlargument{=}{\ }\hlnumber{0.001}\hlkeyword{)}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlargument{niter}\hlargument{=}\hlnumber{50000}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlargument{burninlength}{\ }\hlargument{=}{\ }\hlnumber{10000}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlargument{outputlength}\hlargument{=}\hlnumber{5000}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlkeyword{)}\mbox{}
\normalfont
\end{Hinput}


\end{normalsize}
\end{Hchunk}

\subsection{Summary and Report}
\begin{Hchunk}
\begin{normalsize}
\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlfunctioncall{list2ascii}\hlkeyword{(}\hlfunctioncall{summary}\hlkeyword{(}\hlsymbol{Fit}\hlkeyword{,}{\ }\hlargument{cov}{\ }\hlargument{=}{\ }\hlnumber{TRUE}\hlkeyword{,}\hlargument{version}\hlargument{=}\hlsymbol{version}\hlkeyword{)}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlstring{\usebox{\hlnormalsizeboxsinglequote}example.kgo\usebox{\hlnormalsizeboxsinglequote}}\hlkeyword{)}\mbox{}
\normalfont
\end{Hinput}


\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlfunctioncall{kingraph}\hlkeyword{(}\hlsymbol{Fit}\hlkeyword{,}\hlstring{\usebox{\hlnormalsizeboxsinglequote}example.kgg\usebox{\hlnormalsizeboxsinglequote}}\hlkeyword{)}\mbox{}
\normalfont
\end{Hinput}


\end{normalsize}
\end{Hchunk}



\section{Trouble Shooting}
\subsection{NAs occur in output standard error estimates}
In nonlinear models, however, noninvertible Hessians are related to
the shape of the posterior density, but how to connect the problem to
the question being analyzed can often be extremely difficult.
Reasons include:
\begin{itemize}
	\item Hessian not positive definite, all NAs. This is
          singularity, which occurs when the objective is flat near
          the mode, i.e. the objective function is a plateau or a flat
          line. It indicates the absense of information, and the
          estimates have infinite variance(1/H${\rightarrow}\infty$ as H ${\rightarrow}$ 0)

\item  Some NA entries $\Rightarrow$ When the Hessian invertable, but
  contains negative or 0 diagonal values. The optimization might get
  stuck on a saddle point, or not be able to fine any direction for improvement.
\item If the model seems to converge reasonably, but your output shows
  that some coefficients have (true) zero standard errors, this will
  almost always be because that
coefficient doesn’t actually affect the function value. Most commonly, this is just a
simple error of including a coefficient doesn’t appear in the
formula(s) being estimated. More subtly, it can be a parameter which
multiplies a series or subcalculation which takes a zero value.
\end{itemize}
\begin{figure}[hbtp]
\centering
\includegraphics[scale=0.3]{C:/Users/gbbfx/Work/Projects/Kinetics/KINGUI/package/workingcopy/DevSF/dev/doc/Saddle_point.png}
\caption{An example of a saddle point}
\end{figure}

Here is a simple example of going around the "NA problems". This is an output from a dataset provided by Gerald.

\begin{verbatim}
Optimised parameters:
                  Estimate Std. Error   Lower CI Upper CI   Pr(>t)
M0_Ipro          8.340e+01  2.088e+00  7.931e+01   87.489  < 2e-16 ***
k_Ipro           2.902e-02  1.983e-03  2.513e-02    0.033  < 2e-16 ***
k_PMPA           1.558e-02  2.918e-03  9.857e-03    0.021 6.39e-07 ***
k_NPMPA          3.227e-10         NA         NA       NA       NA
k_Amino          6.641e-07         NA         NA       NA       NA
f_Ipro_to_PMPA   6.812e-01  6.395e-02  5.558e-01    0.807 3.41e-16 ***
f_Ipro_to_NPMPA  9.381e-01  2.053e-01  5.358e-01    1.341 1.12e-05 ***
f_Ipro_to_Amino  9.996e-01  3.386e+00 -5.638e+00    7.637    0.384
f_NPMPA_to_PMPA  6.967e-01         NA         NA       NA       NA
\end{verbatim}
The two 'k' parameters with NA standard error are very close to 0 and the their
  variability will not affect the objective function as much. A quick thought would be fixing one of them to 0 and rerun the model. Redefine the pathways sometimes would help to solve the numerical problem.

\subsection{Choice of optimization algorithms}
The program mainly use \textbf{solnp}(a general non-linear optimization method using augmented lagrange multiplier) algorithm for optimization purpose. When the program generates insensible results or there are NAs in the report, the user should consider either changing the optimization method or tuning the control parameters for the selected algorithm.

\begin{itemize}
\item One probelm for \textbf{Rsolnp} is that it may get stuck in a saddlepoint/ridge for very low
values of delta for data of a certain scaling, which causes the inversion of the Hessian not available. Depending on the version of the package, the solver either catches these errors ( a status code of 2 indicate problems pertaining to the inversion of the Hessian and a code of 0 is locally optimal,
and 1 means that the maximum number of iterations was reached without
achieving the required tolerance ) and reports them or exit prematurely.

It will also return the parameters up to that point if possible, but it is suggested  not to use those parameters to restart the solver,
particularly if you are dealing with non-convex/non-smooth problems.
Instead, pertrube your original parameters slightly and use a different
delta/tol/rho combination.
\item LM
\end{itemize}
\appendix
\section{Package Structure}
We show a few of the function calling graphs in this section. Calling graphs for some other functions can be found in the \textsl{doc} folder.

The main functions in this package include \textbf{mkinmod.full} for setting up the kinetic model,  \textbf{mkinfit.full, IRLSkinfit.full, mcmckinfit.full} for fitting the kinetic model, \textbf{summary.kingui, summary.mcmckingui, kingraph} for preparing data for the tables and graphs in the final report.

Every compartment in the kinetic model is a list with components \textsl{type, to ,time, residue, sink,M0} and corresponding kinetic parameters for different model type and different study type. For example, we need \textsl{k, FF} for SFO model and \textsl{k1,k2, g, FF} for HS model . Some of the components can be missing in the input and \textbf{CompleteCompound} function will try to set them to default values or reporting an error. The  function \textbf{mkinmod.full} calls  \textbf{CompleteCompound} to set up the differiential equations or coefficient matrix to be used in the optimization objective function set up. It will in the same time do the tranformation from the true formation fraction to the "ff"s used for the constrained optimization.

In the next section we will show in detail, using \textbf{IRLSkinfit.full} as an example, how we fit the kinetic models.

The fitting functions will return an object of class \textsl{kingui} or \textsl{mcmckingui},then \textbf{summary} can be called for these classes using S3 method.

\begin{figure}[hbtp]
\centering
%\includegraphics[scale=0.5]{C:/Users/gbbfx/Work/Projects/Kinetics/KINGUI/package/workingcopy/DevSF/dev/doc/callgraphKinGUII.pdf}
\includegraphics[scale=0.5]{C:/Users/gbbfx/Work/Projects/Kinetics/KINGUI/package/workingcopy/DevSF/dev/doc/callgraphKinGUII.pdf}
\end{figure}

\begin{figure}[hbtp]
\centering
\includegraphics[scale=0.5]{C:/Users/gbbfx/Work/Projects/Kinetics/KINGUI/package/workingcopy/DevSF/dev/doc/callgraphmkinmodfull.pdf}
\end{figure}


\begin{figure}[hbtp]
\centering
\includegraphics[scale=0.5]{C:/Users/gbbfx/Work/Projects/Kinetics/KINGUI/package/workingcopy/DevSF/dev/doc/callIRLSkinfit.pdf}
\end{figure}

\begin{figure}[hbtp]
\centering
\includegraphics[scale=0.5]{C:/Users/gbbfx/Work/Projects/Kinetics/KINGUI/package/workingcopy/DevSF/dev/doc/callsummarykingui.pdf}
\end{figure}

\section{An example to explain the function structure}

We take one of the main functions \textbf{IRLSkinfit.full} as an example and try to explain what it does block by block. The basic structure of this function is shown in Figure \ref{IRLSmap}(\href{run:IRLSkinfitfullMap.pdf}{A larger file}, \href{run:IRLSkinfit.full.xmind}{Xmind file})
\begin{figure}[hbtp]
\centering
\includegraphics[scale=0.7]{C:/Users/gbbfx/Work/Projects/Kinetics/KINGUI/package/workingcopy/DevSF/dev/doc/IRLSkinfitfullMap.pdf}
\caption{IRLSkinfit.full XMind}
\label{IRLSmap}
\end{figure}

\begin{Hchunk}
\begin{normalsize}
\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlsymbol{IRLSkinfit.full}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlkeyword{function}\hlkeyword{(}\hlformalargs{mkinmodini}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }\hlformalargs{eigen}{\ }\hleqformalargs{=}{\ }\hlnumber{FALSE}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }\hlformalargs{plot}{\ }\hleqformalargs{=}{\ }\hlnumber{FALSE}\hlkeyword{,}{\ }\hlformalargs{plottitle}\hleqformalargs{=}\hlstring{\usebox{\hlnormalsizeboxsinglequote}\usebox{\hlnormalsizeboxsinglequote}}\hlkeyword{,}\hlformalargs{quiet}{\ }\hleqformalargs{=}{\ }\hlnumber{FALSE}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }\hlformalargs{err}{\ }\hleqformalargs{=}{\ }NULL\hlkeyword{,}{\ }\hlformalargs{weight}{\ }\hleqformalargs{=}{\ }\hlstring{"none"}\hlkeyword{,}{\ }\hlformalargs{scaleVar}{\ }\hleqformalargs{=}{\ }\hlnumber{FALSE}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }\hlformalargs{ctr}\hleqformalargs{=}\hlfunctioncall{kingui.control}\hlkeyword{(}\hlkeyword{)}\hlkeyword{,}\hlformalargs{irls.control}\hleqformalargs{=}\hlfunctioncall{list}\hlkeyword{(}\hlkeyword{)}\hlkeyword{,}\hlformalargs{update}\hleqformalargs{=}NULL\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }\hlformalargs{useHsolnp}\hleqformalargs{=}\hlnumber{FALSE}\hlkeyword{,}\hlformalargs{...}\hlkeyword{)}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}\hlkeyword{\usebox{\hlnormalsizeboxopenbrace}}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlcomment{\usebox{\hlnormalsizeboxhash}\usebox{\hlnormalsizeboxhash}...}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlcomment{\usebox{\hlnormalsizeboxhash}\usebox{\hlnormalsizeboxhash}{\ }This{\ }is{\ }the{\ }function{\ }definition{\ }with{\ }all{\ }the{\ }inputs.}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlcomment{\usebox{\hlnormalsizeboxhash}\usebox{\hlnormalsizeboxhash}{\ }Please{\ }find{\ }the{\ }help{\ }files{\ }for{\ }the{\ }explanation{\ }of{\ }all{\ }the{\ }arguments.}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}\hlkeyword{\usebox{\hlnormalsizeboxclosebrace}}\mbox{}
\normalfont
\end{Hinput}


\end{normalsize}
\end{Hchunk}


The first step is to set the model input and output parameter
settings, whether it is a normal case or a water-sediment study.

\begin{Hchunk}
\begin{normalsize}
\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlcomment{\usebox{\hlnormalsizeboxhash}\usebox{\hlnormalsizeboxhash}{\ }Get{\ }the{\ }parametrization{\ }for{\ }input{\ }and{\ }output.}\hspace*{\fill}\\
\hlstd{}\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlcomment{\usebox{\hlnormalsizeboxhash}\usebox{\hlnormalsizeboxhash}{\ }Whether{\ }it{\ }is{\ }in{\ }the{\ }normal{\ }or{\ }water-sediment{\ }study{\ }settings.}\hspace*{\fill}\\
\hlstd{}\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlsymbol{inpartri}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlsymbol{mkinmodini}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{inpartri}\mbox{}
\normalfont
\end{Hinput}


\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlsymbol{outpartri}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlsymbol{mkinmodini}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{outpartri}\mbox{}
\normalfont
\end{Hinput}


\end{normalsize}
\end{Hchunk}

\subsection{Control Parameters}
Next we set the control parameters for the ODE solver and the
optimization procedure.

\begin{Hchunk}
\begin{normalsize}
\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlcomment{\usebox{\hlnormalsizeboxhash}\usebox{\hlnormalsizeboxhash}{\ }\usebox{\hlnormalsizeboxhash}\usebox{\hlnormalsizeboxhash}{\ }Control{\ }parameters{\ }\usebox{\hlnormalsizeboxhash}\usebox{\hlnormalsizeboxhash}\usebox{\hlnormalsizeboxhash}\usebox{\hlnormalsizeboxhash}}\hspace*{\fill}\\
\hlstd{}\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlsymbol{method}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlsymbol{ctr}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{method}\mbox{}
\normalfont
\end{Hinput}


\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlsymbol{odesolver}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlsymbol{ctr}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{odesolver}\mbox{}
\normalfont
\end{Hinput}


\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlsymbol{atol}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlsymbol{ctr}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{atol}\mbox{}
\normalfont
\end{Hinput}


\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlsymbol{rtol}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlsymbol{ctr}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{rtol}\mbox{}
\normalfont
\end{Hinput}


\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlsymbol{control}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlsymbol{ctr}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{control}\mbox{}
\normalfont
\end{Hinput}


\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlsymbol{marqctr}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlsymbol{ctr}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{marqctr}\mbox{}
\normalfont
\end{Hinput}


\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlsymbol{goMarq}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlsymbol{ctr}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{goMarq}\mbox{}
\normalfont
\end{Hinput}


\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlsymbol{submethod}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlsymbol{ctr}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{submethod}\mbox{}
\normalfont
\end{Hinput}


\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlsymbol{Hmethod1}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlsymbol{ctr}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{Hmethod1}\mbox{}
\normalfont
\end{Hinput}


\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlsymbol{Hmethod2}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlsymbol{ctr}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{Hmethod2}\mbox{}
\normalfont
\end{Hinput}


\end{normalsize}
\end{Hchunk}

\newpage
Get the initial values, the parameters to be optimized and the fixed
ones.

\begin{Hchunk}
\begin{normalsize}
\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlsymbol{parms.ini}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlsymbol{mkinmodini}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{parms.ini}\mbox{}
\normalfont
\end{Hinput}


\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlsymbol{state.ini}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlsymbol{mkinmodini}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{state.ini}\mbox{}
\normalfont
\end{Hinput}


\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlsymbol{lower}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlsymbol{mkinmodini}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{lower}\mbox{}
\normalfont
\end{Hinput}


\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlsymbol{upper}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlsymbol{mkinmodini}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{upper}\mbox{}
\normalfont
\end{Hinput}


\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlsymbol{fixed\usebox{\hlnormalsizeboxunderscore}parms}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlsymbol{mkinmodini}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{fixed\usebox{\hlnormalsizeboxunderscore}parms}\mbox{}
\normalfont
\end{Hinput}


\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlsymbol{fixed\usebox{\hlnormalsizeboxunderscore}initials}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlsymbol{mkinmodini}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{fixed\usebox{\hlnormalsizeboxunderscore}initials}\mbox{}
\normalfont
\end{Hinput}


\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlsymbol{mod\usebox{\hlnormalsizeboxunderscore}vars}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlfunctioncall{names}\hlkeyword{(}\hlsymbol{mkinmodini}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{diffs}\hlkeyword{)}\mbox{}
\normalfont
\end{Hinput}


\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlsymbol{observed}\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}\hlfunctioncall{mkin\usebox{\hlnormalsizeboxunderscore}wide\usebox{\hlnormalsizeboxunderscore}to\usebox{\hlnormalsizeboxunderscore}long}\hlkeyword{(}\hlsymbol{mkinmodini}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{residue}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlargument{time}\hlargument{=}\hlstring{\usebox{\hlnormalsizeboxsinglequote}time\usebox{\hlnormalsizeboxsinglequote}}\hlkeyword{)}\mbox{}
\normalfont
\end{Hinput}


\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlsymbol{observed}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{err}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}\hlfunctioncall{c}\hlkeyword{(}\hlfunctioncall{as.matrix}\hlkeyword{(}\hlsymbol{mkinmodini}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{weightmat}\hlkeyword{)}\hlkeyword{)}\mbox{}
\normalfont
\end{Hinput}


\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlcomment{\usebox{\hlnormalsizeboxhash}\usebox{\hlnormalsizeboxhash}{\ }Subset{\ }dataframe{\ }with{\ }mapped{\ }(modelled){\ }variables}\hspace*{\fill}\\
\hlstd{}\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}{\ }{\ }{\ }{\ }\hlsymbol{observed}\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}\hlfunctioncall{subset}\hlkeyword{(}\hlsymbol{observed}\hlkeyword{,}\hlsymbol{name}{\ }\hlkeyword{\usebox{\hlnormalsizeboxpercent}in\usebox{\hlnormalsizeboxpercent}}{\ }\hlfunctioncall{names}\hlkeyword{(}\hlsymbol{mkinmodini}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{map}\hlkeyword{)}\hlkeyword{)}\mbox{}
\normalfont
\end{Hinput}


\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlcomment{\usebox{\hlnormalsizeboxhash}\usebox{\hlnormalsizeboxhash}{\ }Get{\ }names{\ }of{\ }observed{\ }variables}\hspace*{\fill}\\
\hlstd{}\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}{\ }{\ }{\ }{\ }\hlcomment{\usebox{\hlnormalsizeboxhash}\usebox{\hlnormalsizeboxhash}{\ }NOTE{\ }HERE:{\ }the{\ }order{\ }may{\ }not{\ }be{\ }the{\ }same{\ }as{\ }the{\ }input{\ }mkinmod.full{\ }differential{\ }equations{\ }list.}\hspace*{\fill}\\
\hlstd{}\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}{\ }{\ }{\ }{\ }\hlsymbol{obs\usebox{\hlnormalsizeboxunderscore}vars}{\ }\hlassignement{=}{\ }\hlfunctioncall{unique}\hlkeyword{(}\hlfunctioncall{as.character}\hlkeyword{(}\hlsymbol{observed}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{name}\hlkeyword{)}\hlkeyword{)}\mbox{}
\normalfont
\end{Hinput}


\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlcomment{\usebox{\hlnormalsizeboxhash}\usebox{\hlnormalsizeboxhash}{\ }Name{\ }the{\ }parameters{\ }if{\ }they{\ }are{\ }not{\ }named{\ }yet}\hspace*{\fill}\\
\hlstd{}\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}{\ }{\ }{\ }{\ }\hlcomment{\usebox{\hlnormalsizeboxhash}\usebox{\hlnormalsizeboxhash}{\ }usually{\ }they{\ }are{\ }already{\ }names}\hspace*{\fill}\\
\hlstd{}\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}{\ }{\ }{\ }{\ }\hlkeyword{if}\hlkeyword{(}\hlfunctioncall{is.null}\hlkeyword{(}\hlfunctioncall{names}\hlkeyword{(}\hlsymbol{parms.ini}\hlkeyword{)}\hlkeyword{)}\hlkeyword{)}{\ }\hlfunctioncall{names}\hlkeyword{(}\hlsymbol{parms.ini}\hlkeyword{)}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlsymbol{mkinmodini}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{parms}\mbox{}
\normalfont
\end{Hinput}


\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlkeyword{if}\hlkeyword{(}\hlfunctioncall{is.null}\hlkeyword{(}\hlfunctioncall{names}\hlkeyword{(}\hlsymbol{state.ini}\hlkeyword{)}\hlkeyword{)}\hlkeyword{)}{\ }\hlfunctioncall{names}\hlkeyword{(}\hlsymbol{state.ini}\hlkeyword{)}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlsymbol{mod\usebox{\hlnormalsizeboxunderscore}vars}\mbox{}
\normalfont
\end{Hinput}


\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlcomment{\usebox{\hlnormalsizeboxhash}\usebox{\hlnormalsizeboxhash}{\ }Seperate{\ }parameters{\ }to{\ }be{\ }optimised{\ }and{\ }fixed}\hspace*{\fill}\\
\hlstd{}\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}{\ }{\ }{\ }{\ }\hlsymbol{parms.fixed}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlsymbol{parms.ini}\hlkeyword{[}\hlsymbol{fixed\usebox{\hlnormalsizeboxunderscore}parms}\hlkeyword{]}\mbox{}
\normalfont
\end{Hinput}


\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlsymbol{optim\usebox{\hlnormalsizeboxunderscore}parms}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlfunctioncall{setdiff}\hlkeyword{(}\hlfunctioncall{names}\hlkeyword{(}\hlsymbol{parms.ini}\hlkeyword{)}\hlkeyword{,}{\ }\hlsymbol{fixed\usebox{\hlnormalsizeboxunderscore}parms}\hlkeyword{)}\mbox{}
\normalfont
\end{Hinput}


\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlsymbol{parms.optim}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlsymbol{parms.ini}\hlkeyword{[}\hlsymbol{optim\usebox{\hlnormalsizeboxunderscore}parms}\hlkeyword{]}\mbox{}
\normalfont
\end{Hinput}


\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlsymbol{state.ini.fixed}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlsymbol{state.ini}\hlkeyword{[}\hlsymbol{fixed\usebox{\hlnormalsizeboxunderscore}initials}\hlkeyword{]}\mbox{}
\normalfont
\end{Hinput}


\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlsymbol{optim\usebox{\hlnormalsizeboxunderscore}initials}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlfunctioncall{setdiff}\hlkeyword{(}\hlfunctioncall{names}\hlkeyword{(}\hlsymbol{state.ini}\hlkeyword{)}\hlkeyword{,}{\ }\hlsymbol{fixed\usebox{\hlnormalsizeboxunderscore}initials}\hlkeyword{)}\mbox{}
\normalfont
\end{Hinput}


\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlsymbol{state.ini.optim}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlsymbol{state.ini}\hlkeyword{[}\hlsymbol{optim\usebox{\hlnormalsizeboxunderscore}initials}\hlkeyword{]}\mbox{}
\normalfont
\end{Hinput}


\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlsymbol{state.ini.optim.boxnames}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlfunctioncall{names}\hlkeyword{(}\hlsymbol{state.ini.optim}\hlkeyword{)}\mbox{}
\normalfont
\end{Hinput}


\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlsymbol{state.ini.fixed.boxnames}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlfunctioncall{names}\hlkeyword{(}\hlsymbol{state.ini.fixed}\hlkeyword{)}\mbox{}
\normalfont
\end{Hinput}


\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlkeyword{if}\hlkeyword{(}\hlfunctioncall{length}\hlkeyword{(}\hlsymbol{state.ini.optim}\hlkeyword{)}{\ }\hlkeyword{\usebox{\hlnormalsizeboxgreaterthan}}{\ }\hlnumber{0}\hlkeyword{)}{\ }\hlkeyword{\usebox{\hlnormalsizeboxopenbrace}}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlfunctioncall{names}\hlkeyword{(}\hlsymbol{state.ini.optim}\hlkeyword{)}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlfunctioncall{paste}\hlkeyword{(}\hlstring{\usebox{\hlnormalsizeboxsinglequote}M0\usebox{\hlnormalsizeboxsinglequote}}\hlkeyword{,}\hlfunctioncall{names}\hlkeyword{(}\hlsymbol{state.ini.optim}\hlkeyword{)}\hlkeyword{,}\hlargument{sep}\hlargument{=}\hlstring{"\usebox{\hlnormalsizeboxunderscore}"}\hlkeyword{)}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlkeyword{\usebox{\hlnormalsizeboxclosebrace}}\mbox{}
\normalfont
\end{Hinput}


\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlkeyword{if}\hlkeyword{(}\hlfunctioncall{length}\hlkeyword{(}\hlsymbol{state.ini.fixed}\hlkeyword{)}{\ }\hlkeyword{\usebox{\hlnormalsizeboxgreaterthan}}{\ }\hlnumber{0}\hlkeyword{)}{\ }\hlkeyword{\usebox{\hlnormalsizeboxopenbrace}}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlfunctioncall{names}\hlkeyword{(}\hlsymbol{state.ini.fixed}\hlkeyword{)}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlfunctioncall{paste}\hlkeyword{(}\hlstring{\usebox{\hlnormalsizeboxsinglequote}M0\usebox{\hlnormalsizeboxsinglequote}}\hlkeyword{,}\hlfunctioncall{names}\hlkeyword{(}\hlsymbol{state.ini.fixed}\hlkeyword{)}\hlkeyword{,}\hlargument{sep}\hlargument{=}\hlstring{"\usebox{\hlnormalsizeboxunderscore}"}\hlkeyword{)}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlkeyword{\usebox{\hlnormalsizeboxclosebrace}}\mbox{}
\normalfont
\end{Hinput}


\end{normalsize}
\end{Hchunk}


If updating from previous fit or new starting point manually set by
the user, then just switch the starting values for the parameters to
be optimized. The user can change the control parameters for the ODE
solver and the optimzation algorithm as well.

\begin{Hchunk}
\begin{normalsize}
\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlcomment{\usebox{\hlnormalsizeboxhash}\usebox{\hlnormalsizeboxhash}{\ }\usebox{\hlnormalsizeboxhash}{\ }If{\ }updating{\ }from{\ }previous{\ }fit{\ }or{\ }new{\ }starting{\ }point.\usebox{\hlnormalsizeboxhash}\usebox{\hlnormalsizeboxhash}\usebox{\hlnormalsizeboxhash}\usebox{\hlnormalsizeboxhash}}\hspace*{\fill}\\
\hlstd{}\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}{\ }{\ }{\ }{\ }\hlkeyword{if}\hlkeyword{(}\hlkeyword{!}\hlfunctioncall{is.null}\hlkeyword{(}\hlsymbol{update}\hlkeyword{)}\hlkeyword{)}\hlkeyword{\usebox{\hlnormalsizeboxopenbrace}}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }\hlcomment{\usebox{\hlnormalsizeboxhash}\usebox{\hlnormalsizeboxhash}{\ }update{\ }can{\ }be{\ }a{\ }fit{\ }object{\ }from{\ }a{\ }previous{\ }fit{\ }or{\ }defined{\ }by{\ }the{\ }user{\ }manually.}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }\hlsymbol{parms.optim}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlsymbol{update}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{par}\hlkeyword{[}\hlsymbol{optim\usebox{\hlnormalsizeboxunderscore}parms}\hlkeyword{]}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }\hlsymbol{state.ini.optim}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}\hlsymbol{update}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{par}\hlkeyword{[}\hlfunctioncall{names}\hlkeyword{(}\hlsymbol{state.ini.optim}\hlkeyword{)}\hlkeyword{]}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }\hlkeyword{if}\hlkeyword{(}\hlkeyword{!}\hlfunctioncall{is.null}\hlkeyword{(}\hlsymbol{update}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{ctr}\hlkeyword{)}\hlkeyword{)}\hlkeyword{\usebox{\hlnormalsizeboxopenbrace}}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlsymbol{ctr}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlsymbol{update}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{ctr}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlcomment{\usebox{\hlnormalsizeboxhash}\usebox{\hlnormalsizeboxhash}{\ }Control{\ }parameters{\ }\usebox{\hlnormalsizeboxhash}\usebox{\hlnormalsizeboxhash}\usebox{\hlnormalsizeboxhash}\usebox{\hlnormalsizeboxhash}}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlsymbol{method}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlsymbol{ctr}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{method}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlsymbol{odesolver}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlsymbol{ctr}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{odesolver}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlsymbol{atol}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlsymbol{ctr}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{atol}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlsymbol{rtol}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlsymbol{ctr}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{rtol}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlsymbol{control}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlsymbol{ctr}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{control}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }\hlkeyword{\usebox{\hlnormalsizeboxclosebrace}}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }\hlkeyword{\usebox{\hlnormalsizeboxclosebrace}}\mbox{}
\normalfont
\end{Hinput}


\end{normalsize}
\end{Hchunk}


Decide whether to use analytical solutions or the default numerical
ODE solver for the ODE system.

\begin{Hchunk}
\begin{normalsize}
\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlkeyword{if}{\ }\hlkeyword{(}\hlfunctioncall{length}\hlkeyword{(}\hlsymbol{mkinmodini}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{map}\hlkeyword{)}{\ }=={\ }\hlnumber{1}\hlkeyword{)}{\ }\hlkeyword{\usebox{\hlnormalsizeboxopenbrace}}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlsymbol{solution}{\ }\hlassignement{=}{\ }\hlstring{"analytical"}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlkeyword{\usebox{\hlnormalsizeboxclosebrace}}{\ }\hlkeyword{else}{\ }\hlkeyword{\usebox{\hlnormalsizeboxopenbrace}}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlkeyword{if}{\ }\hlkeyword{(}\hlfunctioncall{is.matrix}\hlkeyword{(}\hlsymbol{mkinmodini}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{coefmat}\hlkeyword{)}{\ }\hlkeyword{\usebox{\hlnormalsizeboxand}}{\ }\hlsymbol{eigen}\hlkeyword{)}{\ }\hlsymbol{solution}{\ }\hlassignement{=}{\ }\hlstring{"eigen"}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlkeyword{else}{\ }\hlsymbol{solution}{\ }\hlassignement{=}{\ }\hlstring{"deSolve"}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlkeyword{\usebox{\hlnormalsizeboxclosebrace}}\mbox{}
\normalfont
\end{Hinput}


\end{normalsize}
\end{Hchunk}


\begin{Hchunk}
\begin{normalsize}
\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlcomment{\usebox{\hlnormalsizeboxhash}\usebox{\hlnormalsizeboxhash}{\ }Create{\ }a{\ }function{\ }calculating{\ }the{\ }differentials{\ }specified{\ }by{\ }the{\ }model}\hspace*{\fill}\\
\hlstd{}\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlcomment{\usebox{\hlnormalsizeboxhash}\usebox{\hlnormalsizeboxhash}{\ }if{\ }necessary.}\hspace*{\fill}\\
\hlstd{}\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlcomment{\usebox{\hlnormalsizeboxhash}\usebox{\hlnormalsizeboxhash}{\ }This{\ }function{\ }definition{\ }is{\ }the{\ }same{\ }for{\ }all{\ }kinds{\ }parametrization{\ }!!}\hspace*{\fill}\\
\hlstd{}\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlkeyword{if}\hlkeyword{(}\hlsymbol{solution}{\ }=={\ }\hlstring{"deSolve"}\hlkeyword{)}{\ }\hlkeyword{\usebox{\hlnormalsizeboxopenbrace}}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlsymbol{mkindiff}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlkeyword{function}\hlkeyword{(}\hlformalargs{t}\hlkeyword{,}{\ }\hlformalargs{state}\hlkeyword{,}{\ }\hlformalargs{parms}\hlkeyword{)}{\ }\hlkeyword{\usebox{\hlnormalsizeboxopenbrace}}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlsymbol{time}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlsymbol{t}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlsymbol{diffs}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlfunctioncall{vector}\hlkeyword{(}\hlkeyword{)}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlkeyword{for}{\ }\hlkeyword{(}\hlsymbol{box}{\ }\hlkeyword{in}{\ }\hlsymbol{mod\usebox{\hlnormalsizeboxunderscore}vars}\hlkeyword{)}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlkeyword{\usebox{\hlnormalsizeboxopenbrace}}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlsymbol{diffname}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlfunctioncall{paste}\hlkeyword{(}\hlstring{"d"}\hlkeyword{,}{\ }\hlsymbol{box}\hlkeyword{,}{\ }\hlargument{sep}\hlargument{=}\hlstring{"\usebox{\hlnormalsizeboxunderscore}"}\hlkeyword{)}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlsymbol{diffs}\hlkeyword{[}\hlsymbol{diffname}\hlkeyword{]}\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}\hlfunctioncall{with}\hlkeyword{(}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlfunctioncall{as.list}\hlkeyword{(}\hlfunctioncall{c}\hlkeyword{(}\hlsymbol{time}\hlkeyword{,}\hlsymbol{state}\hlkeyword{,}\hlsymbol{parms}\hlkeyword{)}\hlkeyword{)}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlfunctioncall{eval}\hlkeyword{(}\hlfunctioncall{parse}\hlkeyword{(}\hlargument{text}\hlargument{=}\hlsymbol{mkinmodini}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{diffs}\hlkeyword{[[}\hlsymbol{box}\hlkeyword{]}\hlkeyword{]}\hlkeyword{)}\hlkeyword{)}\hlkeyword{)}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlkeyword{\usebox{\hlnormalsizeboxclosebrace}}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlfunctioncall{return}\hlkeyword{(}\hlfunctioncall{list}\hlkeyword{(}\hlfunctioncall{c}\hlkeyword{(}\hlsymbol{diffs}\hlkeyword{)}\hlkeyword{)}\hlkeyword{)}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlkeyword{\usebox{\hlnormalsizeboxclosebrace}}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}\hlkeyword{\usebox{\hlnormalsizeboxclosebrace}}\mbox{}
\normalfont
\end{Hinput}


\end{normalsize}
\end{Hchunk}

\subsection{Set up the objective function for optimization}

Inside the \textbf{IRLSkinfit.full} function, we define a
\textbf{cost} function.

\begin{Hchunk}
\begin{normalsize}
\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlcomment{\usebox{\hlnormalsizeboxhash}\usebox{\hlnormalsizeboxhash}{\ }Define{\ }the{\ }model{\ }cost{\ }function,{\ }should{\ }be{\ }the{\ }same{\ }for{\ }all{\ }kinds{\ }of{\ }optimization{\ }\usebox{\hlnormalsizeboxhash}\usebox{\hlnormalsizeboxhash}}\hspace*{\fill}\\
\hlstd{}\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}{\ }{\ }{\ }{\ }\hlsymbol{cost}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlkeyword{function}\hlkeyword{(}\hlformalargs{P}\hlkeyword{)}\hlkeyword{\usebox{\hlnormalsizeboxopenbrace}}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlcomment{\usebox{\hlnormalsizeboxhash}\usebox{\hlnormalsizeboxhash}{\ }omitted{\ }here,{\ }we{\ }explain{\ }it{\ }in{\ }section{\ }A.1}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlkeyword{\usebox{\hlnormalsizeboxclosebrace}}\mbox{}
\normalfont
\end{Hinput}


\end{normalsize}
\end{Hchunk}


Here we describe this internal function block by block.

First we need to get the initial values for the ODE system, set the
time sequence for which output is wanted. The differential equations
are defined by \textbf{mkindiff} function.

\begin{Hchunk}
\begin{normalsize}
\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlcomment{\usebox{\hlnormalsizeboxhash}\usebox{\hlnormalsizeboxhash}names(P){\ }\usebox{\hlnormalsizeboxlessthan}-{\ }pnames}\hspace*{\fill}\\
\hlstd{}\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlfunctioncall{assign}\hlkeyword{(}\hlstring{"calls"}\hlkeyword{,}{\ }\hlsymbol{calls}\hlkeyword{+}\hlnumber{1}\hlkeyword{,}{\ }\hlargument{inherits}\hlargument{=}\hlnumber{TRUE}\hlkeyword{)}\mbox{}
\normalfont
\end{Hinput}


\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlkeyword{if}\hlkeyword{(}\hlfunctioncall{length}\hlkeyword{(}\hlsymbol{state.ini.optim}\hlkeyword{)}{\ }\hlkeyword{\usebox{\hlnormalsizeboxgreaterthan}}{\ }\hlnumber{0}\hlkeyword{)}{\ }\hlkeyword{\usebox{\hlnormalsizeboxopenbrace}}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlsymbol{odeini}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlfunctioncall{c}\hlkeyword{(}\hlsymbol{P}\hlkeyword{[}\hlnumber{1}\hlkeyword{:}\hlfunctioncall{length}\hlkeyword{(}\hlsymbol{state.ini.optim}\hlkeyword{)}\hlkeyword{]}\hlkeyword{,}{\ }\hlsymbol{state.ini.fixed}\hlkeyword{)}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlfunctioncall{names}\hlkeyword{(}\hlsymbol{odeini}\hlkeyword{)}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlfunctioncall{c}\hlkeyword{(}\hlsymbol{state.ini.optim.boxnames}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlsymbol{state.ini.fixed.boxnames}\hlkeyword{)}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}\hlkeyword{\usebox{\hlnormalsizeboxclosebrace}}{\ }\hlkeyword{else}{\ }\hlkeyword{\usebox{\hlnormalsizeboxopenbrace}}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlsymbol{odeini}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlsymbol{state.ini.fixed}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlfunctioncall{names}\hlkeyword{(}\hlsymbol{odeini}\hlkeyword{)}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlfunctioncall{c}\hlkeyword{(}{\ }\hlsymbol{state.ini.fixed.boxnames}\hlkeyword{)}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}\hlkeyword{\usebox{\hlnormalsizeboxclosebrace}}\mbox{}
\normalfont
\end{Hinput}


\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlcomment{\usebox{\hlnormalsizeboxhash}\usebox{\hlnormalsizeboxhash}{\ }has{\ }to{\ }change{\ }the{\ }odeini{\ }order{\ }since{\ }it{\ }is{\ }different{\ }from{\ }the{\ }mod\usebox{\hlnormalsizeboxunderscore}vars{\ }order.}\hspace*{\fill}\\
\hlstd{}\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlsymbol{odeini}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlsymbol{odeini}\hlkeyword{[}\hlsymbol{mod\usebox{\hlnormalsizeboxunderscore}vars}\hlkeyword{]}\mbox{}
\normalfont
\end{Hinput}


\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlsymbol{odeparms}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlfunctioncall{c}\hlkeyword{(}\hlsymbol{P}\hlkeyword{[}\hlkeyword{(}\hlfunctioncall{length}\hlkeyword{(}\hlsymbol{state.ini.optim}\hlkeyword{)}{\ }\hlkeyword{+}{\ }\hlnumber{1}\hlkeyword{)}\hlkeyword{:}\hlfunctioncall{length}\hlkeyword{(}\hlsymbol{P}\hlkeyword{)}\hlkeyword{]}\hlkeyword{,}{\ }\hlsymbol{parms.fixed}\hlkeyword{)}\mbox{}
\normalfont
\end{Hinput}


\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlsymbol{outtimes}{\ }\hlassignement{=}{\ }\hlfunctioncall{unique}\hlkeyword{(}\hlsymbol{observed}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{time}\hlkeyword{)}\mbox{}
\normalfont
\end{Hinput}


\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlsymbol{evalparse}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlkeyword{function}\hlkeyword{(}\hlformalargs{string}\hlkeyword{)}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}\hlkeyword{\usebox{\hlnormalsizeboxopenbrace}}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlfunctioncall{eval}\hlkeyword{(}\hlfunctioncall{parse}\hlkeyword{(}\hlargument{text}\hlargument{=}\hlsymbol{string}\hlkeyword{)}\hlkeyword{,}{\ }\hlfunctioncall{as.list}\hlkeyword{(}\hlfunctioncall{c}\hlkeyword{(}\hlsymbol{odeparms}\hlkeyword{,}{\ }\hlsymbol{odeini}\hlkeyword{)}\hlkeyword{)}\hlkeyword{)}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}\hlkeyword{\usebox{\hlnormalsizeboxclosebrace}}\mbox{}
\normalfont
\end{Hinput}


\end{normalsize}
\end{Hchunk}


When there is only one substance, the program will automatically
choose to use the analytical solution by calling the
\textbf{type.solution}(e.g,
\textbf{SFO.solution}) function.

\begin{Hchunk}
\begin{normalsize}
\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlcomment{\usebox{\hlnormalsizeboxhash}\usebox{\hlnormalsizeboxhash}{\ }Solve{\ }the{\ }system}\hspace*{\fill}\\
\hlstd{}\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlkeyword{if}{\ }\hlkeyword{(}\hlsymbol{solution}{\ }=={\ }\hlstring{"analytical"}\hlkeyword{)}{\ }\hlkeyword{\usebox{\hlnormalsizeboxopenbrace}}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlsymbol{parent.type}{\ }\hlassignement{=}{\ }\hlfunctioncall{names}\hlkeyword{(}\hlsymbol{mkinmodini}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{map}\hlkeyword{[[}\hlnumber{1}\hlkeyword{]}\hlkeyword{]}\hlkeyword{)}\hlkeyword{[}\hlnumber{1}\hlkeyword{]}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlsymbol{parent.name}{\ }\hlassignement{=}{\ }\hlfunctioncall{names}\hlkeyword{(}\hlsymbol{mkinmodini}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{diffs}\hlkeyword{)}\hlkeyword{[[}\hlnumber{1}\hlkeyword{]}\hlkeyword{]}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlsymbol{o}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlfunctioncall{switch}\hlkeyword{(}\hlsymbol{parent.type}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlargument{SFO}{\ }\hlargument{=}{\ }\hlfunctioncall{SFO.solution}\hlkeyword{(}\hlsymbol{outtimes}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlfunctioncall{evalparse}\hlkeyword{(}\hlsymbol{parent.name}\hlkeyword{)}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlfunctioncall{evalparse}\hlkeyword{(}\hlfunctioncall{paste}\hlkeyword{(}\hlstring{"k"}\hlkeyword{,}{\ }\hlsymbol{parent.name}\hlkeyword{,}{\ }{\ }\hlargument{sep}\hlargument{=}\hlstring{"\usebox{\hlnormalsizeboxunderscore}"}\hlkeyword{)}\hlkeyword{)}\hlkeyword{)}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlargument{FOMC}{\ }\hlargument{=}{\ }\hlfunctioncall{FOMC.solution}\hlkeyword{(}\hlsymbol{outtimes}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlfunctioncall{evalparse}\hlkeyword{(}\hlsymbol{parent.name}\hlkeyword{)}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlfunctioncall{evalparse}\hlkeyword{(}\hlfunctioncall{paste}\hlkeyword{(}\hlstring{"alpha"}\hlkeyword{,}{\ }\hlsymbol{parent.name}\hlkeyword{,}{\ }{\ }\hlargument{sep}\hlargument{=}\hlstring{"\usebox{\hlnormalsizeboxunderscore}"}\hlkeyword{)}\hlkeyword{)}\hlkeyword{,}{\ }\hlfunctioncall{evalparse}\hlkeyword{(}\hlfunctioncall{paste}\hlkeyword{(}\hlstring{"beta"}\hlkeyword{,}{\ }\hlsymbol{parent.name}\hlkeyword{,}{\ }{\ }\hlargument{sep}\hlargument{=}\hlstring{"\usebox{\hlnormalsizeboxunderscore}"}\hlkeyword{)}\hlkeyword{)}\hlkeyword{)}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlargument{DFOP}{\ }\hlargument{=}{\ }\hlfunctioncall{DFOP.solution}\hlkeyword{(}\hlsymbol{outtimes}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlfunctioncall{evalparse}\hlkeyword{(}\hlsymbol{parent.name}\hlkeyword{)}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlfunctioncall{evalparse}\hlkeyword{(}\hlfunctioncall{paste}\hlkeyword{(}\hlstring{"k1"}\hlkeyword{,}{\ }\hlsymbol{parent.name}\hlkeyword{,}{\ }{\ }\hlargument{sep}\hlargument{=}\hlstring{"\usebox{\hlnormalsizeboxunderscore}"}\hlkeyword{)}\hlkeyword{)}\hlkeyword{,}{\ }\hlfunctioncall{evalparse}\hlkeyword{(}\hlfunctioncall{paste}\hlkeyword{(}\hlstring{"k2"}\hlkeyword{,}{\ }\hlsymbol{parent.name}\hlkeyword{,}{\ }{\ }\hlargument{sep}\hlargument{=}\hlstring{"\usebox{\hlnormalsizeboxunderscore}"}\hlkeyword{)}\hlkeyword{)}\hlkeyword{,}\hlfunctioncall{evalparse}\hlkeyword{(}\hlfunctioncall{paste}\hlkeyword{(}\hlstring{"g"}\hlkeyword{,}{\ }\hlsymbol{parent.name}\hlkeyword{,}{\ }{\ }\hlargument{sep}\hlargument{=}\hlstring{"\usebox{\hlnormalsizeboxunderscore}"}\hlkeyword{)}\hlkeyword{)}\hlkeyword{)}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlargument{HS}{\ }\hlargument{=}{\ }\hlfunctioncall{HS.solution}\hlkeyword{(}\hlsymbol{outtimes}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlfunctioncall{evalparse}\hlkeyword{(}\hlsymbol{parent.name}\hlkeyword{)}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlfunctioncall{evalparse}\hlkeyword{(}\hlfunctioncall{paste}\hlkeyword{(}\hlstring{"k1"}\hlkeyword{,}{\ }\hlsymbol{parent.name}\hlkeyword{,}{\ }{\ }\hlargument{sep}\hlargument{=}\hlstring{"\usebox{\hlnormalsizeboxunderscore}"}\hlkeyword{)}\hlkeyword{)}\hlkeyword{,}\hlfunctioncall{evalparse}\hlkeyword{(}\hlfunctioncall{paste}\hlkeyword{(}\hlstring{"k2"}\hlkeyword{,}{\ }\hlsymbol{parent.name}\hlkeyword{,}{\ }{\ }\hlargument{sep}\hlargument{=}\hlstring{"\usebox{\hlnormalsizeboxunderscore}"}\hlkeyword{)}\hlkeyword{)}\hlkeyword{,}\hlfunctioncall{evalparse}\hlkeyword{(}\hlfunctioncall{paste}\hlkeyword{(}\hlstring{"tb"}\hlkeyword{,}{\ }\hlsymbol{parent.name}\hlkeyword{,}{\ }{\ }\hlargument{sep}\hlargument{=}\hlstring{"\usebox{\hlnormalsizeboxunderscore}"}\hlkeyword{)}\hlkeyword{)}\hlkeyword{)}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlargument{SFORB}{\ }\hlargument{=}{\ }\hlfunctioncall{SFORB.solution}\hlkeyword{(}\hlsymbol{outtimes}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlfunctioncall{evalparse}\hlkeyword{(}\hlsymbol{parent.name}\hlkeyword{)}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlfunctioncall{evalparse}\hlkeyword{(}\hlfunctioncall{paste}\hlkeyword{(}\hlstring{"k"}\hlkeyword{,}{\ }\hlsymbol{parent.name}\hlkeyword{,}{\ }\hlstring{"bound"}\hlkeyword{,}{\ }\hlargument{sep}\hlargument{=}\hlstring{"\usebox{\hlnormalsizeboxunderscore}"}\hlkeyword{)}\hlkeyword{)}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlfunctioncall{evalparse}\hlkeyword{(}\hlfunctioncall{paste}\hlkeyword{(}\hlstring{"k"}\hlkeyword{,}{\ }\hlfunctioncall{sub}\hlkeyword{(}\hlstring{"free"}\hlkeyword{,}{\ }\hlstring{"bound"}\hlkeyword{,}{\ }\hlsymbol{parent.name}\hlkeyword{)}\hlkeyword{,}{\ }\hlstring{"free"}\hlkeyword{,}{\ }\hlargument{sep}\hlargument{=}\hlstring{"\usebox{\hlnormalsizeboxunderscore}"}\hlkeyword{)}\hlkeyword{)}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlfunctioncall{evalparse}\hlkeyword{(}\hlfunctioncall{paste}\hlkeyword{(}\hlstring{"k"}\hlkeyword{,}{\ }\hlsymbol{parent.name}\hlkeyword{,}{\ }\hlstring{"sink"}\hlkeyword{,}{\ }\hlargument{sep}\hlargument{=}\hlstring{"\usebox{\hlnormalsizeboxunderscore}"}\hlkeyword{)}\hlkeyword{)}\hlkeyword{)}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlkeyword{)}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlsymbol{out}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlfunctioncall{cbind}\hlkeyword{(}\hlsymbol{outtimes}\hlkeyword{,}{\ }\hlsymbol{o}\hlkeyword{)}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlfunctioncall{dimnames}\hlkeyword{(}\hlsymbol{out}\hlkeyword{)}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlfunctioncall{list}\hlkeyword{(}\hlsymbol{outtimes}\hlkeyword{,}{\ }\hlfunctioncall{c}\hlkeyword{(}\hlstring{"time"}\hlkeyword{,}{\ }\hlfunctioncall{sub}\hlkeyword{(}\hlstring{"\usebox{\hlnormalsizeboxunderscore}free"}\hlkeyword{,}{\ }\hlstring{""}\hlkeyword{,}{\ }\hlsymbol{parent.name}\hlkeyword{)}\hlkeyword{)}\hlkeyword{)}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlkeyword{\usebox{\hlnormalsizeboxclosebrace}}\mbox{}
\normalfont
\end{Hinput}


\end{normalsize}
\end{Hchunk}


If the user manually sets \textbf{eigen=TRUE}, then the program use
the \textsl{coefmat} derived from \textbf{mkinmod.full} to solve the
ODE system.

\begin{Hchunk}
\begin{normalsize}
\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlkeyword{if}{\ }\hlkeyword{(}\hlsymbol{solution}{\ }=={\ }\hlstring{"eigen"}\hlkeyword{)}{\ }\hlkeyword{\usebox{\hlnormalsizeboxopenbrace}}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlsymbol{coefmat.num}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlfunctioncall{matrix}\hlkeyword{(}\hlfunctioncall{sapply}\hlkeyword{(}\hlfunctioncall{as.vector}\hlkeyword{(}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlsymbol{mkinmodini}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{coefmat}\hlkeyword{)}\hlkeyword{,}{\ }\hlsymbol{evalparse}\hlkeyword{)}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlargument{nrow}{\ }\hlargument{=}{\ }\hlfunctioncall{length}\hlkeyword{(}\hlsymbol{mod\usebox{\hlnormalsizeboxunderscore}vars}\hlkeyword{)}\hlkeyword{)}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlsymbol{e}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlfunctioncall{eigen}\hlkeyword{(}\hlsymbol{coefmat.num}\hlkeyword{)}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlsymbol{zz.ev}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlsymbol{e}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{values}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlkeyword{if}\hlkeyword{(}\hlfunctioncall{min}\hlkeyword{(}\hlsymbol{zz.ev}\hlkeyword{)}\hlkeyword{[}\hlnumber{1}\hlkeyword{]}\hlkeyword{\usebox{\hlnormalsizeboxlessthan}}\hlnumber{0}\hlkeyword{)}\hlkeyword{\usebox{\hlnormalsizeboxopenbrace}}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlcomment{\usebox{\hlnormalsizeboxhash}\usebox{\hlnormalsizeboxhash}{\ }in{\ }this{\ }case{\ }cannot{\ }use{\ }the{\ }eigen{\ }solution}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlfunctioncall{warning}\hlkeyword{(}\hlstring{"\usebox{\hlnormalsizeboxbackslash}\usebox{\hlnormalsizeboxsinglequote}coefmat{\ }is{\ }not{\ }positive{\ }definite!\usebox{\hlnormalsizeboxbackslash}n"}\hlkeyword{)}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlsymbol{solution}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlstring{\usebox{\hlnormalsizeboxsinglequote}deSolve\usebox{\hlnormalsizeboxsinglequote}}{\ }\hlcomment{\usebox{\hlnormalsizeboxhash}\usebox{\hlnormalsizeboxhash}{\ }switch{\ }to{\ }deSolve{\ }methods,define{\ }the{\ }mkindiff{\ }function}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlkeyword{if}\hlkeyword{(}\hlsymbol{solution}{\ }=={\ }\hlstring{"deSolve"}\hlkeyword{)}{\ }\hlkeyword{\usebox{\hlnormalsizeboxopenbrace}}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlsymbol{mkindiff}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlkeyword{function}\hlkeyword{(}\hlformalargs{t}\hlkeyword{,}{\ }\hlformalargs{state}\hlkeyword{,}{\ }\hlformalargs{parms}\hlkeyword{)}{\ }\hlkeyword{\usebox{\hlnormalsizeboxopenbrace}}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlsymbol{time}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlsymbol{t}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlsymbol{diffs}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlfunctioncall{vector}\hlkeyword{(}\hlkeyword{)}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlkeyword{for}{\ }\hlkeyword{(}\hlsymbol{box}{\ }\hlkeyword{in}{\ }\hlsymbol{mod\usebox{\hlnormalsizeboxunderscore}vars}\hlkeyword{)}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlkeyword{\usebox{\hlnormalsizeboxopenbrace}}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlsymbol{diffname}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlfunctioncall{paste}\hlkeyword{(}\hlstring{"d"}\hlkeyword{,}{\ }\hlsymbol{box}\hlkeyword{,}{\ }\hlargument{sep}\hlargument{=}\hlstring{"\usebox{\hlnormalsizeboxunderscore}"}\hlkeyword{)}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlsymbol{diffs}\hlkeyword{[}\hlsymbol{diffname}\hlkeyword{]}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlfunctioncall{with}\hlkeyword{(}\hlfunctioncall{as.list}\hlkeyword{(}\hlfunctioncall{c}\hlkeyword{(}\hlsymbol{time}\hlkeyword{,}\hlsymbol{state}\hlkeyword{,}{\ }\hlsymbol{parms}\hlkeyword{)}\hlkeyword{)}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlfunctioncall{eval}\hlkeyword{(}\hlfunctioncall{parse}\hlkeyword{(}\hlargument{text}\hlargument{=}\hlsymbol{mkinmodini}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{diffs}\hlkeyword{[[}\hlsymbol{box}\hlkeyword{]}\hlkeyword{]}\hlkeyword{)}\hlkeyword{)}\hlkeyword{)}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlkeyword{\usebox{\hlnormalsizeboxclosebrace}}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlfunctioncall{return}\hlkeyword{(}\hlfunctioncall{list}\hlkeyword{(}\hlfunctioncall{c}\hlkeyword{(}\hlsymbol{diffs}\hlkeyword{)}\hlkeyword{)}\hlkeyword{)}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlkeyword{\usebox{\hlnormalsizeboxclosebrace}}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlkeyword{\usebox{\hlnormalsizeboxclosebrace}}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlkeyword{\usebox{\hlnormalsizeboxclosebrace}}\hlkeyword{else}\hlkeyword{\usebox{\hlnormalsizeboxopenbrace}}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlsymbol{cc}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlfunctioncall{solve}\hlkeyword{(}\hlsymbol{e}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{vectors}\hlkeyword{,}{\ }\hlsymbol{odeini}\hlkeyword{)}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlsymbol{f.out}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlkeyword{function}\hlkeyword{(}\hlformalargs{t}\hlkeyword{)}{\ }\hlkeyword{\usebox{\hlnormalsizeboxopenbrace}}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlsymbol{e}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{vectors}{\ }\hlkeyword{\usebox{\hlnormalsizeboxpercent}*\usebox{\hlnormalsizeboxpercent}}{\ }\hlfunctioncall{diag}\hlkeyword{(}\hlfunctioncall{exp}\hlkeyword{(}\hlsymbol{e}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{values}{\ }\hlkeyword{*}{\ }\hlsymbol{t}\hlkeyword{)}\hlkeyword{,}{\ }\hlargument{nrow}\hlargument{=}\hlfunctioncall{length}\hlkeyword{(}\hlsymbol{mod\usebox{\hlnormalsizeboxunderscore}vars}\hlkeyword{)}\hlkeyword{)}{\ }\hlkeyword{\usebox{\hlnormalsizeboxpercent}*\usebox{\hlnormalsizeboxpercent}}{\ }\hlsymbol{cc}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlkeyword{\usebox{\hlnormalsizeboxclosebrace}}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlsymbol{o}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlfunctioncall{matrix}\hlkeyword{(}\hlfunctioncall{mapply}\hlkeyword{(}\hlsymbol{f.out}\hlkeyword{,}{\ }\hlsymbol{outtimes}\hlkeyword{)}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlargument{nrow}{\ }\hlargument{=}{\ }\hlfunctioncall{length}\hlkeyword{(}\hlsymbol{mod\usebox{\hlnormalsizeboxunderscore}vars}\hlkeyword{)}\hlkeyword{,}{\ }\hlargument{ncol}{\ }\hlargument{=}{\ }\hlfunctioncall{length}\hlkeyword{(}\hlsymbol{outtimes}\hlkeyword{)}\hlkeyword{)}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlfunctioncall{dimnames}\hlkeyword{(}\hlsymbol{o}\hlkeyword{)}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlfunctioncall{list}\hlkeyword{(}\hlsymbol{mod\usebox{\hlnormalsizeboxunderscore}vars}\hlkeyword{,}{\ }\hlsymbol{outtimes}\hlkeyword{)}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlsymbol{out}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlfunctioncall{cbind}\hlkeyword{(}\hlargument{time}{\ }\hlargument{=}{\ }\hlsymbol{outtimes}\hlkeyword{,}{\ }\hlfunctioncall{t}\hlkeyword{(}\hlsymbol{o}\hlkeyword{)}\hlkeyword{)}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlkeyword{\usebox{\hlnormalsizeboxclosebrace}}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}\hlkeyword{\usebox{\hlnormalsizeboxclosebrace}}\mbox{}
\normalfont
\end{Hinput}


\end{normalsize}
\end{Hchunk}



Most often we will use the numerical ODE solvers. The default
integrator used is 'lsoda'. If the program exit with an error in this
step, using \textbf{diagnostics()} to see the diagnostic messages in
the debug mode. Different error tolerance level can be tried or switching
to another solver.

\begin{Hchunk}
\begin{normalsize}
\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlkeyword{if}{\ }\hlkeyword{(}\hlsymbol{solution}{\ }=={\ }\hlstring{"deSolve"}\hlkeyword{)}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlkeyword{\usebox{\hlnormalsizeboxopenbrace}}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlsymbol{out}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlfunctioncall{ode}\hlkeyword{(}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlargument{y}{\ }\hlargument{=}{\ }\hlsymbol{odeini}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlargument{times}{\ }\hlargument{=}{\ }\hlsymbol{outtimes}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlargument{func}{\ }\hlargument{=}{\ }\hlsymbol{mkindiff}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlargument{parms}{\ }\hlargument{=}{\ }\hlsymbol{odeparms}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlargument{atol}{\ }\hlargument{=}{\ }\hlsymbol{atol}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlargument{rtol}{\ }\hlargument{=}{\ }\hlsymbol{rtol}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlargument{method}\hlargument{=}\hlsymbol{odesolver}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlkeyword{)}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlkeyword{\usebox{\hlnormalsizeboxclosebrace}}\mbox{}
\normalfont
\end{Hinput}


\end{normalsize}
\end{Hchunk}


Output transformation for models with unobserved compartments like
SFORB.

\begin{Hchunk}
\begin{normalsize}
\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlcomment{\usebox{\hlnormalsizeboxhash}\usebox{\hlnormalsizeboxhash}{\ }Output{\ }transformation{\ }for{\ }models{\ }with{\ }unobserved{\ }compartments{\ }like{\ }SFORB}\hspace*{\fill}\\
\hlstd{}\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlsymbol{out\usebox{\hlnormalsizeboxunderscore}transformed}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlfunctioncall{data.frame}\hlkeyword{(}\hlargument{time}{\ }\hlargument{=}{\ }\hlsymbol{out}\hlkeyword{[}\hlkeyword{,}\hlstring{"time"}\hlkeyword{]}\hlkeyword{)}\mbox{}
\normalfont
\end{Hinput}


\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlkeyword{for}{\ }\hlkeyword{(}\hlsymbol{var}{\ }\hlkeyword{in}{\ }\hlfunctioncall{names}\hlkeyword{(}\hlsymbol{mkinmodini}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{map}\hlkeyword{)}\hlkeyword{)}{\ }\hlkeyword{\usebox{\hlnormalsizeboxopenbrace}}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlkeyword{if}\hlkeyword{(}\hlkeyword{(}\hlfunctioncall{length}\hlkeyword{(}\hlsymbol{mkinmodini}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{map}\hlkeyword{[[}\hlsymbol{var}\hlkeyword{]}\hlkeyword{]}\hlkeyword{)}{\ }=={\ }\hlnumber{1}\hlkeyword{)}{\ }\hlkeyword{||}{\ }\hlsymbol{solution}{\ }=={\ }\hlstring{"analytical"}\hlkeyword{)}{\ }\hlkeyword{\usebox{\hlnormalsizeboxopenbrace}}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlsymbol{out\usebox{\hlnormalsizeboxunderscore}transformed}\hlkeyword{[}\hlsymbol{var}\hlkeyword{]}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlsymbol{out}\hlkeyword{[}\hlkeyword{,}{\ }\hlsymbol{var}\hlkeyword{]}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlkeyword{\usebox{\hlnormalsizeboxclosebrace}}{\ }\hlkeyword{else}{\ }\hlkeyword{\usebox{\hlnormalsizeboxopenbrace}}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlsymbol{out\usebox{\hlnormalsizeboxunderscore}transformed}\hlkeyword{[}\hlsymbol{var}\hlkeyword{]}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlfunctioncall{rowSums}\hlkeyword{(}\hlsymbol{out}\hlkeyword{[}\hlkeyword{,}{\ }\hlsymbol{mkinmodini}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{map}\hlkeyword{[[}\hlsymbol{var}\hlkeyword{]}\hlkeyword{]}\hlkeyword{]}\hlkeyword{)}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlkeyword{\usebox{\hlnormalsizeboxclosebrace}}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}\hlkeyword{\usebox{\hlnormalsizeboxclosebrace}}\mbox{}
\normalfont
\end{Hinput}


\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlfunctioncall{assign}\hlkeyword{(}\hlstring{"out\usebox{\hlnormalsizeboxunderscore}predicted"}\hlkeyword{,}{\ }\hlsymbol{out\usebox{\hlnormalsizeboxunderscore}transformed}\hlkeyword{,}{\ }\hlargument{inherits}\hlargument{=}\hlnumber{TRUE}\hlkeyword{)}\mbox{}
\normalfont
\end{Hinput}


\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlkeyword{if}\hlkeyword{(}\hlfunctioncall{sum}\hlkeyword{(}\hlfunctioncall{apply}\hlkeyword{(}\hlsymbol{out\usebox{\hlnormalsizeboxunderscore}transformed}\hlkeyword{,}\hlnumber{2}\hlkeyword{,}\hlkeyword{function}\hlkeyword{(}\hlformalargs{x}\hlkeyword{)}{\ }\hlfunctioncall{sum}\hlkeyword{(}\hlfunctioncall{is.nan}\hlkeyword{(}\hlsymbol{x}\hlkeyword{)}\hlkeyword{)}\hlkeyword{\usebox{\hlnormalsizeboxgreaterthan}}\hlfunctioncall{nrow}\hlkeyword{(}\hlsymbol{out\usebox{\hlnormalsizeboxunderscore}transformed}\hlkeyword{)}\hlkeyword{-}\hlnumber{2}\hlkeyword{)}\hlkeyword{)}\hlkeyword{\usebox{\hlnormalsizeboxgreaterthan}}\hlnumber{0}\hlkeyword{)}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}\hlkeyword{\usebox{\hlnormalsizeboxopenbrace}}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlfunctioncall{warning}\hlkeyword{(}\hlstring{\usebox{\hlnormalsizeboxsinglequote}Integration{\ }not{\ }completed\usebox{\hlnormalsizeboxsinglequote}}\hlkeyword{)}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlsymbol{out\usebox{\hlnormalsizeboxunderscore}transformed}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlfunctioncall{apply}\hlkeyword{(}\hlsymbol{out\usebox{\hlnormalsizeboxunderscore}transformed}\hlkeyword{,}\hlnumber{2}\hlkeyword{,}\hlkeyword{function}\hlkeyword{(}\hlformalargs{x}\hlkeyword{)}{\ }\hlkeyword{\usebox{\hlnormalsizeboxopenbrace}}\hlkeyword{if}\hlkeyword{(}\hlfunctioncall{sum}\hlkeyword{(}\hlfunctioncall{is.nan}\hlkeyword{(}\hlsymbol{x}\hlkeyword{)}\hlkeyword{)}\hlkeyword{\usebox{\hlnormalsizeboxgreaterthan}}\hlfunctioncall{nrow}\hlkeyword{(}\hlsymbol{out\usebox{\hlnormalsizeboxunderscore}transformed}\hlkeyword{)}\hlkeyword{-}\hlnumber{2}\hlkeyword{)}{\ }\hlsymbol{x}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlfunctioncall{rep}\hlkeyword{(}\hlnumber{Inf}\hlkeyword{,}\hlfunctioncall{nrow}\hlkeyword{(}\hlsymbol{out\usebox{\hlnormalsizeboxunderscore}transformed}\hlkeyword{)}\hlkeyword{)}{\ }\hlkeyword{else}{\ }\hlsymbol{x}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlsymbol{x}\hlkeyword{\usebox{\hlnormalsizeboxclosebrace}}\hlkeyword{)}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}\hlkeyword{\usebox{\hlnormalsizeboxclosebrace}}\mbox{}
\normalfont
\end{Hinput}


\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlkeyword{if}\hlkeyword{(}\hlfunctioncall{nrow}\hlkeyword{(}\hlsymbol{out\usebox{\hlnormalsizeboxunderscore}transformed}\hlkeyword{)}\hlkeyword{\usebox{\hlnormalsizeboxlessthan}}\hlfunctioncall{length}\hlkeyword{(}\hlsymbol{outtimes}\hlkeyword{)}\hlkeyword{)}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}\hlkeyword{\usebox{\hlnormalsizeboxopenbrace}}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlsymbol{tmp}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlfunctioncall{matrix}\hlkeyword{(}\hlnumber{0}\hlkeyword{,}\hlfunctioncall{length}\hlkeyword{(}\hlsymbol{outtimes}\hlkeyword{)}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlfunctioncall{ncol}\hlkeyword{(}\hlsymbol{out\usebox{\hlnormalsizeboxunderscore}transformed}\hlkeyword{)}\hlkeyword{-}\hlnumber{1}\hlkeyword{)}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlsymbol{tmpnames}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}\hlfunctioncall{names}\hlkeyword{(}\hlsymbol{out\usebox{\hlnormalsizeboxunderscore}transformed}\hlkeyword{)}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlsymbol{out\usebox{\hlnormalsizeboxunderscore}transformed}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlfunctioncall{data.frame}\hlkeyword{(}\hlargument{time}\hlargument{=}\hlsymbol{outtimes}\hlkeyword{,}\hlsymbol{tmp}\hlkeyword{)}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlfunctioncall{names}\hlkeyword{(}\hlsymbol{out\usebox{\hlnormalsizeboxunderscore}transformed}\hlkeyword{)}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlsymbol{tmpnames}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}\hlkeyword{\usebox{\hlnormalsizeboxclosebrace}}\mbox{}
\normalfont
\end{Hinput}


\end{normalsize}
\end{Hchunk}


Calculate the model cost using \textbf{modCost}.

\begin{Hchunk}
\begin{normalsize}
\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlsymbol{mC}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlfunctioncall{modCost}\hlkeyword{(}\hlsymbol{out\usebox{\hlnormalsizeboxunderscore}transformed}\hlkeyword{,}{\ }\hlsymbol{observed}\hlkeyword{,}{\ }\hlargument{y}{\ }\hlargument{=}{\ }\hlstring{"value"}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }\hlargument{err}{\ }\hlargument{=}{\ }\hlstring{\usebox{\hlnormalsizeboxsinglequote}err\usebox{\hlnormalsizeboxsinglequote}}\hlkeyword{,}{\ }\hlargument{weight}{\ }\hlargument{=}{\ }\hlsymbol{weight}\hlkeyword{,}{\ }\hlargument{scaleVar}{\ }\hlargument{=}{\ }\hlsymbol{scaleVar}\hlkeyword{)}\mbox{}
\normalfont
\end{Hinput}


\end{normalsize}
\end{Hchunk}


Report and/or plot if the model is improved by a certain level defined
by \textsl{quiet.tol} defined in \textbf{kingui.control}.

\begin{Hchunk}
\begin{normalsize}
\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlkeyword{if}{\ }\hlkeyword{(}\hlsymbol{cost.old}\hlkeyword{-}\hlsymbol{mC}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{model}{\ }\hlkeyword{\usebox{\hlnormalsizeboxgreaterthan}}{\ }\hlsymbol{ctr}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{quiet.tol}\hlkeyword{)}{\ }\hlkeyword{\usebox{\hlnormalsizeboxopenbrace}}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlkeyword{if}\hlkeyword{(}\hlkeyword{!}\hlsymbol{quiet}\hlkeyword{)}{\ }\hlfunctioncall{cat}\hlkeyword{(}\hlstring{"Model{\ }cost{\ }at{\ }call{\ }"}\hlkeyword{,}{\ }\hlsymbol{calls}\hlkeyword{,}{\ }\hlstring{":{\ }"}\hlkeyword{,}{\ }\hlsymbol{mC}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{model}\hlkeyword{,}{\ }\hlstring{"\usebox{\hlnormalsizeboxbackslash}n"}\hlkeyword{)}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlkeyword{if}\hlkeyword{}\hlkeyword{(}\hlsymbol{plot}\hlkeyword{)}{\ }\hlkeyword{\usebox{\hlnormalsizeboxopenbrace}}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlsymbol{outtimes\usebox{\hlnormalsizeboxunderscore}plot}{\ }\hlassignement{=}{\ }\hlfunctioncall{seq}\hlkeyword{(}\hlfunctioncall{min}\hlkeyword{(}\hlsymbol{observed}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{time}\hlkeyword{)}\hlkeyword{,}{\ }\hlfunctioncall{max}\hlkeyword{(}\hlsymbol{observed}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{time}\hlkeyword{)}\hlkeyword{,}{\ }\hlargument{length.out}\hlargument{=}\hlnumber{100}\hlkeyword{)}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlkeyword{if}{\ }\hlkeyword{(}\hlsymbol{solution}{\ }=={\ }\hlstring{"analytical"}\hlkeyword{)}{\ }\hlkeyword{\usebox{\hlnormalsizeboxopenbrace}}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlcomment{\usebox{\hlnormalsizeboxhash}\usebox{\hlnormalsizeboxhash}{\ }omit{\ }here}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlkeyword{\usebox{\hlnormalsizeboxclosebrace}}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlkeyword{if}\hlkeyword{}\hlkeyword{(}\hlsymbol{solution}{\ }=={\ }\hlstring{"eigen"}\hlkeyword{)}{\ }\hlkeyword{\usebox{\hlnormalsizeboxopenbrace}}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlcomment{\usebox{\hlnormalsizeboxhash}\usebox{\hlnormalsizeboxhash}{\ }omit{\ }here}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlkeyword{\usebox{\hlnormalsizeboxclosebrace}}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlkeyword{if}\hlkeyword{}{\ }\hlkeyword{(}\hlsymbol{solution}{\ }=={\ }\hlstring{"deSolve"}\hlkeyword{)}{\ }\hlkeyword{\usebox{\hlnormalsizeboxopenbrace}}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlsymbol{out\usebox{\hlnormalsizeboxunderscore}plot}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlfunctioncall{ode}\hlkeyword{(}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlargument{y}{\ }\hlargument{=}{\ }\hlsymbol{odeini}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlargument{times}{\ }\hlargument{=}{\ }\hlsymbol{outtimes\usebox{\hlnormalsizeboxunderscore}plot}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlargument{func}{\ }\hlargument{=}{\ }\hlsymbol{mkindiff}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlargument{parms}{\ }\hlargument{=}{\ }\hlsymbol{odeparms}\hlkeyword{)}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlkeyword{\usebox{\hlnormalsizeboxclosebrace}}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlsymbol{out\usebox{\hlnormalsizeboxunderscore}transformed\usebox{\hlnormalsizeboxunderscore}plot}\hlsymbol{}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlfunctioncall{data.frame}\hlkeyword{(}\hlargument{time}{\ }\hlargument{=}{\ }\hlsymbol{out\usebox{\hlnormalsizeboxunderscore}plot}\hlkeyword{[}\hlkeyword{,}\hlstring{"time"}\hlkeyword{]}\hlkeyword{)}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlkeyword{for}{\ }\hlkeyword{(}\hlsymbol{var}{\ }\hlkeyword{in}{\ }\hlfunctioncall{names}\hlkeyword{(}\hlsymbol{mkinmodini}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{map}\hlkeyword{)}\hlkeyword{)}{\ }\hlkeyword{\usebox{\hlnormalsizeboxopenbrace}}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlkeyword{if}\hlkeyword{(}\hlkeyword{(}\hlfunctioncall{length}\hlkeyword{(}\hlsymbol{mkinmodini}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{map}\hlkeyword{[[}\hlsymbol{var}\hlkeyword{]}\hlkeyword{]}\hlkeyword{)}{\ }=={\ }\hlnumber{1}\hlkeyword{)}{\ }\hlkeyword{||}{\ }\hlsymbol{solution}{\ }=={\ }\hlstring{"analytical"}\hlkeyword{)}{\ }\hlkeyword{\usebox{\hlnormalsizeboxopenbrace}}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlsymbol{out\usebox{\hlnormalsizeboxunderscore}transformed\usebox{\hlnormalsizeboxunderscore}plot}\hlkeyword{[}\hlsymbol{var}\hlkeyword{]}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlsymbol{out\usebox{\hlnormalsizeboxunderscore}plot}\hlkeyword{[}\hlkeyword{,}{\ }\hlsymbol{var}\hlkeyword{]}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlkeyword{\usebox{\hlnormalsizeboxclosebrace}}{\ }\hlkeyword{else}{\ }\hlkeyword{\usebox{\hlnormalsizeboxopenbrace}}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlsymbol{out\usebox{\hlnormalsizeboxunderscore}transformed\usebox{\hlnormalsizeboxunderscore}plot}\hlkeyword{[}\hlsymbol{var}\hlkeyword{]}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlfunctioncall{rowSums}\hlkeyword{(}\hlsymbol{out\usebox{\hlnormalsizeboxunderscore}plot}\hlkeyword{[}\hlkeyword{,}{\ }\hlsymbol{mkinmodini}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{map}\hlkeyword{[[}\hlsymbol{var}\hlkeyword{]}\hlkeyword{]}\hlkeyword{]}\hlkeyword{)}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlkeyword{\usebox{\hlnormalsizeboxclosebrace}}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlkeyword{\usebox{\hlnormalsizeboxclosebrace}}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlfunctioncall{plot}\hlkeyword{(}\hlnumber{0}\hlkeyword{,}{\ }\hlargument{type}\hlargument{=}\hlstring{"n"}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlargument{xlim}{\ }\hlargument{=}{\ }\hlfunctioncall{range}\hlkeyword{(}\hlsymbol{observed}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{time}\hlkeyword{)}\hlkeyword{,}{\ }\hlargument{ylim}{\ }\hlargument{=}{\ }\hlfunctioncall{range}\hlkeyword{(}\hlsymbol{observed}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{value}\hlkeyword{,}{\ }\hlargument{na.rm}\hlargument{=}\hlnumber{TRUE}\hlkeyword{)}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlargument{xlab}{\ }\hlargument{=}{\ }\hlstring{"Time"}\hlkeyword{,}{\ }\hlargument{ylab}{\ }\hlargument{=}{\ }\hlstring{"Observed"}\hlkeyword{,}\hlargument{main}\hlargument{=}\hlsymbol{plottitle}\hlkeyword{)}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlsymbol{col\usebox{\hlnormalsizeboxunderscore}obs}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlsymbol{pch\usebox{\hlnormalsizeboxunderscore}obs}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlnumber{1}\hlkeyword{:}\hlfunctioncall{length}\hlkeyword{(}\hlsymbol{obs\usebox{\hlnormalsizeboxunderscore}vars}\hlkeyword{)}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlfunctioncall{names}\hlkeyword{(}\hlsymbol{col\usebox{\hlnormalsizeboxunderscore}obs}\hlkeyword{)}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlfunctioncall{names}\hlkeyword{(}\hlsymbol{pch\usebox{\hlnormalsizeboxunderscore}obs}\hlkeyword{)}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlsymbol{obs\usebox{\hlnormalsizeboxunderscore}vars}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlkeyword{for}{\ }\hlkeyword{(}\hlsymbol{obs\usebox{\hlnormalsizeboxunderscore}var}{\ }\hlkeyword{in}{\ }\hlsymbol{obs\usebox{\hlnormalsizeboxunderscore}vars}\hlkeyword{)}{\ }\hlkeyword{\usebox{\hlnormalsizeboxopenbrace}}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlfunctioncall{points}\hlkeyword{(}\hlfunctioncall{subset}\hlkeyword{(}\hlsymbol{observed}\hlkeyword{,}{\ }\hlsymbol{name}{\ }=={\ }\hlsymbol{obs\usebox{\hlnormalsizeboxunderscore}var}\hlkeyword{,}{\ }\hlfunctioncall{c}\hlkeyword{(}\hlsymbol{time}\hlkeyword{,}{\ }\hlsymbol{value}\hlkeyword{)}\hlkeyword{)}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlargument{pch}{\ }\hlargument{=}{\ }\hlsymbol{pch\usebox{\hlnormalsizeboxunderscore}obs}\hlkeyword{[}\hlsymbol{obs\usebox{\hlnormalsizeboxunderscore}var}\hlkeyword{]}\hlkeyword{,}{\ }\hlargument{col}{\ }\hlargument{=}{\ }\hlsymbol{col\usebox{\hlnormalsizeboxunderscore}obs}\hlkeyword{[}\hlsymbol{obs\usebox{\hlnormalsizeboxunderscore}var}\hlkeyword{]}\hlkeyword{)}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlkeyword{\usebox{\hlnormalsizeboxclosebrace}}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlfunctioncall{matlines}\hlkeyword{(}\hlsymbol{out\usebox{\hlnormalsizeboxunderscore}transformed\usebox{\hlnormalsizeboxunderscore}plot}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{time}\hlkeyword{,}{\ }\hlsymbol{out\usebox{\hlnormalsizeboxunderscore}transformed\usebox{\hlnormalsizeboxunderscore}plot}\hlkeyword{[}\hlkeyword{-}\hlnumber{1}\hlkeyword{]}\hlkeyword{)}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlfunctioncall{legend}\hlkeyword{(}\hlstring{"topright"}\hlkeyword{,}{\ }\hlargument{inset}\hlargument{=}\hlfunctioncall{c}\hlkeyword{(}\hlnumber{0.05}\hlkeyword{,}{\ }\hlnumber{0.05}\hlkeyword{)}\hlkeyword{,}{\ }\hlargument{legend}\hlargument{=}\hlsymbol{obs\usebox{\hlnormalsizeboxunderscore}vars}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlargument{col}\hlargument{=}\hlsymbol{col\usebox{\hlnormalsizeboxunderscore}obs}\hlkeyword{,}{\ }\hlargument{pch}\hlargument{=}\hlsymbol{pch\usebox{\hlnormalsizeboxunderscore}obs}\hlkeyword{,}{\ }\hlargument{lty}\hlargument{=}\hlnumber{1}\hlkeyword{:}\hlfunctioncall{length}\hlkeyword{(}\hlsymbol{pch\usebox{\hlnormalsizeboxunderscore}obs}\hlkeyword{)}\hlkeyword{)}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlkeyword{\usebox{\hlnormalsizeboxclosebrace}}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlsymbol{assign}\hlfunctioncall{}\hlkeyword{(}\hlstring{"cost.old"}\hlkeyword{,}{\ }\hlsymbol{mC}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{model}\hlkeyword{,}{\ }\hlargument{inherits}\hlargument{=}\hlnumber{TRUE}\hlkeyword{)}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}\hlkeyword{\usebox{\hlnormalsizeboxclosebrace}}\mbox{}
\normalfont
\end{Hinput}


\end{normalsize}
\end{Hchunk}


Return an object with class \textsl{modCost}.

\begin{Hchunk}
\begin{normalsize}
\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlfunctioncall{return}\hlkeyword{(}\hlsymbol{mC}\hlkeyword{)}\mbox{}
\normalfont
\end{Hinput}


\end{normalsize}
\end{Hchunk}


\subsection{Optimization to fit the kinetic model}
Set the initial values for the optimization. If argument \textsl{plot}
is TRUE, then open a new plot window.

\begin{Hchunk}
\begin{normalsize}
\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlcomment{\usebox{\hlnormalsizeboxhash}\usebox{\hlnormalsizeboxhash}{\ }Set{\ }up{\ }initial{\ }values{\ }for{\ }the{\ }optimization{\ }\usebox{\hlnormalsizeboxhash}\usebox{\hlnormalsizeboxhash}}\hspace*{\fill}\\
\hlstd{}\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlsymbol{cost.old}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlnumber{1e100}{\ }\hlcomment{\usebox{\hlnormalsizeboxhash}\usebox{\hlnormalsizeboxhash}{\ }old{\ }cost(SSR)}\mbox{}
\normalfont
\end{Hinput}


\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlsymbol{calls}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlnumber{0}{\ }{\ }\hlcomment{\usebox{\hlnormalsizeboxhash}\usebox{\hlnormalsizeboxhash}{\ }number{\ }of{\ }calls{\ }to{\ }the{\ }cost{\ }function}\mbox{}
\normalfont
\end{Hinput}


\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlsymbol{out\usebox{\hlnormalsizeboxunderscore}predicted}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlnumber{NA}{\ }\hlcomment{\usebox{\hlnormalsizeboxhash}\usebox{\hlnormalsizeboxhash}{\ }initialize{\ }the{\ }predicted{\ }matrix{\ }of{\ }residue{\ }at{\ }the{\ }observing{\ }time{\ }points.}\mbox{}
\normalfont
\end{Hinput}


\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlkeyword{if}\hlkeyword{(}\hlsymbol{plot}\hlkeyword{)}{\ }\hlfunctioncall{x11}\hlkeyword{(}\hlkeyword{)}\hlcomment{\usebox{\hlnormalsizeboxhash}\usebox{\hlnormalsizeboxhash}{\ }open{\ }a{\ }new{\ }plotting{\ }window}\mbox{}
\normalfont
\end{Hinput}


\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlsymbol{method0}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlstring{\usebox{\hlnormalsizeboxsinglequote}solnp\usebox{\hlnormalsizeboxsinglequote}}{\ }\hlcomment{\usebox{\hlnormalsizeboxhash}\usebox{\hlnormalsizeboxhash}{\ }a{\ }prefitting{\ }step{\ }since{\ }this{\ }is{\ }usually{\ }the{\ }most{\ }effective{\ }method}\mbox{}
\normalfont
\end{Hinput}


\end{normalsize}
\end{Hchunk}


We first use the solnp algorithm to do an initial optimization, if it
fails, we try another method.

\begin{Hchunk}
\begin{normalsize}
\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlsymbol{pnames}\hlassignement{=}\hlfunctioncall{names}\hlkeyword{(}\hlfunctioncall{c}\hlkeyword{(}\hlsymbol{state.ini.optim}\hlkeyword{,}{\ }\hlsymbol{parms.optim}\hlkeyword{)}\hlkeyword{)}\mbox{}
\normalfont
\end{Hinput}


\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlsymbol{fn}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlkeyword{function}\hlkeyword{(}\hlformalargs{P}\hlkeyword{)}\hlkeyword{\usebox{\hlnormalsizeboxopenbrace}}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlfunctioncall{names}\hlkeyword{(}\hlsymbol{P}\hlkeyword{)}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlsymbol{pnames}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlsymbol{FF}\hlassignement{\usebox{\hlnormalsizeboxlessthan}\usebox{\hlnormalsizeboxlessthan}-}\hlfunctioncall{cost}\hlkeyword{(}\hlsymbol{P}\hlkeyword{)}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlfunctioncall{return}\hlkeyword{(}\hlsymbol{FF}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{model}\hlkeyword{)}\hlkeyword{\usebox{\hlnormalsizeboxclosebrace}}\mbox{}
\normalfont
\end{Hinput}


\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlsymbol{a}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlfunctioncall{try}\hlkeyword{(}\hlsymbol{fit}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlfunctioncall{solnp}\hlkeyword{(}\hlfunctioncall{c}\hlkeyword{(}\hlsymbol{state.ini.optim}\hlkeyword{,}{\ }\hlsymbol{parms.optim}\hlkeyword{)}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlargument{fun}\hlargument{=}\hlsymbol{fn}\hlkeyword{,}\hlargument{LB}\hlargument{=}\hlsymbol{lower}\hlkeyword{,}\hlargument{UB}\hlargument{=}\hlsymbol{upper}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlargument{control}\hlargument{=}\hlsymbol{control}\hlkeyword{)}\hlkeyword{,}\hlargument{silent}\hlargument{=}\hlnumber{TRUE}\hlkeyword{)}\mbox{}
\normalfont
\end{Hinput}


\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlcomment{\usebox{\hlnormalsizeboxhash}\usebox{\hlnormalsizeboxhash}optimmethod{\ }\usebox{\hlnormalsizeboxlessthan}-{\ }method0}\hspace*{\fill}\\
\hlstd{}\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlsymbol{flag}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlnumber{1}\mbox{}
\normalfont
\end{Hinput}


\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlkeyword{if}\hlkeyword{(}\hlfunctioncall{class}\hlkeyword{(}\hlsymbol{a}\hlkeyword{)}{\ }=={\ }\hlstring{"try-error"}\hlkeyword{)}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}\hlkeyword{\usebox{\hlnormalsizeboxopenbrace}}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlfunctioncall{print}\hlkeyword{(}\hlstring{\usebox{\hlnormalsizeboxsinglequote}solnp{\ }fails,{\ }try{\ }PORT{\ }or{\ }other{\ }algorithm{\ }by{\ }users{\ }choice,{\ }might{\ }take{\ }longer{\ }time.{\ }Do{\ }something{\ }else!\usebox{\hlnormalsizeboxsinglequote}}\hlkeyword{)}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlfunctioncall{warning}\hlkeyword{(}\hlstring{\usebox{\hlnormalsizeboxsinglequote}solnp{\ }fails,{\ }switch{\ }to{\ }{\ }PORT{\ }or{\ }other{\ }algorithm{\ }by{\ }users{\ }choice\usebox{\hlnormalsizeboxsinglequote}}\hlkeyword{)}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlcomment{\usebox{\hlnormalsizeboxhash}\usebox{\hlnormalsizeboxhash}{\ }now{\ }using{\ }submethod{\ }already}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlkeyword{if}\hlkeyword{(}\hlsymbol{method}\hlkeyword{!=}\hlstring{\usebox{\hlnormalsizeboxsinglequote}solnp\usebox{\hlnormalsizeboxsinglequote}}\hlkeyword{)}{\ }\hlsymbol{submethod}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlsymbol{method}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlsymbol{fit}\hlsymbol{}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlfunctioncall{modFit1}\hlkeyword{(}\hlsymbol{cost}\hlkeyword{,}{\ }\hlfunctioncall{c}\hlkeyword{(}\hlsymbol{state.ini.optim}\hlkeyword{,}{\ }\hlsymbol{parms.optim}\hlkeyword{)}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlargument{lower}{\ }\hlargument{=}{\ }\hlsymbol{lower}\hlkeyword{,}{\ }\hlargument{upper}{\ }\hlargument{=}{\ }\hlsymbol{upper}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlargument{method}\hlargument{=}\hlsymbol{submethod}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlargument{control}\hlargument{=}\hlfunctioncall{kingui.control}\hlkeyword{(}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlargument{method}\hlargument{=}\hlsymbol{submethod}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlargument{tolerance}\hlargument{=}\hlsymbol{ctr}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{control}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{tol}\hlkeyword{)}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{control}\hlkeyword{)}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlsymbol{flag}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlnumber{0}{\ }\hlcomment{\usebox{\hlnormalsizeboxhash}\usebox{\hlnormalsizeboxhash}{\ }change{\ }the{\ }flag{\ }of{\ }used{\ }methods}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlcomment{\usebox{\hlnormalsizeboxhash}\usebox{\hlnormalsizeboxhash}optimmethod{\ }\usebox{\hlnormalsizeboxlessthan}-{\ }c(optimmethod,method){\ }\usebox{\hlnormalsizeboxhash}\usebox{\hlnormalsizeboxhash}{\ }keep{\ }for{\ }later{\ }possible{\ }use.}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}\hlkeyword{\usebox{\hlnormalsizeboxclosebrace}}\mbox{}
\normalfont
\end{Hinput}


\end{normalsize}
\end{Hchunk}


If there is only one substance in the
model, the optimization will stop and related values including \textsl{SSR, Var} will be
calculated. Note that since we always use 'solnp' in the first
step. If getting insensible results and you need to change the
optimization algorithm, try to use \textbf{mkinfit.full} instead of
\textbf{IRLSkinfit.full}. This shall be fixed in a later
version. If there are more than one compartments, set up the IRLS
iteration control parameters and start the IRLS iteration which
involving solving a weighted least square problem in each iteration
step by \textbf{solnp} or \textbf{modFit1} or other optimization algorithms.

\begin{Hchunk}
\begin{normalsize}
\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlkeyword{if}\hlkeyword{(}\hlfunctioncall{length}\hlkeyword{(}\hlsymbol{irls.control}\hlkeyword{)}==\hlnumber{0}\hlkeyword{)}{\ }\hlsymbol{irls.control}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlfunctioncall{list}\hlkeyword{(}\hlargument{maxIter}\hlargument{=}\hlnumber{5}\hlkeyword{,}\hlargument{tol}\hlargument{=}\hlnumber{1e-05}\hlkeyword{)}\mbox{}
\normalfont
\end{Hinput}


\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlkeyword{if}\hlkeyword{(}\hlfunctioncall{is.null}\hlkeyword{(}\hlsymbol{irls.control}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{tol}\hlkeyword{)}\hlkeyword{)}{\ }\hlsymbol{tol}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlnumber{1e-05}{\ }\hlkeyword{else}{\ }\hlsymbol{tol}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlsymbol{irls.control}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{tol}\mbox{}
\normalfont
\end{Hinput}


\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlkeyword{if}\hlkeyword{(}\hlfunctioncall{is.null}\hlkeyword{(}\hlsymbol{irls.control}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{maxIter}\hlkeyword{)}\hlkeyword{)}{\ }\hlsymbol{maxIter}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlnumber{5}{\ }\hlkeyword{else}{\ }{\ }\hlsymbol{maxIter}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlsymbol{irls.control}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{maxIter}\mbox{}
\normalfont
\end{Hinput}


\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlkeyword{if}\hlkeyword{(}\hlfunctioncall{length}\hlkeyword{(}\hlsymbol{mkinmodini}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{map}\hlkeyword{)}==\hlnumber{1}\hlkeyword{)}\hlkeyword{\usebox{\hlnormalsizeboxopenbrace}}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlcomment{\usebox{\hlnormalsizeboxhash}\usebox{\hlnormalsizeboxhash}{\ }there{\ }is{\ }only{\ }one{\ }parent{\ }no{\ }need{\ }to{\ }do{\ }the{\ }iteration:}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlsymbol{maxIter}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlnumber{0}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlsymbol{useHsolnp}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlnumber{TRUE}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlkeyword{if}\hlkeyword{(}\hlsymbol{flag}==\hlnumber{1}\hlkeyword{)}\hlcomment{\usebox{\hlnormalsizeboxhash}\usebox{\hlnormalsizeboxhash}{\ }fit{\ }from{\ }solnp}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlkeyword{\usebox{\hlnormalsizeboxopenbrace}}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlsymbol{fit}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{ssr}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlsymbol{fit}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{values}\hlkeyword{[}\hlfunctioncall{length}\hlkeyword{(}\hlsymbol{fit}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{values}\hlkeyword{)}\hlkeyword{]}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlsymbol{fit}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{residuals}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}\hlsymbol{FF}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{residual}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{res}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlcomment{\usebox{\hlnormalsizeboxhash}\usebox{\hlnormalsizeboxhash}{\ }mean{\ }square{\ }per{\ }varaible}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlkeyword{if}{\ }\hlkeyword{(}\hlfunctioncall{class}\hlkeyword{(}\hlsymbol{FF}\hlkeyword{)}{\ }=={\ }\hlstring{"modCost"}\hlkeyword{)}{\ }\hlkeyword{\usebox{\hlnormalsizeboxopenbrace}}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlfunctioncall{names}\hlkeyword{(}\hlsymbol{fit}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{residuals}\hlkeyword{)}{\ }{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlsymbol{FF}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{residuals}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{name}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlsymbol{fit}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{var\usebox{\hlnormalsizeboxunderscore}ms}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlsymbol{FF}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{var}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{SSR}\hlkeyword{/}\hlsymbol{FF}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{var}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{N}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlsymbol{fit}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{var\usebox{\hlnormalsizeboxunderscore}ms\usebox{\hlnormalsizeboxunderscore}unscaled}{\ }{\ }{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlsymbol{FF}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{var}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{SSR.unscaled}\hlkeyword{/}\hlsymbol{FF}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{var}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{N}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlsymbol{fit}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{var\usebox{\hlnormalsizeboxunderscore}ms\usebox{\hlnormalsizeboxunderscore}unweighted}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlsymbol{FF}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{var}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{SSR.unweighted}\hlkeyword{/}\hlsymbol{FF}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{var}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{N}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlfunctioncall{names}\hlkeyword{(}\hlsymbol{fit}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{var\usebox{\hlnormalsizeboxunderscore}ms\usebox{\hlnormalsizeboxunderscore}unweighted}\hlkeyword{)}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlfunctioncall{names}\hlkeyword{(}\hlsymbol{fit}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{var\usebox{\hlnormalsizeboxunderscore}ms\usebox{\hlnormalsizeboxunderscore}unscaled}\hlkeyword{)}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlfunctioncall{names}\hlkeyword{(}\hlsymbol{fit}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{var\usebox{\hlnormalsizeboxunderscore}ms}\hlkeyword{)}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlsymbol{FF}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{var}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{name}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlkeyword{\usebox{\hlnormalsizeboxclosebrace}}{\ }\hlkeyword{else}{\ }\hlsymbol{fit}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{var\usebox{\hlnormalsizeboxunderscore}ms}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlsymbol{fit}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{var\usebox{\hlnormalsizeboxunderscore}ms\usebox{\hlnormalsizeboxunderscore}unweighted}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlsymbol{fit}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{var\usebox{\hlnormalsizeboxunderscore}ms\usebox{\hlnormalsizeboxunderscore}unscaled}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlnumber{NA}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlkeyword{\usebox{\hlnormalsizeboxclosebrace}}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlsymbol{err1}\hlsymbol{}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlfunctioncall{sqrt}\hlkeyword{(}\hlsymbol{fit}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{var\usebox{\hlnormalsizeboxunderscore}ms\usebox{\hlnormalsizeboxunderscore}unweighted}\hlkeyword{)}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlsymbol{ERR}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlsymbol{err1}\hlkeyword{[}\hlfunctioncall{as.character}\hlkeyword{(}\hlsymbol{observed}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{name}\hlkeyword{)}\hlkeyword{]}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlsymbol{observed}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{err}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}\hlsymbol{ERR}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}\hlkeyword{\usebox{\hlnormalsizeboxclosebrace}}\mbox{}
\normalfont
\end{Hinput}


\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlsymbol{niter}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlnumber{1}\mbox{}
\normalfont
\end{Hinput}


\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlcomment{\usebox{\hlnormalsizeboxhash}\usebox{\hlnormalsizeboxhash}{\ }insure{\ }one{\ }IRLS{\ }iteration{\ }setup{\ }the{\ }initials}\hspace*{\fill}\\
\hlstd{}\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlsymbol{diffsigma}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlnumber{100}\mbox{}
\normalfont
\end{Hinput}


\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlsymbol{olderr}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlfunctioncall{rep}\hlkeyword{(}\hlnumber{1}\hlkeyword{,}\hlfunctioncall{length}\hlkeyword{(}\hlsymbol{mod\usebox{\hlnormalsizeboxunderscore}vars}\hlkeyword{)}\hlkeyword{)}\mbox{}
\normalfont
\end{Hinput}


\end{normalsize}
\end{Hchunk}


The iteration will continue until either the difference between the
calculated sigmas are smaller than a tolerance level or the maximum
iteration number has been reached.

\begin{Hchunk}
\begin{normalsize}
\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlkeyword{while}\hlkeyword{(}\hlsymbol{diffsigma}\hlkeyword{\usebox{\hlnormalsizeboxgreaterthan}}\hlsymbol{tol}{\ }\hlkeyword{\usebox{\hlnormalsizeboxand}}{\ }\hlsymbol{niter}\usebox{\hlnormalsizeboxlessthan}=\hlsymbol{maxIter}\hlkeyword{)}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}\hlkeyword{\usebox{\hlnormalsizeboxopenbrace}}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlcomment{\usebox{\hlnormalsizeboxhash}\usebox{\hlnormalsizeboxhash}....}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}\hlkeyword{\usebox{\hlnormalsizeboxclosebrace}}\mbox{}
\normalfont
\end{Hinput}


\end{normalsize}
\end{Hchunk}


The IRLS algorithm involves solving a weighted least square problem in each iteration
step by \textbf{solnp} or \textbf{modFit1} or other optimization algorithms.


\begin{Hchunk}
\begin{normalsize}
\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlcomment{\usebox{\hlnormalsizeboxhash}\usebox{\hlnormalsizeboxhash}{\ }\usebox{\hlnormalsizeboxhash}{\ }other{\ }list{\ }need{\ }to{\ }be{\ }attached{\ }to{\ }fit{\ }to{\ }give{\ }comparable{\ }results{\ }as{\ }in{\ }modFit.}\hspace*{\fill}\\
\hlstd{}\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlkeyword{if}\hlkeyword{(}\hlsymbol{flag}==\hlnumber{1}\hlkeyword{)}\hlcomment{\usebox{\hlnormalsizeboxhash}\usebox{\hlnormalsizeboxhash}{\ }fit{\ }from{\ }solnp}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}\hlkeyword{\usebox{\hlnormalsizeboxopenbrace}}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlsymbol{fit}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{ssr}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlsymbol{fit}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{values}\hlkeyword{[}\hlfunctioncall{length}\hlkeyword{(}\hlsymbol{fit}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{values}\hlkeyword{)}\hlkeyword{]}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlsymbol{fit}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{residuals}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}\hlsymbol{FF}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{residual}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{res}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlcomment{\usebox{\hlnormalsizeboxhash}\usebox{\hlnormalsizeboxhash}{\ }mean{\ }square{\ }per{\ }varaible}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlkeyword{if}{\ }\hlkeyword{(}\hlfunctioncall{class}\hlkeyword{(}\hlsymbol{FF}\hlkeyword{)}{\ }=={\ }\hlstring{"modCost"}\hlkeyword{)}{\ }\hlkeyword{\usebox{\hlnormalsizeboxopenbrace}}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlfunctioncall{names}\hlkeyword{(}\hlsymbol{fit}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{residuals}\hlkeyword{)}{\ }{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlsymbol{FF}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{residuals}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{name}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlsymbol{fit}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{var\usebox{\hlnormalsizeboxunderscore}ms}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlsymbol{FF}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{var}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{SSR}\hlkeyword{/}\hlsymbol{FF}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{var}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{N}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlsymbol{fit}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{var\usebox{\hlnormalsizeboxunderscore}ms\usebox{\hlnormalsizeboxunderscore}unscaled}{\ }{\ }{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlsymbol{FF}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{var}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{SSR.unscaled}\hlkeyword{/}\hlsymbol{FF}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{var}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{N}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlsymbol{fit}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{var\usebox{\hlnormalsizeboxunderscore}ms\usebox{\hlnormalsizeboxunderscore}unweighted}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlsymbol{FF}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{var}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{SSR.unweighted}\hlkeyword{/}\hlsymbol{FF}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{var}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{N}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlfunctioncall{names}\hlkeyword{(}\hlsymbol{fit}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{var\usebox{\hlnormalsizeboxunderscore}ms\usebox{\hlnormalsizeboxunderscore}unweighted}\hlkeyword{)}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlfunctioncall{names}\hlkeyword{(}\hlsymbol{fit}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{var\usebox{\hlnormalsizeboxunderscore}ms\usebox{\hlnormalsizeboxunderscore}unscaled}\hlkeyword{)}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlfunctioncall{names}\hlkeyword{(}\hlsymbol{fit}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{var\usebox{\hlnormalsizeboxunderscore}ms}\hlkeyword{)}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlsymbol{FF}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{var}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{name}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlkeyword{\usebox{\hlnormalsizeboxclosebrace}}{\ }\hlkeyword{else}{\ }\hlsymbol{fit}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{var\usebox{\hlnormalsizeboxunderscore}ms}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlsymbol{fit}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{var\usebox{\hlnormalsizeboxunderscore}ms\usebox{\hlnormalsizeboxunderscore}unweighted}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlsymbol{fit}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{var\usebox{\hlnormalsizeboxunderscore}ms\usebox{\hlnormalsizeboxunderscore}unscaled}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlnumber{NA}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}\hlkeyword{\usebox{\hlnormalsizeboxclosebrace}}\mbox{}
\normalfont
\end{Hinput}


\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlsymbol{err1}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlfunctioncall{sqrt}\hlkeyword{(}\hlsymbol{fit}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{var\usebox{\hlnormalsizeboxunderscore}ms\usebox{\hlnormalsizeboxunderscore}unweighted}\hlkeyword{)}\mbox{}
\normalfont
\end{Hinput}


\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlsymbol{ERR}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlsymbol{err1}\hlkeyword{[}\hlfunctioncall{as.character}\hlkeyword{(}\hlsymbol{observed}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{name}\hlkeyword{)}\hlkeyword{]}\mbox{}
\normalfont
\end{Hinput}


\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlsymbol{observed}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{err}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}\hlsymbol{ERR}\mbox{}
\normalfont
\end{Hinput}


\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlsymbol{diffsigma}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlfunctioncall{sum}\hlkeyword{(}\hlkeyword{(}\hlsymbol{err1}\hlkeyword{-}\hlsymbol{olderr}\hlkeyword{)}\hlkeyword{\usebox{\hlnormalsizeboxhat}}\hlnumber{2}\hlkeyword{)}\mbox{}
\normalfont
\end{Hinput}


\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlfunctioncall{cat}\hlkeyword{(}\hlstring{"IRLS{\ }iteration{\ }at"}\hlkeyword{,}\hlsymbol{niter}\hlkeyword{,}{\ }\hlstring{";{\ }Diff{\ }in{\ }error{\ }variance{\ }"}\hlkeyword{,}{\ }\hlsymbol{diffsigma}\hlkeyword{,}\hlstring{"\usebox{\hlnormalsizeboxbackslash}n"}\hlkeyword{)}\mbox{}
\normalfont
\end{Hinput}


\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlsymbol{olderr}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlsymbol{err1}\mbox{}
\normalfont
\end{Hinput}


\end{normalsize}
\end{Hchunk}

\begin{Hchunk}
\begin{normalsize}
\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlkeyword{if}\hlkeyword{(}\hlsymbol{goMarq}==\hlnumber{1}\hlkeyword{)}{\ }\hlkeyword{\usebox{\hlnormalsizeboxopenbrace}}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlfunctioncall{print}\hlkeyword{(}\hlstring{\usebox{\hlnormalsizeboxsinglequote}do{\ }a{\ }local{\ }optmization{\ }using{\ }marquardt\usebox{\hlnormalsizeboxsinglequote}}\hlkeyword{)}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlsymbol{fit}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlfunctioncall{modFit1}\hlkeyword{(}\hlsymbol{cost}\hlkeyword{,}{\ }\hlsymbol{fit}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{par}\hlkeyword{,}{\ }\hlargument{lower}{\ }\hlargument{=}{\ }\hlsymbol{lower}\hlkeyword{,}{\ }\hlargument{upper}{\ }\hlargument{=}{\ }\hlsymbol{upper}\hlkeyword{,}{\ }\hlargument{method}\hlargument{=}\hlstring{\usebox{\hlnormalsizeboxsinglequote}Marq\usebox{\hlnormalsizeboxsinglequote}}\hlkeyword{,}\hlargument{control}\hlargument{=}\hlsymbol{marqctr}\hlkeyword{)}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlsymbol{flag}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlnumber{0}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}\hlkeyword{\usebox{\hlnormalsizeboxclosebrace}}\hlkeyword{else}\hlkeyword{\usebox{\hlnormalsizeboxopenbrace}}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlsymbol{flag}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlnumber{1}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlcomment{\usebox{\hlnormalsizeboxhash}\usebox{\hlnormalsizeboxhash}{\ }the{\ }next{\ }iteration{\ }using{\ }solnp{\ }also}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlsymbol{a}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlfunctioncall{try}\hlkeyword{(}\hlsymbol{fit}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlfunctioncall{solnp}\hlkeyword{(}\hlsymbol{fit}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{par}\hlkeyword{,}\hlargument{fun}\hlargument{=}\hlsymbol{fn}\hlkeyword{,}\hlargument{LB}\hlargument{=}\hlsymbol{lower}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlargument{UB}\hlargument{=}\hlsymbol{upper}\hlkeyword{,}\hlargument{control}\hlargument{=}\hlsymbol{control}\hlkeyword{)}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlargument{silent}\hlargument{=}\hlnumber{TRUE}\hlkeyword{)}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlkeyword{if}\hlkeyword{(}\hlfunctioncall{class}\hlkeyword{(}\hlsymbol{a}\hlkeyword{)}{\ }=={\ }\hlstring{"try-error"}\hlkeyword{)}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlkeyword{\usebox{\hlnormalsizeboxopenbrace}}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlsymbol{flag}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlnumber{0}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlfunctioncall{print}\hlkeyword{(}\hlstring{\usebox{\hlnormalsizeboxsinglequote}solnp{\ }fails{\ }during{\ }IRLS{\ }iteration,{\ }try{\ }PORT{\ }or{\ }other{\ }algorithm{\ }by{\ }users{\ }choice.This{\ }may{\ }takes{\ }a{\ }while.{\ }Do{\ }something{\ }else!\usebox{\hlnormalsizeboxsinglequote}}\hlkeyword{)}{\ }\hlcomment{\usebox{\hlnormalsizeboxhash}\usebox{\hlnormalsizeboxhash}{\ }NOTE:{\ }because{\ }in{\ }kingui{\ }we{\ }switch{\ }off{\ }the{\ }warnings,{\ }we{\ }need{\ }to{\ }print{\ }out{\ }the{\ }message{\ }instead.}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlfunctioncall{warning}\hlkeyword{(}\hlstring{\usebox{\hlnormalsizeboxsinglequote}solnp{\ }fails{\ }during{\ }IRLS{\ }iteration,{\ }switch{\ }to{\ }{\ }PORT{\ }or{\ }other{\ }algorithm{\ }by{\ }users{\ }choice\usebox{\hlnormalsizeboxsinglequote}}\hlkeyword{)}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlsymbol{fit}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlfunctioncall{modFit1}\hlkeyword{(}\hlsymbol{cost}\hlkeyword{,}{\ }\hlsymbol{fit}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{par}\hlkeyword{,}{\ }\hlargument{lower}{\ }\hlargument{=}{\ }\hlsymbol{lower}\hlkeyword{,}{\ }\hlargument{upper}{\ }\hlargument{=}{\ }\hlsymbol{upper}\hlkeyword{,}{\ }\hlargument{method}\hlargument{=}\hlsymbol{submethod}\hlkeyword{,}\hlargument{control}\hlargument{=}\hlfunctioncall{list}\hlkeyword{(}\hlkeyword{)}\hlkeyword{)}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlkeyword{\usebox{\hlnormalsizeboxclosebrace}}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}\hlkeyword{\usebox{\hlnormalsizeboxclosebrace}}\mbox{}
\normalfont
\end{Hinput}


\end{normalsize}
\end{Hchunk}


Add to the number of iteration counter.

\begin{Hchunk}
\begin{normalsize}
\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlsymbol{niter}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlsymbol{niter}\hlkeyword{+}\hlnumber{1}\mbox{}
\normalfont
\end{Hinput}


\end{normalsize}
\end{Hchunk}


If the optimization is done via \textbf{solnp}, a few values like
\textsl{ssr, residuals} need to be renamed or calculated.

\begin{Hchunk}
\begin{normalsize}
\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlcomment{\usebox{\hlnormalsizeboxhash}\usebox{\hlnormalsizeboxhash}{\ }\usebox{\hlnormalsizeboxhash}{\ }other{\ }list{\ }need{\ }to{\ }be{\ }attached{\ }to{\ }fit{\ }to{\ }give{\ }comparable{\ }results{\ }as{\ }in{\ }modFit.}\hspace*{\fill}\\
\hlstd{}\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlkeyword{if}\hlkeyword{(}\hlsymbol{flag}==\hlnumber{1}\hlkeyword{)}\hlkeyword{\usebox{\hlnormalsizeboxopenbrace}}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlcomment{\usebox{\hlnormalsizeboxhash}\usebox{\hlnormalsizeboxhash}{\ }solnp{\ }used}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlsymbol{optimmethod}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlstring{\usebox{\hlnormalsizeboxsinglequote}solnp\usebox{\hlnormalsizeboxsinglequote}}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlsymbol{fit}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{ssr}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlsymbol{fit}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{values}\hlkeyword{[}\hlfunctioncall{length}\hlkeyword{(}\hlsymbol{fit}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{values}\hlkeyword{)}\hlkeyword{]}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlsymbol{fit}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{residuals}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}\hlsymbol{FF}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{residual}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{res}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlcomment{\usebox{\hlnormalsizeboxhash}\usebox{\hlnormalsizeboxhash}{\ }mean{\ }square{\ }per{\ }varaible}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlkeyword{if}{\ }\hlkeyword{(}\hlfunctioncall{class}\hlkeyword{(}\hlsymbol{FF}\hlkeyword{)}{\ }=={\ }\hlstring{"modCost"}\hlkeyword{)}{\ }\hlkeyword{\usebox{\hlnormalsizeboxopenbrace}}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlfunctioncall{names}\hlkeyword{(}\hlsymbol{fit}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{residuals}\hlkeyword{)}{\ }{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlsymbol{FF}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{residuals}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{name}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlsymbol{fit}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{var\usebox{\hlnormalsizeboxunderscore}ms}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlsymbol{FF}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{var}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{SSR}\hlkeyword{/}\hlsymbol{FF}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{var}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{N}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlsymbol{fit}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{var\usebox{\hlnormalsizeboxunderscore}ms\usebox{\hlnormalsizeboxunderscore}unscaled}{\ }{\ }{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlsymbol{FF}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{var}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{SSR.unscaled}\hlkeyword{/}\hlsymbol{FF}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{var}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{N}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlsymbol{fit}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{var\usebox{\hlnormalsizeboxunderscore}ms\usebox{\hlnormalsizeboxunderscore}unweighted}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlsymbol{FF}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{var}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{SSR.unweighted}\hlkeyword{/}\hlsymbol{FF}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{var}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{N}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlfunctioncall{names}\hlkeyword{(}\hlsymbol{fit}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{var\usebox{\hlnormalsizeboxunderscore}ms\usebox{\hlnormalsizeboxunderscore}unweighted}\hlkeyword{)}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlfunctioncall{names}\hlkeyword{(}\hlsymbol{fit}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{var\usebox{\hlnormalsizeboxunderscore}ms\usebox{\hlnormalsizeboxunderscore}unscaled}\hlkeyword{)}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlfunctioncall{names}\hlkeyword{(}\hlsymbol{fit}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{var\usebox{\hlnormalsizeboxunderscore}ms}\hlkeyword{)}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlsymbol{FF}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{var}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{name}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlkeyword{\usebox{\hlnormalsizeboxclosebrace}}{\ }\hlkeyword{else}{\ }\hlsymbol{fit}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{var\usebox{\hlnormalsizeboxunderscore}ms}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlsymbol{fit}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{var\usebox{\hlnormalsizeboxunderscore}ms\usebox{\hlnormalsizeboxunderscore}unweighted}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlsymbol{fit}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{var\usebox{\hlnormalsizeboxunderscore}ms\usebox{\hlnormalsizeboxunderscore}unscaled}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlnumber{NA}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlsymbol{np}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlfunctioncall{length}\hlkeyword{(}\hlfunctioncall{c}\hlkeyword{(}\hlsymbol{state.ini.optim}\hlkeyword{,}{\ }\hlsymbol{parms.optim}\hlkeyword{)}\hlkeyword{)}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlsymbol{fit}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{rank}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlsymbol{np}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlsymbol{fit}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{df.residual}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlfunctioncall{length}\hlkeyword{(}\hlsymbol{fit}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{residuals}\hlkeyword{)}{\ }\hlkeyword{-}{\ }\hlsymbol{fit}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{rank}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}\hlkeyword{\usebox{\hlnormalsizeboxclosebrace}}\hlkeyword{else}\hlkeyword{\usebox{\hlnormalsizeboxopenbrace}}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlsymbol{optimmethod}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlsymbol{submethod}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}\hlkeyword{\usebox{\hlnormalsizeboxclosebrace}}\mbox{}
\normalfont
\end{Hinput}


\end{normalsize}
\end{Hchunk}

\subsection{Summary Information}

Calculating the unscaled covariance to calculate the standard error
for the parameter estimates in the \textbf{summary} function.

\begin{Hchunk}
\begin{normalsize}
\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlcomment{\usebox{\hlnormalsizeboxhash}\usebox{\hlnormalsizeboxhash}{\ }Calculating{\ }the{\ }unscaled{\ }covariance}\hspace*{\fill}\\
\hlstd{}\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlkeyword{if}\hlkeyword{(}\hlsymbol{flag}\hlkeyword{!=}\hlnumber{1}\hlkeyword{)}{\ }\hlsymbol{covar}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlfunctioncall{try}\hlkeyword{(}\hlfunctioncall{solve}\hlkeyword{(}\hlnumber{0.5}\hlkeyword{*}\hlsymbol{fit}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{hessian}\hlkeyword{)}\hlkeyword{,}{\ }\hlargument{silent}{\ }\hlargument{=}{\ }\hlnumber{TRUE}\hlkeyword{)}{\ }\hlkeyword{else}{\ }\hlkeyword{\usebox{\hlnormalsizeboxopenbrace}}\hlcomment{\usebox{\hlnormalsizeboxhash}\usebox{\hlnormalsizeboxhash}{\ }solnpused.}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlkeyword{if}\hlkeyword{(}\hlsymbol{useHsolnp}==\hlnumber{TRUE}\hlkeyword{)}{\ }\hlkeyword{\usebox{\hlnormalsizeboxopenbrace}}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlsymbol{covar}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlfunctioncall{try}\hlkeyword{(}\hlfunctioncall{solve}\hlkeyword{(}\hlnumber{0.5}\hlkeyword{*}\hlsymbol{fit}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{hessian}\hlkeyword{)}\hlkeyword{,}{\ }\hlargument{silent}{\ }\hlargument{=}{\ }\hlnumber{TRUE}\hlkeyword{)}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlkeyword{if}\hlkeyword{(}\hlfunctioncall{sum}\hlkeyword{(}\hlsymbol{fit}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{hessian}==\hlfunctioncall{diag}\hlkeyword{(}\hlsymbol{np}\hlkeyword{)}\hlkeyword{)}==\hlsymbol{np}\hlkeyword{*}\hlsymbol{np}\hlkeyword{)}{\ }\hlsymbol{covar}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }NULL\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlkeyword{\usebox{\hlnormalsizeboxclosebrace}}\hlkeyword{else}{\ }\hlsymbol{covar}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }NULL\hlcomment{\usebox{\hlnormalsizeboxhash}{\ }unscaled{\ }covariance}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlsymbol{fit}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{solnp.hessian}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlsymbol{fit}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{hessian}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}\hlkeyword{\usebox{\hlnormalsizeboxclosebrace}}\mbox{}
\normalfont
\end{Hinput}


\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlkeyword{if}\hlkeyword{(}\hlkeyword{!}\hlfunctioncall{is.numeric}\hlkeyword{(}\hlsymbol{covar}\hlkeyword{)}\hlkeyword{)}\hlkeyword{\usebox{\hlnormalsizeboxopenbrace}}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlsymbol{message}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlstring{"Cannot{\ }estimate{\ }covariance{\ }directly{\ }from{\ }hessian{\ }of{\ }the{\ }optimization"}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlfunctioncall{warning}\hlkeyword{(}\hlsymbol{message}\hlkeyword{)}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlfunctioncall{print}\hlkeyword{(}\hlstring{\usebox{\hlnormalsizeboxsinglequote}Now{\ }we{\ }need{\ }to{\ }estimate{\ }the{\ }Hessian{\ }matrix{\ }to{\ }get{\ }the{\ }confidence{\ }intervals.{\ }This{\ }may{\ }take{\ }a{\ }while{\ }depending{\ }on{\ }the{\ }problem(Please{\ }be{\ }patient!)\usebox{\hlnormalsizeboxsinglequote}}\hlkeyword{)}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlkeyword{if}\hlkeyword{(}\hlkeyword{!}\hlfunctioncall{is.numeric}\hlkeyword{(}\hlsymbol{covar}\hlkeyword{)}\hlkeyword{)}\hlkeyword{\usebox{\hlnormalsizeboxopenbrace}}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlsymbol{fit}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlfunctioncall{modFit1}\hlkeyword{(}\hlsymbol{cost}\hlkeyword{,}{\ }\hlsymbol{fit}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{par}\hlkeyword{,}{\ }\hlargument{lower}{\ }\hlargument{=}{\ }\hlsymbol{lower}\hlkeyword{,}{\ }\hlargument{upper}{\ }\hlargument{=}{\ }\hlsymbol{upper}\hlkeyword{,}{\ }\hlargument{method}\hlargument{=}\hlsymbol{Hmethod1}\hlkeyword{,}\hlargument{control}\hlargument{=}\hlfunctioncall{list}\hlkeyword{(}\hlkeyword{)}\hlkeyword{)}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlsymbol{optimmethod}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlfunctioncall{c}\hlkeyword{(}\hlsymbol{optimmethod}\hlkeyword{,}\hlsymbol{Hmethod1}\hlkeyword{)}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlsymbol{covar}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlsymbol{fit}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{covar}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlkeyword{if}\hlkeyword{(}\hlkeyword{!}\hlfunctioncall{is.numeric}\hlkeyword{(}\hlsymbol{covar}\hlkeyword{)}\hlkeyword{)}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlkeyword{\usebox{\hlnormalsizeboxopenbrace}}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlsymbol{message}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlstring{"Cannot{\ }estimate{\ }covariance{\ }{\ }from{\ }hessian{\ }calculated{\ }by{\ }gradient{\ }or{\ }by{\ }Hmethod1"}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlfunctioncall{warning}\hlkeyword{(}\hlsymbol{message}\hlkeyword{)}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlcomment{\usebox{\hlnormalsizeboxhash}\usebox{\hlnormalsizeboxhash}{\ }print(\usebox{\hlnormalsizeboxsinglequote}go{\ }to{\ }the{\ }third{\ }level{\ }to{\ }calculate{\ }covar\usebox{\hlnormalsizeboxsinglequote})}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlsymbol{fit}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlfunctioncall{modFit1}\hlkeyword{(}\hlsymbol{cost}\hlkeyword{,}{\ }\hlsymbol{fit}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{par}\hlkeyword{,}{\ }\hlargument{lower}{\ }\hlargument{=}{\ }\hlsymbol{lower}\hlkeyword{,}{\ }\hlargument{upper}{\ }\hlargument{=}{\ }\hlsymbol{upper}\hlkeyword{,}{\ }\hlargument{method}\hlargument{=}\hlsymbol{Hmethod2}\hlkeyword{,}\hlargument{control}\hlargument{=}\hlfunctioncall{list}\hlkeyword{(}\hlkeyword{)}\hlkeyword{)}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlsymbol{covar}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlsymbol{fit}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{covar}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlsymbol{optimmethod}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlfunctioncall{c}\hlkeyword{(}\hlsymbol{optimmethod}\hlkeyword{,}\hlsymbol{Hmethod2}\hlkeyword{)}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlkeyword{if}\hlkeyword{(}\hlkeyword{!}\hlfunctioncall{is.numeric}\hlkeyword{(}\hlsymbol{fit}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{covar}\hlkeyword{)}\hlkeyword{)}\hlkeyword{\usebox{\hlnormalsizeboxopenbrace}}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlsymbol{covar}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlsymbol{fit}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{covar}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlkeyword{\usebox{\hlnormalsizeboxclosebrace}}\hlkeyword{else}\hlkeyword{\usebox{\hlnormalsizeboxopenbrace}}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlsymbol{covar}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlfunctioncall{matrix}\hlkeyword{(}\hlargument{data}{\ }\hlargument{=}{\ }\hlnumber{NA}\hlkeyword{,}{\ }\hlargument{nrow}{\ }\hlargument{=}{\ }\hlsymbol{np}\hlkeyword{,}{\ }\hlargument{ncol}{\ }\hlargument{=}{\ }\hlsymbol{np}\hlkeyword{)}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlfunctioncall{warning}\hlkeyword{(}\hlstring{\usebox{\hlnormalsizeboxsinglequote}covar{\ }not{\ }estimable\usebox{\hlnormalsizeboxsinglequote}}\hlkeyword{)}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlkeyword{\usebox{\hlnormalsizeboxclosebrace}}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlkeyword{\usebox{\hlnormalsizeboxclosebrace}}\hlkeyword{else}\hlkeyword{\usebox{\hlnormalsizeboxopenbrace}}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlcomment{\usebox{\hlnormalsizeboxhash}\usebox{\hlnormalsizeboxhash}}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlkeyword{\usebox{\hlnormalsizeboxclosebrace}}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlkeyword{\usebox{\hlnormalsizeboxclosebrace}}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}\hlkeyword{\usebox{\hlnormalsizeboxclosebrace}}\hlkeyword{else}\hlkeyword{\usebox{\hlnormalsizeboxopenbrace}}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlsymbol{message}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlstring{"ok"}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}\hlkeyword{\usebox{\hlnormalsizeboxclosebrace}}\mbox{}
\normalfont
\end{Hinput}


\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlfunctioncall{rownames}\hlkeyword{(}\hlsymbol{covar}\hlkeyword{)}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlfunctioncall{colnames}\hlkeyword{(}\hlsymbol{covar}\hlkeyword{)}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}\hlsymbol{pnames}\mbox{}
\normalfont
\end{Hinput}


\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlsymbol{fit}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{covar}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlsymbol{covar}\mbox{}
\normalfont
\end{Hinput}


\end{normalsize}
\end{Hchunk}


Here is an extra step if using the trust algorithm to fit the
model. Various other information for summary and
plotting need to be calculated.

\begin{Hchunk}
\begin{normalsize}
\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlkeyword{if}\hlkeyword{(}\hlsymbol{method}==\hlstring{\usebox{\hlnormalsizeboxsinglequote}trust\usebox{\hlnormalsizeboxsinglequote}}\hlkeyword{)}\hlkeyword{\usebox{\hlnormalsizeboxopenbrace}}\hlcomment{\usebox{\hlnormalsizeboxhash}\usebox{\hlnormalsizeboxhash}{\ }an{\ }extra{\ }step{\ }if{\ }using{\ }the{\ }trust{\ }algorithm}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlsymbol{P}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlsymbol{fit}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{par}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlkeyword{if}{\ }\hlkeyword{(}\hlfunctioncall{length}\hlkeyword{(}\hlsymbol{state.ini.optim}\hlkeyword{)}{\ }\hlkeyword{\usebox{\hlnormalsizeboxgreaterthan}}{\ }\hlnumber{0}\hlkeyword{)}{\ }\hlkeyword{\usebox{\hlnormalsizeboxopenbrace}}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlsymbol{odeini}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlfunctioncall{c}\hlkeyword{(}\hlsymbol{P}\hlkeyword{[}\hlnumber{1}\hlkeyword{:}\hlfunctioncall{length}\hlkeyword{(}\hlsymbol{state.ini.optim}\hlkeyword{)}\hlkeyword{]}\hlkeyword{,}{\ }\hlsymbol{state.ini.fixed}\hlkeyword{)}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlfunctioncall{names}\hlkeyword{(}\hlsymbol{odeini}\hlkeyword{)}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlfunctioncall{c}\hlkeyword{(}\hlsymbol{state.ini.optim.boxnames}\hlkeyword{,}{\ }\hlsymbol{state.ini.fixed.boxnames}\hlkeyword{)}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlkeyword{\usebox{\hlnormalsizeboxclosebrace}}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlkeyword{else}{\ }\hlsymbol{odeini}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlsymbol{state.ini.fixed}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlsymbol{odeparms}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlfunctioncall{c}\hlkeyword{(}\hlsymbol{P}\hlkeyword{[}\hlkeyword{(}\hlfunctioncall{length}\hlkeyword{(}\hlsymbol{state.ini.optim}\hlkeyword{)}{\ }\hlkeyword{+}{\ }\hlnumber{1}\hlkeyword{)}\hlkeyword{:}\hlfunctioncall{length}\hlkeyword{(}\hlsymbol{P}\hlkeyword{)}\hlkeyword{]}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlsymbol{parms.fixed}\hlkeyword{)}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlcomment{\usebox{\hlnormalsizeboxhash}outtimes{\ }={\ }unique(observed\usebox{\hlnormalsizeboxdollar}time)}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlsymbol{out}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlfunctioncall{ode}\hlkeyword{(}\hlargument{y}{\ }\hlargument{=}{\ }\hlsymbol{odeini}\hlkeyword{,}{\ }\hlargument{times}{\ }\hlargument{=}{\ }\hlsymbol{outtimes}\hlkeyword{,}{\ }\hlargument{func}{\ }\hlargument{=}{\ }\hlsymbol{mkindiff}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlargument{parms}{\ }\hlargument{=}{\ }\hlsymbol{odeparms}\hlkeyword{)}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlsymbol{out\usebox{\hlnormalsizeboxunderscore}transformed}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlfunctioncall{data.frame}\hlkeyword{(}\hlargument{time}{\ }\hlargument{=}{\ }\hlsymbol{out}\hlkeyword{[}\hlkeyword{,}{\ }\hlstring{"time"}\hlkeyword{]}\hlkeyword{)}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlkeyword{for}{\ }\hlkeyword{(}\hlsymbol{var}{\ }\hlkeyword{in}{\ }\hlfunctioncall{names}\hlkeyword{(}\hlsymbol{mkinmodini}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{map}\hlkeyword{)}\hlkeyword{)}{\ }\hlkeyword{\usebox{\hlnormalsizeboxopenbrace}}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlkeyword{if}{\ }\hlkeyword{(}\hlfunctioncall{length}\hlkeyword{(}\hlsymbol{mkinmodini}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{map}\hlkeyword{[[}\hlsymbol{var}\hlkeyword{]}\hlkeyword{]}\hlkeyword{)}{\ }=={\ }\hlnumber{1}\hlkeyword{)}{\ }\hlkeyword{\usebox{\hlnormalsizeboxopenbrace}}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlsymbol{out\usebox{\hlnormalsizeboxunderscore}transformed}\hlkeyword{[}\hlsymbol{var}\hlkeyword{]}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlsymbol{out}\hlkeyword{[}\hlkeyword{,}{\ }\hlsymbol{var}\hlkeyword{]}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlkeyword{\usebox{\hlnormalsizeboxclosebrace}}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlkeyword{else}{\ }\hlkeyword{\usebox{\hlnormalsizeboxopenbrace}}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlsymbol{out\usebox{\hlnormalsizeboxunderscore}transformed}\hlkeyword{[}\hlsymbol{var}\hlkeyword{]}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlfunctioncall{rowSums}\hlkeyword{(}\hlsymbol{out}\hlkeyword{[}\hlkeyword{,}{\ }\hlsymbol{mkinmodini}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{map}\hlkeyword{[[}\hlsymbol{var}\hlkeyword{]}\hlkeyword{]}\hlkeyword{]}\hlkeyword{)}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlkeyword{\usebox{\hlnormalsizeboxclosebrace}}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlkeyword{\usebox{\hlnormalsizeboxclosebrace}}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlfunctioncall{assign}\hlkeyword{(}\hlstring{"out\usebox{\hlnormalsizeboxunderscore}predicted"}\hlkeyword{,}{\ }\hlsymbol{out\usebox{\hlnormalsizeboxunderscore}transformed}\hlkeyword{,}{\ }\hlargument{inherits}{\ }\hlargument{=}{\ }\hlnumber{TRUE}\hlkeyword{)}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}\hlkeyword{\usebox{\hlnormalsizeboxclosebrace}}\mbox{}
\normalfont
\end{Hinput}


\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlsymbol{predicted\usebox{\hlnormalsizeboxunderscore}long}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlfunctioncall{mkin\usebox{\hlnormalsizeboxunderscore}wide\usebox{\hlnormalsizeboxunderscore}to\usebox{\hlnormalsizeboxunderscore}long}\hlkeyword{(}\hlsymbol{out\usebox{\hlnormalsizeboxunderscore}predicted}\hlkeyword{,}{\ }\hlargument{time}{\ }\hlargument{=}{\ }\hlstring{"time"}\hlkeyword{)}\mbox{}
\normalfont
\end{Hinput}


\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlsymbol{fit}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{predicted}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlsymbol{out\usebox{\hlnormalsizeboxunderscore}predicted}\mbox{}
\normalfont
\end{Hinput}


\end{normalsize}
\end{Hchunk}




\begin{Hchunk}
\begin{normalsize}
\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlcomment{\usebox{\hlnormalsizeboxhash}\usebox{\hlnormalsizeboxhash}{\ }We{\ }need{\ }to{\ }return{\ }some{\ }more{\ }data{\ }for{\ }summary{\ }and{\ }plotting}\hspace*{\fill}\\
\hlstd{}\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlsymbol{fit}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{solution}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlsymbol{solution}\mbox{}
\normalfont
\end{Hinput}


\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlkeyword{if}{\ }\hlkeyword{(}\hlsymbol{solution}{\ }=={\ }\hlstring{"eigen"}\hlkeyword{)}{\ }\hlkeyword{\usebox{\hlnormalsizeboxopenbrace}}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlsymbol{fit}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{coefmat}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlsymbol{mkinmodini}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{coefmat}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}\hlkeyword{\usebox{\hlnormalsizeboxclosebrace}}\mbox{}
\normalfont
\end{Hinput}


\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlkeyword{if}{\ }\hlkeyword{(}\hlsymbol{solution}{\ }=={\ }\hlstring{"deSolve"}\hlkeyword{)}{\ }\hlkeyword{\usebox{\hlnormalsizeboxopenbrace}}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlsymbol{fit}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{mkindiff}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlsymbol{mkindiff}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}\hlkeyword{\usebox{\hlnormalsizeboxclosebrace}}\mbox{}
\normalfont
\end{Hinput}


\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlcomment{\usebox{\hlnormalsizeboxhash}\usebox{\hlnormalsizeboxhash}{\ }We{\ }also{\ }need{\ }various{\ }other{\ }information{\ }for{\ }summary{\ }and{\ }plotting}\hspace*{\fill}\\
\hlstd{}\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlsymbol{fit}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{map}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlsymbol{mkinmodini}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{map}\mbox{}
\normalfont
\end{Hinput}


\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlsymbol{fit}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{diffs}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlsymbol{mkinmodini}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{diffs}\mbox{}
\normalfont
\end{Hinput}


\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlsymbol{fit}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{observed}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlsymbol{mkinmodini}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{residue}\mbox{}
\normalfont
\end{Hinput}


\end{normalsize}
\end{Hchunk}

Collect initial parameter values in two dataframes \textsl{fixed}
and \textsl{start} to be used in the final report.

\begin{Hchunk}
\begin{normalsize}
\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlkeyword{if}\hlkeyword{(}\hlsymbol{outpartri}==\hlstring{\usebox{\hlnormalsizeboxsinglequote}default\usebox{\hlnormalsizeboxsinglequote}}\hlkeyword{)}\hlkeyword{\usebox{\hlnormalsizeboxopenbrace}}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlkeyword{if}\hlkeyword{(}\hlfunctioncall{length}\hlkeyword{(}\hlsymbol{state.ini.optim}\hlkeyword{)}\hlkeyword{\usebox{\hlnormalsizeboxgreaterthan}}\hlnumber{0}\hlkeyword{)}\hlkeyword{\usebox{\hlnormalsizeboxopenbrace}}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlsymbol{fit}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{start0}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlfunctioncall{data.frame}\hlkeyword{(}\hlargument{initial}\hlargument{=}\hlsymbol{state.ini.optim}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlargument{type}\hlargument{=}\hlfunctioncall{rep}\hlkeyword{(}\hlstring{"state"}\hlkeyword{,}{\ }\hlfunctioncall{length}\hlkeyword{(}\hlsymbol{state.ini.optim}\hlkeyword{)}\hlkeyword{)}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlargument{lower}\hlargument{=}\hlsymbol{lower}\hlkeyword{[}\hlnumber{1}\hlkeyword{:}\hlfunctioncall{length}\hlkeyword{(}\hlsymbol{state.ini.optim}\hlkeyword{)}\hlkeyword{]}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlargument{upper}\hlargument{=}\hlsymbol{upper}\hlkeyword{[}\hlnumber{1}\hlkeyword{:}\hlfunctioncall{length}\hlkeyword{(}\hlsymbol{state.ini.optim}\hlkeyword{)}\hlkeyword{]}\hlkeyword{)}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlkeyword{\usebox{\hlnormalsizeboxclosebrace}}\hlkeyword{else}\hlkeyword{\usebox{\hlnormalsizeboxopenbrace}}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlsymbol{fit}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{start0}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlfunctioncall{data.frame}\hlkeyword{(}\hlargument{initial}\hlargument{=}\hlsymbol{state.ini.optim}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlargument{type}\hlargument{=}\hlfunctioncall{rep}\hlkeyword{(}\hlstring{"state"}\hlkeyword{,}{\ }\hlfunctioncall{length}\hlkeyword{(}\hlsymbol{state.ini.optim}\hlkeyword{)}\hlkeyword{)}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlargument{lower}\hlargument{=}\hlfunctioncall{numeric}\hlkeyword{(}\hlnumber{0}\hlkeyword{)}\hlkeyword{,}\hlargument{upper}\hlargument{=}\hlfunctioncall{numeric}\hlkeyword{(}\hlnumber{0}\hlkeyword{)}\hlkeyword{)}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlkeyword{\usebox{\hlnormalsizeboxclosebrace}}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlsymbol{start0}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlsymbol{mkinmodini}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{start}\hlkeyword{[}\hlsymbol{mkinmodini}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{start}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{fixed}==\hlnumber{0}\hlkeyword{,}\hlkeyword{]}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlsymbol{fit}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{start0}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlfunctioncall{rbind}\hlkeyword{(}\hlsymbol{fit}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{start0}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlfunctioncall{data.frame}\hlkeyword{(}\hlargument{initial}\hlargument{=}\hlsymbol{start0}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{initial}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlargument{type}\hlargument{=}\hlsymbol{start0}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{type}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlargument{lower}\hlargument{=}\hlsymbol{start0}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{lower}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlargument{upper}\hlargument{=}\hlsymbol{start0}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{upper}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlargument{row.names}{\ }\hlargument{=}\hlfunctioncall{rownames}\hlkeyword{(}\hlsymbol{start0}\hlkeyword{)}\hlkeyword{)}\hlkeyword{)}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlsymbol{fit}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{fixed0}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlfunctioncall{data.frame}\hlkeyword{(}\hlargument{value}{\ }\hlargument{=}{\ }\hlsymbol{state.ini.fixed}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlargument{type}\hlargument{=}\hlfunctioncall{rep}\hlkeyword{(}\hlstring{"state"}\hlkeyword{,}{\ }\hlfunctioncall{length}\hlkeyword{(}\hlsymbol{state.ini.fixed}\hlkeyword{)}\hlkeyword{)}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlargument{by}\hlargument{=}\hlfunctioncall{rep}\hlkeyword{(}\hlstring{"user"}\hlkeyword{,}{\ }\hlfunctioncall{length}\hlkeyword{(}\hlsymbol{state.ini.fixed}\hlkeyword{)}\hlkeyword{)}\hlkeyword{)}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlsymbol{fixed0}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlsymbol{mkinmodini}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{start}\hlkeyword{[}\hlsymbol{mkinmodini}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{start}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{fixed}==\hlnumber{1}\hlkeyword{,}\hlkeyword{]}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlkeyword{if}\hlkeyword{(}\hlfunctioncall{nrow}\hlkeyword{(}\hlsymbol{fixed0}\hlkeyword{)}\hlkeyword{\usebox{\hlnormalsizeboxgreaterthan}}\hlnumber{0}\hlkeyword{)}{\ }\hlsymbol{fit}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{fixed0}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlfunctioncall{rbind}\hlkeyword{(}\hlsymbol{fit}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{fixed0}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlfunctioncall{data.frame}\hlkeyword{(}\hlargument{value}\hlargument{=}\hlsymbol{fixed0}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{initial}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlargument{type}\hlargument{=}\hlsymbol{fixed0}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{type}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlargument{by}\hlargument{=}\hlfunctioncall{rep}\hlkeyword{(}\hlstring{\usebox{\hlnormalsizeboxsinglequote}user\usebox{\hlnormalsizeboxsinglequote}}\hlkeyword{,}\hlfunctioncall{nrow}\hlkeyword{(}\hlsymbol{fixed0}\hlkeyword{)}\hlkeyword{)}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlargument{row.names}\hlargument{=}\hlfunctioncall{rownames}\hlkeyword{(}\hlsymbol{fixed0}\hlkeyword{)}\hlkeyword{)}\hlkeyword{)}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}\hlkeyword{\usebox{\hlnormalsizeboxclosebrace}}\hlkeyword{else}\hlkeyword{\usebox{\hlnormalsizeboxopenbrace}}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlsymbol{fit}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{start0}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }NULL\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlsymbol{fit}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{fixed0}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }NULL\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}\hlkeyword{\usebox{\hlnormalsizeboxclosebrace}}\mbox{}
\normalfont
\end{Hinput}


\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlsymbol{fit}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{start}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlfunctioncall{data.frame}\hlkeyword{(}\hlargument{initial}{\ }\hlargument{=}{\ }\hlfunctioncall{c}\hlkeyword{(}\hlsymbol{state.ini.optim}\hlkeyword{,}{\ }\hlsymbol{parms.optim}\hlkeyword{)}\hlkeyword{)}\mbox{}
\normalfont
\end{Hinput}


\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlsymbol{fit}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{start}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{type}{\ }\hlassignement{=}{\ }\hlfunctioncall{c}\hlkeyword{(}\hlfunctioncall{rep}\hlkeyword{(}\hlstring{"state"}\hlkeyword{,}{\ }\hlfunctioncall{length}\hlkeyword{(}\hlsymbol{state.ini.optim}\hlkeyword{)}\hlkeyword{)}\hlkeyword{,}{\ }\hlfunctioncall{rep}\hlkeyword{(}\hlstring{"deparm"}\hlkeyword{,}{\ }\hlfunctioncall{length}\hlkeyword{(}\hlsymbol{parms.optim}\hlkeyword{)}\hlkeyword{)}\hlkeyword{)}\mbox{}
\normalfont
\end{Hinput}


\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlsymbol{fit}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{start}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{lower}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlsymbol{lower}\mbox{}
\normalfont
\end{Hinput}


\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlsymbol{fit}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{start}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{upper}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlsymbol{upper}\mbox{}
\normalfont
\end{Hinput}


\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlsymbol{fit}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{fixed}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlfunctioncall{data.frame}\hlkeyword{(}\hlargument{value}{\ }\hlargument{=}{\ }\hlfunctioncall{c}\hlkeyword{(}\hlsymbol{state.ini.fixed}\hlkeyword{,}{\ }\hlsymbol{parms.fixed}\hlkeyword{)}\hlkeyword{)}\mbox{}
\normalfont
\end{Hinput}


\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlsymbol{fit}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{fixed}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{type}{\ }\hlassignement{=}{\ }\hlfunctioncall{c}\hlkeyword{(}\hlfunctioncall{rep}\hlkeyword{(}\hlstring{"state"}\hlkeyword{,}{\ }\hlfunctioncall{length}\hlkeyword{(}\hlsymbol{state.ini.fixed}\hlkeyword{)}\hlkeyword{)}\hlkeyword{,}{\ }\hlfunctioncall{rep}\hlkeyword{(}\hlstring{"deparm"}\hlkeyword{,}{\ }\hlfunctioncall{length}\hlkeyword{(}\hlsymbol{parms.fixed}\hlkeyword{)}\hlkeyword{)}\hlkeyword{)}\mbox{}
\normalfont
\end{Hinput}


\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlsymbol{fit}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{fixed}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{by}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlfunctioncall{c}\hlkeyword{(}\hlfunctioncall{rep}\hlkeyword{(}\hlstring{"user"}\hlkeyword{,}{\ }\hlfunctioncall{length}\hlkeyword{(}\hlsymbol{state.ini.fixed}\hlkeyword{)}\hlkeyword{)}\hlkeyword{,}{\ }\hlsymbol{mkinmodini}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{fixed\usebox{\hlnormalsizeboxunderscore}flag}\hlkeyword{)}\mbox{}
\normalfont
\end{Hinput}


\end{normalsize}
\end{Hchunk}


Calculate chi2 error levels according to FOCUS (2006) by calling
\textbf{chi2err()}. 0 values at sample time 0 should not be used. The
mean should be used when there are repeated
measurements.

\begin{Hchunk}
\begin{normalsize}
\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlsymbol{observed1}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlsymbol{observed}\mbox{}
\normalfont
\end{Hinput}


\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlsymbol{observed1}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlsymbol{observed}\hlkeyword{[}\hlkeyword{!}\hlkeyword{(}\hlsymbol{observed}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{time}==\hlnumber{0}{\ }\hlkeyword{\usebox{\hlnormalsizeboxand}}{\ }\hlsymbol{observed}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{value}==\hlnumber{0}\hlkeyword{)}\hlkeyword{,}\hlkeyword{]}\mbox{}
\normalfont
\end{Hinput}


\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlsymbol{means}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlfunctioncall{aggregate}\hlkeyword{(}\hlsymbol{value}{\ }\hlkeyword{\urltilda{}}{\ }\hlsymbol{time}{\ }\hlkeyword{+}{\ }\hlsymbol{name}\hlkeyword{,}{\ }\hlargument{data}{\ }\hlargument{=}{\ }\hlsymbol{observed1}\hlkeyword{,}{\ }\hlsymbol{mean}\hlkeyword{,}{\ }\hlargument{na.rm}\hlargument{=}\hlnumber{TRUE}\hlkeyword{)}\hlcomment{\usebox{\hlnormalsizeboxhash}\usebox{\hlnormalsizeboxhash}using{\ }the{\ }mean{\ }of{\ }repeated{\ }measurements.}\mbox{}
\normalfont
\end{Hinput}


\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlsymbol{errdata}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlfunctioncall{merge}\hlkeyword{(}\hlsymbol{means}\hlkeyword{,}{\ }\hlsymbol{predicted\usebox{\hlnormalsizeboxunderscore}long}\hlkeyword{,}{\ }\hlargument{by}{\ }\hlargument{=}{\ }\hlfunctioncall{c}\hlkeyword{(}\hlstring{"time"}\hlkeyword{,}{\ }\hlstring{"name"}\hlkeyword{)}\hlkeyword{,}{\ }\hlargument{suffixes}{\ }\hlargument{=}{\ }\hlfunctioncall{c}\hlkeyword{(}\hlstring{"\usebox{\hlnormalsizeboxunderscore}mean"}\hlkeyword{,}{\ }\hlstring{"\usebox{\hlnormalsizeboxunderscore}pred"}\hlkeyword{)}\hlkeyword{)}\mbox{}
\normalfont
\end{Hinput}


\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlsymbol{errobserved}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlfunctioncall{merge}\hlkeyword{(}\hlsymbol{observed}\hlkeyword{,}{\ }\hlsymbol{predicted\usebox{\hlnormalsizeboxunderscore}long}\hlkeyword{,}{\ }\hlargument{by}{\ }\hlargument{=}{\ }\hlfunctioncall{c}\hlkeyword{(}\hlstring{"time"}\hlkeyword{,}{\ }\hlstring{"name"}\hlkeyword{)}\hlkeyword{,}{\ }\hlargument{suffixes}{\ }\hlargument{=}{\ }\hlfunctioncall{c}\hlkeyword{(}\hlstring{"\usebox{\hlnormalsizeboxunderscore}obs"}\hlkeyword{,}{\ }\hlstring{"\usebox{\hlnormalsizeboxunderscore}pred"}\hlkeyword{)}\hlkeyword{)}\mbox{}
\normalfont
\end{Hinput}


\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlsymbol{errdata}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlsymbol{errdata}\hlkeyword{[}\hlfunctioncall{order}\hlkeyword{(}\hlsymbol{errdata}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{time}\hlkeyword{,}{\ }\hlsymbol{errdata}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{name}\hlkeyword{)}\hlkeyword{,}{\ }\hlkeyword{]}\mbox{}
\normalfont
\end{Hinput}


\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlsymbol{errmin.overall}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlfunctioncall{chi2err}\hlkeyword{(}\hlsymbol{errdata}\hlkeyword{,}{\ }\hlfunctioncall{length}\hlkeyword{(}\hlsymbol{parms.optim}\hlkeyword{)}{\ }\hlkeyword{+}{\ }\hlfunctioncall{length}\hlkeyword{(}\hlsymbol{state.ini.optim}\hlkeyword{)}\hlkeyword{,}\hlsymbol{errobserved}\hlkeyword{)}\mbox{}
\normalfont
\end{Hinput}


\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlsymbol{errmin}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlfunctioncall{data.frame}\hlkeyword{(}\hlargument{err.min}{\ }\hlargument{=}{\ }\hlsymbol{errmin.overall}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{err.min}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlargument{n.optim}{\ }\hlargument{=}{\ }\hlsymbol{errmin.overall}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{n.optim}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlargument{df}{\ }\hlargument{=}{\ }\hlsymbol{errmin.overall}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{df}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlargument{err.sig}{\ }\hlargument{=}{\ }\hlsymbol{errmin.overall}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{err.sig}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlargument{RMSE}\hlargument{=}\hlsymbol{errmin.overall}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{RMSE}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlargument{EF}\hlargument{=}\hlsymbol{errmin.overall}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{EF}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlargument{R2}\hlargument{=}\hlsymbol{errmin.overall}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{R2}\hlkeyword{)}\mbox{}
\normalfont
\end{Hinput}


\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlfunctioncall{rownames}\hlkeyword{(}\hlsymbol{errmin}\hlkeyword{)}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlstring{"All{\ }data"}\mbox{}
\normalfont
\end{Hinput}


\end{normalsize}
\end{Hchunk}

\begin{Hchunk}
\begin{normalsize}
\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlcomment{\usebox{\hlnormalsizeboxhash}\usebox{\hlnormalsizeboxhash}{\ }Continued}\hspace*{\fill}\\
\hlstd{}\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlkeyword{for}{\ }\hlkeyword{(}\hlsymbol{obs\usebox{\hlnormalsizeboxunderscore}var}{\ }\hlkeyword{in}{\ }\hlsymbol{obs\usebox{\hlnormalsizeboxunderscore}vars}\hlkeyword{)}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}\hlkeyword{\usebox{\hlnormalsizeboxopenbrace}}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlsymbol{errdata.var}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlfunctioncall{subset}\hlkeyword{(}\hlsymbol{errdata}\hlkeyword{,}{\ }\hlsymbol{name}{\ }=={\ }\hlsymbol{obs\usebox{\hlnormalsizeboxunderscore}var}\hlkeyword{)}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlsymbol{errobserved.var}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlfunctioncall{subset}\hlkeyword{(}\hlsymbol{errobserved}\hlkeyword{,}{\ }\hlsymbol{name}{\ }=={\ }\hlsymbol{obs\usebox{\hlnormalsizeboxunderscore}var}\hlkeyword{)}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlkeyword{if}\hlkeyword{(}\hlsymbol{outpartri}==\hlstring{\usebox{\hlnormalsizeboxsinglequote}default\usebox{\hlnormalsizeboxsinglequote}}\hlkeyword{)}\hlkeyword{\usebox{\hlnormalsizeboxopenbrace}}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlsymbol{n.k.optim}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlkeyword{(}\hlfunctioncall{paste}\hlkeyword{(}\hlstring{"k"}\hlkeyword{,}{\ }\hlsymbol{obs\usebox{\hlnormalsizeboxunderscore}var}\hlkeyword{,}{\ }\hlargument{sep}\hlargument{=}\hlstring{"\usebox{\hlnormalsizeboxunderscore}"}\hlkeyword{)}\hlkeyword{)}{\ }\hlkeyword{\usebox{\hlnormalsizeboxpercent}in\usebox{\hlnormalsizeboxpercent}}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlkeyword{(}\hlfunctioncall{names}\hlkeyword{(}\hlsymbol{parms.optim}\hlkeyword{)}\hlkeyword{)}\hlkeyword{+}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlfunctioncall{length}\hlkeyword{(}\hlfunctioncall{grep}\hlkeyword{(}\hlfunctioncall{paste}\hlkeyword{(}\hlstring{"f"}\hlkeyword{,}\hlstring{\usebox{\hlnormalsizeboxsinglequote}.*\usebox{\hlnormalsizeboxsinglequote}}\hlkeyword{,}\hlstring{\usebox{\hlnormalsizeboxsinglequote}to\usebox{\hlnormalsizeboxsinglequote}}\hlkeyword{,}\hlsymbol{obs\usebox{\hlnormalsizeboxunderscore}var}\hlkeyword{,}\hlargument{sep}\hlargument{=}\hlstring{"\usebox{\hlnormalsizeboxunderscore}"}\hlkeyword{)}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlfunctioncall{names}\hlkeyword{(}\hlsymbol{parms.optim}\hlkeyword{)}\hlkeyword{)}\hlkeyword{)}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlkeyword{\usebox{\hlnormalsizeboxclosebrace}}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlkeyword{if}\hlkeyword{}\hlkeyword{(}\hlsymbol{outpartri}==\hlstring{\usebox{\hlnormalsizeboxsinglequote}water-sediment\usebox{\hlnormalsizeboxsinglequote}}\hlkeyword{)}\hlkeyword{\usebox{\hlnormalsizeboxopenbrace}}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlsymbol{n.k.optim}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlfunctioncall{length}\hlkeyword{(}\hlfunctioncall{grep}\hlkeyword{(}\hlfunctioncall{paste}\hlkeyword{(}\hlstring{"k\usebox{\hlnormalsizeboxunderscore}"}\hlkeyword{,}{\ }\hlsymbol{obs\usebox{\hlnormalsizeboxunderscore}var}\hlkeyword{,}{\ }\hlstring{\usebox{\hlnormalsizeboxsinglequote}\usebox{\hlnormalsizeboxunderscore}\usebox{\hlnormalsizeboxsinglequote}}\hlkeyword{,}\hlargument{sep}\hlargument{=}\hlstring{""}\hlkeyword{)}\hlkeyword{,}{\ }\hlfunctioncall{names}\hlkeyword{(}\hlsymbol{parms.optim}\hlkeyword{)}\hlkeyword{)}\hlkeyword{)}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlkeyword{\usebox{\hlnormalsizeboxclosebrace}}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlsymbol{n.initials.optim}\hlsymbol{}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlfunctioncall{as.numeric}\hlkeyword{(}\hlkeyword{(}\hlfunctioncall{paste}\hlkeyword{(}\hlstring{\usebox{\hlnormalsizeboxsinglequote}M0\usebox{\hlnormalsizeboxunderscore}\usebox{\hlnormalsizeboxsinglequote}}\hlkeyword{,}\hlsymbol{obs\usebox{\hlnormalsizeboxunderscore}var}\hlkeyword{,}{\ }\hlargument{sep}\hlargument{=}\hlstring{""}\hlkeyword{)}\hlkeyword{)}{\ }\hlkeyword{\usebox{\hlnormalsizeboxpercent}in\usebox{\hlnormalsizeboxpercent}}{\ }\hlkeyword{(}\hlfunctioncall{names}\hlkeyword{(}\hlsymbol{state.ini.optim}\hlkeyword{)}\hlkeyword{)}\hlkeyword{)}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlsymbol{n.optim}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlsymbol{n.k.optim}{\ }\hlkeyword{+}{\ }\hlsymbol{n.initials.optim}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlsymbol{k1name}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlfunctioncall{paste}\hlkeyword{(}\hlstring{"k1"}\hlkeyword{,}{\ }\hlsymbol{obs\usebox{\hlnormalsizeboxunderscore}var}\hlkeyword{,}{\ }{\ }\hlargument{sep}\hlargument{=}\hlstring{"\usebox{\hlnormalsizeboxunderscore}"}\hlkeyword{)}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlsymbol{k2name}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlfunctioncall{paste}\hlkeyword{(}\hlstring{"k2"}\hlkeyword{,}{\ }\hlsymbol{obs\usebox{\hlnormalsizeboxunderscore}var}\hlkeyword{,}{\ }{\ }\hlargument{sep}\hlargument{=}\hlstring{"\usebox{\hlnormalsizeboxunderscore}"}\hlkeyword{)}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlsymbol{gname}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlfunctioncall{paste}\hlkeyword{(}\hlstring{"g"}\hlkeyword{,}{\ }\hlsymbol{obs\usebox{\hlnormalsizeboxunderscore}var}\hlkeyword{,}{\ }{\ }\hlargument{sep}\hlargument{=}\hlstring{"\usebox{\hlnormalsizeboxunderscore}"}\hlkeyword{)}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlsymbol{tbname}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlfunctioncall{paste}\hlkeyword{(}\hlstring{"tb"}\hlkeyword{,}{\ }\hlsymbol{obs\usebox{\hlnormalsizeboxunderscore}var}\hlkeyword{,}{\ }{\ }\hlargument{sep}\hlargument{=}\hlstring{"\usebox{\hlnormalsizeboxunderscore}"}\hlkeyword{)}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlsymbol{alphaname}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlfunctioncall{paste}\hlkeyword{(}\hlstring{"alpha"}\hlkeyword{,}{\ }\hlsymbol{obs\usebox{\hlnormalsizeboxunderscore}var}\hlkeyword{,}{\ }{\ }\hlargument{sep}\hlargument{=}\hlstring{"\usebox{\hlnormalsizeboxunderscore}"}\hlkeyword{)}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlsymbol{betaname}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlfunctioncall{paste}\hlkeyword{(}\hlstring{"beta"}\hlkeyword{,}{\ }\hlsymbol{obs\usebox{\hlnormalsizeboxunderscore}var}\hlkeyword{,}{\ }{\ }\hlargument{sep}\hlargument{=}\hlstring{"\usebox{\hlnormalsizeboxunderscore}"}\hlkeyword{)}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlkeyword{if}{\ }\hlkeyword{(}\hlsymbol{alphaname}{\ }\hlkeyword{\usebox{\hlnormalsizeboxpercent}in\usebox{\hlnormalsizeboxpercent}}{\ }\hlfunctioncall{names}\hlkeyword{(}\hlsymbol{parms.optim}\hlkeyword{)}\hlkeyword{)}{\ }\hlsymbol{n.optim}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlsymbol{n.optim}{\ }\hlkeyword{+}{\ }\hlnumber{1}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlkeyword{if}\hlkeyword{}{\ }\hlkeyword{(}\hlsymbol{betaname}{\ }\hlkeyword{\usebox{\hlnormalsizeboxpercent}in\usebox{\hlnormalsizeboxpercent}}{\ }\hlfunctioncall{names}\hlkeyword{(}\hlsymbol{parms.optim}\hlkeyword{)}\hlkeyword{)}{\ }\hlsymbol{n.optim}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlsymbol{n.optim}{\ }\hlkeyword{+}{\ }\hlnumber{1}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlkeyword{if}\hlkeyword{}{\ }\hlkeyword{(}\hlsymbol{k1name}{\ }\hlkeyword{\usebox{\hlnormalsizeboxpercent}in\usebox{\hlnormalsizeboxpercent}}{\ }\hlfunctioncall{names}\hlkeyword{(}\hlsymbol{parms.optim}\hlkeyword{)}\hlkeyword{)}{\ }\hlsymbol{n.optim}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlsymbol{n.optim}{\ }\hlkeyword{+}{\ }\hlnumber{1}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlkeyword{if}\hlkeyword{}{\ }\hlkeyword{(}\hlsymbol{k2name}{\ }\hlkeyword{\usebox{\hlnormalsizeboxpercent}in\usebox{\hlnormalsizeboxpercent}}{\ }\hlfunctioncall{names}\hlkeyword{(}\hlsymbol{parms.optim}\hlkeyword{)}\hlkeyword{)}{\ }\hlsymbol{n.optim}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlsymbol{n.optim}{\ }\hlkeyword{+}{\ }\hlnumber{1}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlkeyword{if}\hlkeyword{}{\ }\hlkeyword{(}\hlsymbol{gname}{\ }\hlkeyword{\usebox{\hlnormalsizeboxpercent}in\usebox{\hlnormalsizeboxpercent}}{\ }\hlfunctioncall{names}\hlkeyword{(}\hlsymbol{parms.optim}\hlkeyword{)}\hlkeyword{)}{\ }\hlsymbol{n.optim}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlsymbol{n.optim}{\ }\hlkeyword{+}{\ }\hlnumber{1}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlkeyword{if}\hlkeyword{}{\ }\hlkeyword{(}\hlsymbol{tbname}{\ }\hlkeyword{\usebox{\hlnormalsizeboxpercent}in\usebox{\hlnormalsizeboxpercent}}{\ }\hlfunctioncall{names}\hlkeyword{(}\hlsymbol{parms.optim}\hlkeyword{)}\hlkeyword{)}{\ }\hlsymbol{n.optim}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlsymbol{n.optim}{\ }\hlkeyword{+}{\ }\hlnumber{1}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlsymbol{errmin.tmp}\hlsymbol{}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlfunctioncall{chi2err}\hlkeyword{(}\hlsymbol{errdata.var}\hlkeyword{,}{\ }\hlsymbol{n.optim}\hlkeyword{,}\hlsymbol{errobserved.var}\hlkeyword{)}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlsymbol{errmin}\hlkeyword{[}\hlsymbol{obs\usebox{\hlnormalsizeboxunderscore}var}\hlkeyword{,}{\ }\hlfunctioncall{c}\hlkeyword{(}\hlstring{"err.min"}\hlkeyword{,}{\ }\hlstring{"n.optim"}\hlkeyword{,}{\ }\hlstring{"df"}\hlkeyword{,}\hlstring{\usebox{\hlnormalsizeboxsinglequote}err.sig\usebox{\hlnormalsizeboxsinglequote}}\hlkeyword{,}\hlstring{\usebox{\hlnormalsizeboxsinglequote}RMSE\usebox{\hlnormalsizeboxsinglequote}}\hlkeyword{,}\hlstring{\usebox{\hlnormalsizeboxsinglequote}EF\usebox{\hlnormalsizeboxsinglequote}}\hlkeyword{,}\hlstring{\usebox{\hlnormalsizeboxsinglequote}R2\usebox{\hlnormalsizeboxsinglequote}}\hlkeyword{)}\hlkeyword{]}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlsymbol{errmin.tmp}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}\hlkeyword{\usebox{\hlnormalsizeboxclosebrace}}\mbox{}
\normalfont
\end{Hinput}


\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlsymbol{fit}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{errmin}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlsymbol{errmin}\mbox{}
\normalfont
\end{Hinput}


\end{normalsize}
\end{Hchunk}

\newpage
Calculate dissipation times DT50 and DT90 and formation fractions, we
only take the part with \textbf{outpartri} being the default one.

\begin{Hchunk}
\begin{normalsize}
\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlsymbol{parms.all}{\ }\hlassignement{=}{\ }\hlfunctioncall{c}\hlkeyword{(}\hlsymbol{fit}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{par}\hlkeyword{,}{\ }\hlsymbol{parms.fixed}\hlkeyword{)}\mbox{}
\normalfont
\end{Hinput}


\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlsymbol{fit}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{distimes}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlfunctioncall{data.frame}\hlkeyword{(}\hlargument{DT50}{\ }\hlargument{=}{\ }\hlfunctioncall{rep}\hlkeyword{(}\hlnumber{NA}\hlkeyword{,}{\ }\hlfunctioncall{length}\hlkeyword{(}\hlsymbol{obs\usebox{\hlnormalsizeboxunderscore}vars}\hlkeyword{)}\hlkeyword{)}\hlkeyword{,}{\ }\hlargument{DT90}{\ }\hlargument{=}{\ }\hlfunctioncall{rep}\hlkeyword{(}\hlnumber{NA}\hlkeyword{,}{\ }\hlfunctioncall{length}\hlkeyword{(}\hlsymbol{obs\usebox{\hlnormalsizeboxunderscore}vars}\hlkeyword{)}\hlkeyword{)}\hlkeyword{,}\hlargument{Kinetic}\hlargument{=}\hlfunctioncall{rep}\hlkeyword{(}\hlnumber{NA}\hlkeyword{,}\hlfunctioncall{length}\hlkeyword{(}\hlsymbol{obs\usebox{\hlnormalsizeboxunderscore}vars}\hlkeyword{)}\hlkeyword{)}\hlkeyword{,}\hlargument{row.names}{\ }\hlargument{=}{\ }\hlsymbol{obs\usebox{\hlnormalsizeboxunderscore}vars}\hlkeyword{)}\mbox{}
\normalfont
\end{Hinput}


\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlkeyword{if}\hlkeyword{(}\hlsymbol{mkinmodini}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{outpartri}==\hlstring{\usebox{\hlnormalsizeboxsinglequote}default\usebox{\hlnormalsizeboxsinglequote}}\hlkeyword{)}\hlkeyword{\usebox{\hlnormalsizeboxopenbrace}}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}\hlkeyword{\usebox{\hlnormalsizeboxclosebrace}}\mbox{}
\normalfont
\end{Hinput}


\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlkeyword{if}\hlkeyword{(}\hlsymbol{mkinmodini}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{outpartri}==\hlstring{\usebox{\hlnormalsizeboxsinglequote}water-sediment\usebox{\hlnormalsizeboxsinglequote}}\hlkeyword{)}\hlkeyword{\usebox{\hlnormalsizeboxopenbrace}}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }\hlkeyword{\usebox{\hlnormalsizeboxclosebrace}}\mbox{}
\normalfont
\end{Hinput}


\end{normalsize}
\end{Hchunk}

\begin{Hchunk}
\begin{normalsize}
\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlkeyword{if}\hlkeyword{(}\hlsymbol{mkinmodini}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{outpartri}==\hlstring{\usebox{\hlnormalsizeboxsinglequote}default\usebox{\hlnormalsizeboxsinglequote}}\hlkeyword{)}\hlkeyword{\usebox{\hlnormalsizeboxopenbrace}}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlsymbol{fit}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{ff}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlfunctioncall{vector}\hlkeyword{(}\hlkeyword{)}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlsymbol{ff\usebox{\hlnormalsizeboxunderscore}names}{\ }\hlassignement{=}{\ }\hlfunctioncall{names}\hlkeyword{(}\hlsymbol{mkinmodini}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{ff}\hlkeyword{)}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlkeyword{for}{\ }\hlkeyword{(}\hlsymbol{ff\usebox{\hlnormalsizeboxunderscore}name}{\ }\hlkeyword{in}{\ }\hlsymbol{ff\usebox{\hlnormalsizeboxunderscore}names}\hlkeyword{)}\hlkeyword{\usebox{\hlnormalsizeboxopenbrace}}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlsymbol{fit}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{ff}\hlkeyword{[[}\hlsymbol{ff\usebox{\hlnormalsizeboxunderscore}name}\hlkeyword{]}\hlkeyword{]}\hlassignement{=}\hlfunctioncall{eval}\hlkeyword{(}\hlfunctioncall{parse}\hlkeyword{(}{\ }\hlargument{text}{\ }\hlargument{=}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlsymbol{mkinmodini}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{ff}\hlkeyword{[}\hlsymbol{ff\usebox{\hlnormalsizeboxunderscore}name}\hlkeyword{]}\hlkeyword{)}\hlkeyword{,}{\ }\hlfunctioncall{as.list}\hlkeyword{(}\hlsymbol{parms.all}\hlkeyword{)}\hlkeyword{)}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlkeyword{\usebox{\hlnormalsizeboxclosebrace}}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlkeyword{for}{\ }\hlkeyword{(}\hlsymbol{obs\usebox{\hlnormalsizeboxunderscore}var}{\ }\hlkeyword{in}{\ }\hlsymbol{obs\usebox{\hlnormalsizeboxunderscore}vars}\hlkeyword{)}{\ }\hlkeyword{\usebox{\hlnormalsizeboxopenbrace}}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlsymbol{f\usebox{\hlnormalsizeboxunderscore}tot}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlfunctioncall{grep}\hlkeyword{(}\hlfunctioncall{paste}\hlkeyword{(}\hlsymbol{obs\usebox{\hlnormalsizeboxunderscore}var}\hlkeyword{,}{\ }\hlstring{"\usebox{\hlnormalsizeboxunderscore}"}\hlkeyword{,}\hlargument{sep}\hlargument{=}\hlstring{\usebox{\hlnormalsizeboxsinglequote}\usebox{\hlnormalsizeboxsinglequote}}\hlkeyword{)}\hlkeyword{,}{\ }\hlfunctioncall{names}\hlkeyword{(}\hlsymbol{fit}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{ff}\hlkeyword{)}\hlkeyword{,}{\ }\hlargument{value}\hlargument{=}\hlnumber{TRUE}\hlkeyword{)}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlsymbol{f\usebox{\hlnormalsizeboxunderscore}exp}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlfunctioncall{grep}\hlkeyword{(}\hlfunctioncall{paste}\hlkeyword{(}\hlsymbol{obs\usebox{\hlnormalsizeboxunderscore}var}\hlkeyword{,}{\ }\hlstring{"to"}\hlkeyword{,}\hlsymbol{obs\usebox{\hlnormalsizeboxunderscore}var}\hlkeyword{,}\hlargument{sep}\hlargument{=}\hlstring{\usebox{\hlnormalsizeboxsinglequote}\usebox{\hlnormalsizeboxunderscore}\usebox{\hlnormalsizeboxsinglequote}}\hlkeyword{)}\hlkeyword{,}{\ }\hlfunctioncall{names}\hlkeyword{(}\hlsymbol{fit}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{ff}\hlkeyword{)}\hlkeyword{,}{\ }\hlargument{value}\hlargument{=}\hlnumber{TRUE}\hlkeyword{)}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlsymbol{f\usebox{\hlnormalsizeboxunderscore}exp1}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlfunctioncall{grep}\hlkeyword{(}\hlfunctioncall{paste}\hlkeyword{(}\hlsymbol{obs\usebox{\hlnormalsizeboxunderscore}var}\hlkeyword{,}{\ }\hlstring{"to"}\hlkeyword{,}\hlstring{\usebox{\hlnormalsizeboxsinglequote}sink\usebox{\hlnormalsizeboxsinglequote}}\hlkeyword{,}\hlargument{sep}\hlargument{=}\hlstring{\usebox{\hlnormalsizeboxsinglequote}\usebox{\hlnormalsizeboxunderscore}\usebox{\hlnormalsizeboxsinglequote}}\hlkeyword{)}\hlkeyword{,}{\ }\hlfunctioncall{names}\hlkeyword{(}\hlsymbol{fit}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{ff}\hlkeyword{)}\hlkeyword{,}{\ }\hlargument{value}\hlargument{=}\hlnumber{TRUE}\hlkeyword{)}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlsymbol{fit}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{ff}\hlkeyword{[[}\hlfunctioncall{paste}\hlkeyword{(}\hlsymbol{obs\usebox{\hlnormalsizeboxunderscore}var}\hlkeyword{,}\hlstring{\usebox{\hlnormalsizeboxsinglequote}to\usebox{\hlnormalsizeboxsinglequote}}\hlkeyword{,}{\ }\hlstring{"sink"}\hlkeyword{,}{\ }\hlargument{sep}\hlargument{=}\hlstring{"\usebox{\hlnormalsizeboxunderscore}"}\hlkeyword{)}\hlkeyword{]}\hlkeyword{]}{\ }\hlassignement{=}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlnumber{1}{\ }\hlkeyword{-}{\ }\hlfunctioncall{sum}\hlkeyword{(}\hlsymbol{fit}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{ff}\hlkeyword{[}\hlsymbol{f\usebox{\hlnormalsizeboxunderscore}tot}\hlkeyword{]}\hlkeyword{)}\hlkeyword{+}\hlfunctioncall{sum}\hlkeyword{(}\hlsymbol{fit}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{ff}\hlkeyword{[}\hlsymbol{f\usebox{\hlnormalsizeboxunderscore}exp}\hlkeyword{]}\hlkeyword{)}\hlkeyword{+}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlfunctioncall{sum}\hlkeyword{(}\hlsymbol{fit}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{ff}\hlkeyword{[}\hlsymbol{f\usebox{\hlnormalsizeboxunderscore}exp1}\hlkeyword{]}\hlkeyword{)}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlsymbol{type}{\ }\hlassignement{=}{\ }\hlfunctioncall{names}\hlkeyword{(}\hlsymbol{mkinmodini}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{map}\hlkeyword{[[}\hlsymbol{obs\usebox{\hlnormalsizeboxunderscore}var}\hlkeyword{]}\hlkeyword{]}\hlkeyword{)}\hlkeyword{[}\hlnumber{1}\hlkeyword{]}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlsymbol{k1name}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlfunctioncall{paste}\hlkeyword{(}\hlstring{"k1"}\hlkeyword{,}{\ }\hlsymbol{obs\usebox{\hlnormalsizeboxunderscore}var}\hlkeyword{,}{\ }{\ }\hlargument{sep}\hlargument{=}\hlstring{"\usebox{\hlnormalsizeboxunderscore}"}\hlkeyword{)}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlsymbol{k2name}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlfunctioncall{paste}\hlkeyword{(}\hlstring{"k2"}\hlkeyword{,}{\ }\hlsymbol{obs\usebox{\hlnormalsizeboxunderscore}var}\hlkeyword{,}{\ }{\ }\hlargument{sep}\hlargument{=}\hlstring{"\usebox{\hlnormalsizeboxunderscore}"}\hlkeyword{)}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlsymbol{tbname}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlfunctioncall{paste}\hlkeyword{(}\hlstring{"tb"}\hlkeyword{,}{\ }\hlsymbol{obs\usebox{\hlnormalsizeboxunderscore}var}\hlkeyword{,}{\ }{\ }\hlargument{sep}\hlargument{=}\hlstring{"\usebox{\hlnormalsizeboxunderscore}"}\hlkeyword{)}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlcomment{\usebox{\hlnormalsizeboxhash}\usebox{\hlnormalsizeboxhash}{\ }Here{\ }we{\ }omit{\ }{\ }"FOMC",{\ }"DFOP","SFORB"}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlkeyword{if}{\ }\hlkeyword{(}\hlsymbol{type}{\ }=={\ }\hlstring{"SFO"}\hlkeyword{)}{\ }\hlkeyword{\usebox{\hlnormalsizeboxopenbrace}}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlsymbol{k\usebox{\hlnormalsizeboxunderscore}name}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlfunctioncall{paste}\hlkeyword{(}\hlstring{"k"}\hlkeyword{,}{\ }\hlsymbol{obs\usebox{\hlnormalsizeboxunderscore}var}\hlkeyword{,}\hlargument{sep}\hlargument{=}\hlstring{"\usebox{\hlnormalsizeboxunderscore}"}\hlkeyword{)}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlsymbol{k\usebox{\hlnormalsizeboxunderscore}tot}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlsymbol{parms.all}\hlkeyword{[}\hlsymbol{k\usebox{\hlnormalsizeboxunderscore}name}\hlkeyword{]}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlsymbol{DT50}{\ }\hlassignement{=}{\ }\hlfunctioncall{log}\hlkeyword{(}\hlnumber{2}\hlkeyword{)}\hlkeyword{/}\hlsymbol{k\usebox{\hlnormalsizeboxunderscore}tot}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlsymbol{DT90}{\ }\hlassignement{=}{\ }\hlfunctioncall{log}\hlkeyword{(}\hlnumber{10}\hlkeyword{)}\hlkeyword{/}\hlsymbol{k\usebox{\hlnormalsizeboxunderscore}tot}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlkeyword{\usebox{\hlnormalsizeboxclosebrace}}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlkeyword{if}\hlkeyword{}{\ }\hlkeyword{(}\hlsymbol{type}{\ }=={\ }\hlstring{"HS"}\hlkeyword{)}{\ }\hlkeyword{\usebox{\hlnormalsizeboxopenbrace}}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlsymbol{k1}{\ }\hlassignement{=}{\ }\hlsymbol{parms.all}\hlkeyword{[}\hlsymbol{k1name}\hlkeyword{]}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlsymbol{k2}{\ }\hlassignement{=}{\ }\hlsymbol{parms.all}\hlkeyword{[}\hlsymbol{k2name}\hlkeyword{]}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlsymbol{tb}{\ }\hlassignement{=}{\ }\hlsymbol{parms.all}\hlkeyword{[}\hlsymbol{tbname}\hlkeyword{]}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlsymbol{f}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlkeyword{function}\hlkeyword{(}\hlformalargs{t}\hlkeyword{,}{\ }\hlformalargs{x}\hlkeyword{)}{\ }\hlkeyword{\usebox{\hlnormalsizeboxopenbrace}}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlsymbol{fraction}{\ }\hlassignement{=}{\ }\hlfunctioncall{ifelse}\hlkeyword{(}\hlsymbol{t}{\ }\usebox{\hlnormalsizeboxlessthan}={\ }\hlsymbol{tb}\hlkeyword{,}{\ }\hlfunctioncall{exp}\hlkeyword{(}\hlkeyword{-}\hlsymbol{k1}{\ }\hlkeyword{*}{\ }\hlsymbol{t}\hlkeyword{)}\hlkeyword{,}{\ }\hlfunctioncall{exp}\hlkeyword{(}\hlkeyword{-}\hlsymbol{k1}{\ }\hlkeyword{*}{\ }\hlsymbol{tb}\hlkeyword{)}{\ }\hlkeyword{*}{\ }\hlfunctioncall{exp}\hlkeyword{(}\hlkeyword{-}\hlsymbol{k2}{\ }\hlkeyword{*}{\ }\hlkeyword{(}\hlsymbol{t}{\ }\hlkeyword{-}{\ }\hlsymbol{tb}\hlkeyword{)}\hlkeyword{)}\hlkeyword{)}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlkeyword{(}\hlsymbol{fraction}{\ }\hlkeyword{-}{\ }\hlkeyword{(}\hlnumber{1}{\ }\hlkeyword{-}{\ }\hlsymbol{x}\hlkeyword{/}\hlnumber{100}\hlkeyword{)}\hlkeyword{)}\hlkeyword{\usebox{\hlnormalsizeboxhat}}\hlnumber{2}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlkeyword{\usebox{\hlnormalsizeboxclosebrace}}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlsymbol{DTmax}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlnumber{1000}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlsymbol{hso1}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlfunctioncall{nlminb}\hlkeyword{(}\hlnumber{0.0001}\hlkeyword{,}\hlsymbol{f}\hlkeyword{,}{\ }\hlargument{x}\hlargument{=}\hlnumber{50}\hlkeyword{)}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlsymbol{hso2}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlfunctioncall{nlminb}\hlkeyword{(}\hlsymbol{tb}\hlkeyword{,}\hlsymbol{f}\hlkeyword{,}{\ }\hlargument{x}\hlargument{=}\hlnumber{50}\hlkeyword{)}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlsymbol{DT50.o}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlfunctioncall{ifelse}\hlkeyword{(}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlsymbol{hso1}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{objective}\usebox{\hlnormalsizeboxlessthan}=\hlsymbol{hso2}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{objective}\hlkeyword{,}{\ }\hlsymbol{hso1}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{par}\hlkeyword{,}\hlsymbol{hso2}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{par}\hlkeyword{)}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlsymbol{DT50}{\ }\hlassignement{=}{\ }\hlfunctioncall{ifelse}\hlkeyword{(}\hlsymbol{DTmax}{\ }\hlkeyword{-}{\ }\hlsymbol{DT50.o}{\ }\hlkeyword{\usebox{\hlnormalsizeboxlessthan}}{\ }\hlnumber{0.1}\hlkeyword{,}{\ }\hlnumber{NA}\hlkeyword{,}{\ }\hlsymbol{DT50.o}\hlkeyword{)}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlcomment{\usebox{\hlnormalsizeboxhash}\usebox{\hlnormalsizeboxhash}{\ }Here{\ }we{\ }omit{\ }DT90{\ }calculation{\ }part}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlkeyword{\usebox{\hlnormalsizeboxclosebrace}}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlsymbol{fit}\hlsymbol{}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{distimes}\hlkeyword{[}\hlsymbol{obs\usebox{\hlnormalsizeboxunderscore}var}\hlkeyword{,}{\ }\hlkeyword{]}{\ }\hlassignement{=}{\ }\hlfunctioncall{c}\hlkeyword{(}\hlfunctioncall{ifelse}\hlkeyword{(}\hlfunctioncall{is.na}\hlkeyword{(}\hlsymbol{DT50}\hlkeyword{)}\hlkeyword{,}\hlnumber{NA}\hlkeyword{,}\hlfunctioncall{formatC}\hlkeyword{(}\hlsymbol{DT50}\hlkeyword{,}\hlnumber{4}\hlkeyword{,}\hlargument{format}\hlargument{=}\hlstring{\usebox{\hlnormalsizeboxsinglequote}f\usebox{\hlnormalsizeboxsinglequote}}\hlkeyword{)}\hlkeyword{)}\hlkeyword{,}{\ }\hlfunctioncall{ifelse}\hlkeyword{(}\hlfunctioncall{is.na}\hlkeyword{(}\hlsymbol{DT90}\hlkeyword{)}\hlkeyword{,}\hlnumber{NA}\hlkeyword{,}\hlfunctioncall{formatC}\hlkeyword{(}\hlsymbol{DT90}\hlkeyword{,}\hlnumber{4}\hlkeyword{,}\hlargument{format}\hlargument{=}\hlstring{\usebox{\hlnormalsizeboxsinglequote}f\usebox{\hlnormalsizeboxsinglequote}}\hlkeyword{)}\hlkeyword{)}\hlkeyword{,}\hlsymbol{type}\hlkeyword{)}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }\hlkeyword{\usebox{\hlnormalsizeboxclosebrace}}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}\hlkeyword{\usebox{\hlnormalsizeboxclosebrace}}\mbox{}
\normalfont
\end{Hinput}


\end{normalsize}
\end{Hchunk}


Collect observed, predicted and residuals into a data frame to write
into the final report.

\begin{Hchunk}
\begin{normalsize}
\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlcomment{\usebox{\hlnormalsizeboxhash}\usebox{\hlnormalsizeboxhash}{\ }Collect{\ }observed,{\ }predicted{\ }and{\ }residuals}\hspace*{\fill}\\
\hlstd{}\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlsymbol{observed0}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }{\ }\hlfunctioncall{mkin\usebox{\hlnormalsizeboxunderscore}wide\usebox{\hlnormalsizeboxunderscore}to\usebox{\hlnormalsizeboxunderscore}long}\hlkeyword{(}\hlsymbol{mkinmodini}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{data0}\hlkeyword{,}\hspace*{\fill}\\
\hlstd{}\hlprompt{+{\ }}{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }{\ }\hlargument{time}\hlargument{=}\hlstring{\usebox{\hlnormalsizeboxsinglequote}time\usebox{\hlnormalsizeboxsinglequote}}\hlkeyword{)}\mbox{}
\normalfont
\end{Hinput}


\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlsymbol{observed0}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{err}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlsymbol{observed}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{err}\mbox{}
\normalfont
\end{Hinput}


\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlsymbol{data}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlfunctioncall{merge}\hlkeyword{(}\hlsymbol{observed}\hlkeyword{,}{\ }\hlsymbol{predicted\usebox{\hlnormalsizeboxunderscore}long}\hlkeyword{,}{\ }\hlargument{by}{\ }\hlargument{=}{\ }\hlfunctioncall{c}\hlkeyword{(}\hlstring{"time"}\hlkeyword{,}{\ }\hlstring{"name"}\hlkeyword{)}\hlkeyword{)}\mbox{}
\normalfont
\end{Hinput}


\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlsymbol{data0}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlfunctioncall{merge}\hlkeyword{(}\hlsymbol{observed0}\hlkeyword{,}{\ }\hlsymbol{predicted\usebox{\hlnormalsizeboxunderscore}long}\hlkeyword{,}{\ }\hlargument{by}{\ }\hlargument{=}{\ }\hlfunctioncall{c}\hlkeyword{(}\hlstring{"time"}\hlkeyword{,}{\ }\hlstring{"name"}\hlkeyword{)}\hlkeyword{)}\mbox{}
\normalfont
\end{Hinput}


\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlfunctioncall{names}\hlkeyword{(}\hlsymbol{data}\hlkeyword{)}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlfunctioncall{c}\hlkeyword{(}\hlstring{"time"}\hlkeyword{,}{\ }\hlstring{"variable"}\hlkeyword{,}{\ }\hlstring{"observed"}\hlkeyword{,}\hlstring{"err-std"}\hlkeyword{,}{\ }\hlstring{"predicted"}\hlkeyword{)}\mbox{}
\normalfont
\end{Hinput}


\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlfunctioncall{names}\hlkeyword{(}\hlsymbol{data0}\hlkeyword{)}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlfunctioncall{c}\hlkeyword{(}\hlstring{"time"}\hlkeyword{,}{\ }\hlstring{"variable"}\hlkeyword{,}{\ }\hlstring{"observed"}\hlkeyword{,}\hlstring{"err-std"}\hlkeyword{,}{\ }\hlstring{"predicted"}\hlkeyword{)}\mbox{}
\normalfont
\end{Hinput}


\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlsymbol{data}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{residual}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlsymbol{data}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{observed}{\ }\hlkeyword{-}{\ }\hlsymbol{data}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{predicted}\mbox{}
\normalfont
\end{Hinput}


\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlsymbol{data0}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{residual}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlsymbol{data}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{residual}\mbox{}
\normalfont
\end{Hinput}


\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlsymbol{data}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{variable}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlfunctioncall{ordered}\hlkeyword{(}\hlsymbol{data}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{variable}\hlkeyword{,}{\ }\hlargument{levels}{\ }\hlargument{=}{\ }\hlsymbol{obs\usebox{\hlnormalsizeboxunderscore}vars}\hlkeyword{)}\mbox{}
\normalfont
\end{Hinput}


\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlsymbol{data0}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{variable}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlsymbol{data}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{variable}\mbox{}
\normalfont
\end{Hinput}


\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlsymbol{tmpid}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlfunctioncall{is.na}\hlkeyword{(}\hlsymbol{data0}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{residual}\hlkeyword{)}{\ }\hlkeyword{\usebox{\hlnormalsizeboxand}}{\ }\hlkeyword{!}\hlfunctioncall{is.na}\hlkeyword{(}\hlsymbol{data0}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{observed}\hlkeyword{)}\mbox{}
\normalfont
\end{Hinput}


\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlsymbol{data0}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlstring{\usebox{\hlnormalsizeboxsinglequote}err-std\usebox{\hlnormalsizeboxsinglequote}}\hlkeyword{[}\hlsymbol{tmpid}\hlkeyword{]}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlnumber{0}\mbox{}
\normalfont
\end{Hinput}


\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlsymbol{fit}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{data}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlsymbol{data}\hlkeyword{[}\hlfunctioncall{order}\hlkeyword{(}\hlsymbol{data}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{variable}\hlkeyword{,}{\ }\hlsymbol{data}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{time}\hlkeyword{)}\hlkeyword{,}{\ }\hlkeyword{]}\mbox{}
\normalfont
\end{Hinput}


\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlsymbol{fit}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{data0}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlsymbol{data0}\hlkeyword{[}\hlfunctioncall{order}\hlkeyword{(}\hlsymbol{data0}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{variable}\hlkeyword{,}{\ }\hlsymbol{data0}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{time}\hlkeyword{)}\hlkeyword{,}{\ }\hlkeyword{]}\mbox{}
\normalfont
\end{Hinput}


\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlsymbol{fit}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{atol}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlsymbol{atol}\mbox{}
\normalfont
\end{Hinput}


\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlsymbol{fit}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{inpartri}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlsymbol{inpartri}\mbox{}
\normalfont
\end{Hinput}


\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlsymbol{fit}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{outpartri}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlsymbol{outpartri}\mbox{}
\normalfont
\end{Hinput}


\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlsymbol{fit}\hlkeyword{\usebox{\hlnormalsizeboxdollar}}\hlsymbol{optimmethod}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlsymbol{optimmethod}\mbox{}
\normalfont
\end{Hinput}


\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlfunctioncall{class}\hlkeyword{(}\hlsymbol{fit}\hlkeyword{)}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlfunctioncall{c}\hlkeyword{(}\hlstring{\usebox{\hlnormalsizeboxsinglequote}kingui\usebox{\hlnormalsizeboxsinglequote}}\hlkeyword{,}\hlstring{"mkinfit"}\hlkeyword{,}{\ }\hlstring{"modFit"}\hlkeyword{)}\mbox{}
\normalfont
\end{Hinput}


\end{normalsize}
\end{Hchunk}


Return the fit object of class "kingui" for summary and plot in the next step.

\begin{Hchunk}
\begin{normalsize}
\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlfunctioncall{class}\hlkeyword{(}\hlsymbol{fit}\hlkeyword{)}{\ }\hlassignement{\usebox{\hlnormalsizeboxlessthan}-}{\ }\hlfunctioncall{c}\hlkeyword{(}\hlstring{\usebox{\hlnormalsizeboxsinglequote}kingui\usebox{\hlnormalsizeboxsinglequote}}\hlkeyword{,}\hlstring{"mkinfit"}\hlkeyword{,}{\ }\hlstring{"modFit"}\hlkeyword{)}\mbox{}
\normalfont
\end{Hinput}


\begin{Hinput}
\ttfamily\noindent
\hlprompt{\usebox{\hlnormalsizeboxgreaterthan}{\ }}\hlfunctioncall{return}\hlkeyword{(}\hlsymbol{fit}\hlkeyword{)}\mbox{}
\normalfont
\end{Hinput}


\end{normalsize}
\end{Hchunk}


\section{Change Log}
\begin{itemize}
 \item Version:  1.2012.0131.1200	Fix DT90 calculation problems
   from Ian Hardy.
 \item Version: 1.2012.0109.1200	Chi2 error calculation problems
   from Ian Hardy.
 \item Version: 1.2011.1122.1607	NA for parent parameters.
 \item Version: 1.2011.1117.1330	missing R2 problems fixed
 \item Version: 1.2011.1111.1630	DFOP DT50 problems fixed
 \item Version: 1.2011.1108.1630        weight 0 problems solved
 \item Version: 1.2011.1101.1630	weight 0 problems partly solved
  \item Version: 1.2011.1001.1530
     \begin{itemize}
    \item under folder doc: adding a vignette.
    \item under folder tests: adding a few test cases.
    \end{itemize}
  \item Version: 1.2011.930.1430
    \begin{itemize}
    \item summary.mcmckingui: fix MCMC súmmary bugs.
    \item plot.mcmckingui: fix traceplot bugs.
    \end{itemize}
  \item Version: 1.2011.922.1530
    \begin{itemize}
    \item summary.kingui: fix the confilict between the Viewer and the
      R output when the sink compartment is turned off.
    \item Adding mkinmod.full, *kinfit.full functions to analyze the
      water-sediment studies. Also adding more options, like entering
      data as a text/table directly from a single input argument
      instead of relying on the GUI for data inputs. For R-users
      without GUI to use the R sourcefunctions for writing their own scripts the
      scripts will look short and simple, no need to .
    \end{itemize}
\end{itemize}
\bibliographystyle{abbrv}
\bibliography{Kinetics}
%%%%%%%%%


%%<<cleanup , echo=FALSE>>=
%%unloadNamespace ("SweaveListingUtils")
%%@
\end{document}
